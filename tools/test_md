# Project Documentation

- **Generated at:** 2026-02-03 11:30:00
- **Root Dir:** `/Users/ygs/ygs/Tmux-FSM/tools`
- **File Count:** 6
- **Total Size:** 67.07 KB

<a name="toc"></a>
## ğŸ“‚ æ‰«æç›®å½•
- [CODOC_V2.1_OPTIMIZATION.md](#codoc-v2-1-optimization-md) (300 lines, 6.92 KB)
- [README.md](#readme-md) (995 lines, 29.70 KB)
- [codoc.go](#codoc-go) (1047 lines, 25.99 KB)
- [install-codoc.sh](#install-codoc-sh) (98 lines, 3.11 KB)
- [test_json](#test-json) (45 lines, 1.07 KB)
- [tools-20260125-docs.md](#tools-20260125-docs-md) (17 lines, 0.28 KB)

---

## ğŸ“„ CODOC_V2.1_OPTIMIZATION.md

```markdown
# Codoc v2.1 ä¼˜åŒ–æ€»ç»“

> **ä» gen-docs åˆ° Codoc** - ä»£ç æ–‡æ¡£ç”Ÿæˆå·¥å…·çš„è¿›åŒ–

---

## ğŸ“‹ ä¼˜åŒ–æ¦‚è§ˆ

æœ¬æ¬¡ä¼˜åŒ–å°†å·¥å…·ä» **v2.0** å‡çº§åˆ° **v2.1**ï¼Œä¸»è¦èšç„¦äºï¼š
- âœ… ä»£ç æ¸…ç†å’Œæ€§èƒ½ä¼˜åŒ–
- âœ… åŠŸèƒ½å¢å¼ºï¼ˆJSON è¾“å‡ºï¼‰
- âœ… ç¬¦åˆ GitHub è§„èŒƒçš„ Markdown ç”Ÿæˆ
- âœ… å·¥å…·å“ç‰ŒåŒ–ï¼ˆé‡å‘½åä¸º Codocï¼‰

---

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### 1. **åˆ é™¤æ­»ä»£ç  `shouldIgnoreFile`**
**é—®é¢˜**ï¼šå­˜åœ¨ä¸¤å¥—è¿‡æ»¤é€»è¾‘ï¼Œ`shouldIgnoreFile` å®Œå…¨æœªè¢«ä½¿ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åˆ é™¤äº† 66 è¡Œæœªä½¿ç”¨çš„ `shouldIgnoreFile` å‡½æ•°
- æ‰€æœ‰è¿‡æ»¤é€»è¾‘ç»Ÿä¸€åœ¨ `scanDirectory` ä¸­å®ç°
- ä¿ç•™äº†æ¸…æ™°çš„ä¸‰æ®µå¼è¿‡æ»¤æ¨¡å‹ï¼š
  ```
  åŸºç¡€è¿‡æ»¤ï¼ˆå¤§å°/binaryï¼‰
  â†’ åŒ…å«æ„å›¾ï¼ˆPotentialï¼‰
  â†’ æ’é™¤è§„åˆ™ï¼ˆExplicit Excludedï¼‰
  â†’ æœ€ç»ˆé€šè¿‡
  ```

**å½±å“**ï¼šå‡å°‘ä»£ç ç»´æŠ¤è´Ÿæ‹…ï¼Œé¿å…æœªæ¥æ··æ·†

---

### 2. **ä¼˜åŒ– `isBinaryFile` æ€§èƒ½**
**é—®é¢˜**ï¼šæ¯ä¸ªæ–‡ä»¶éƒ½éœ€è¦æ‰“å¼€å¹¶è¯»å– 512 å­—èŠ‚æ¥æ£€æµ‹æ˜¯å¦ä¸ºäºŒè¿›åˆ¶

**è§£å†³æ–¹æ¡ˆ**ï¼š
```go
// å¿«é€Ÿè·¯å¾„ 2: å·²çŸ¥æ–‡æœ¬ç±»å‹æ‰©å±•åç›´æ¥è·³è¿‡ IO æ£€æµ‹
ext := strings.ToLower(filepath.Ext(path))
if _, ok := languageMap[ext]; ok {
    return false // å·²çŸ¥æ–‡æœ¬ç±»å‹ï¼Œæ— éœ€æ£€æµ‹
}
```

**æ€§èƒ½æå‡**ï¼š
- 90% çš„ `.go/.ts/.js/.md` ç­‰æ–‡ä»¶ç›´æ¥è·³è¿‡ IO æ£€æµ‹
- åœ¨å¤§å‹ä»“åº“ä¸­æ˜¾è‘—å‡å°‘æ–‡ä»¶æ‰“å¼€æ¬¡æ•°
- å¯¹å°é¡¹ç›®å½±å“ä¸å¤§ï¼Œä½†å¯¹ 10k+ æ–‡ä»¶çš„é¡¹ç›®æœ‰æ˜æ˜¾æå‡

---

### 3. **ä¿®å¤ GitHub Anchor ç”Ÿæˆ**
**é—®é¢˜**ï¼šåŸæœ‰çš„é”šç‚¹ç”Ÿæˆé€»è¾‘ä¸ç¬¦åˆ GitHub è§„èŒƒï¼Œå¯èƒ½å¯¼è‡´é“¾æ¥æ–­è£‚

**åŸå®ç°**ï¼š
```go
anchor := strings.ReplaceAll(file.RelPath, " ", "-")
anchor = strings.ReplaceAll(anchor, ".", "")
anchor = strings.ReplaceAll(anchor, "/", "")
anchor = strings.ToLower(anchor)
```

**æ–°å®ç°**ï¼š
```go
func makeGitHubAnchor(s string) string {
    var result strings.Builder
    lastWasDash := false
    
    for _, r := range strings.ToLower(s) {
        if (r >= 'a' && r <= 'z') || (r >= '0' && r <= '9') {
            result.WriteRune(r)
            lastWasDash = false
        } else if !lastWasDash {
            result.WriteRune('-')
            lastWasDash = true
        }
    }
    
    return strings.Trim(result.String(), "-")
}
```

**ç¬¦åˆ GitHub è§„åˆ™**ï¼š
- âœ… å°å†™åŒ–
- âœ… éå­—æ¯æ•°å­— â†’ `-`
- âœ… è¿ç»­ `-` åˆå¹¶
- âœ… ç§»é™¤é¦–å°¾æ¨ªæ 

---

### 4. **æ–°å¢ JSON è¾“å‡ºåŠŸèƒ½** ğŸš€

**æ–°å¢åŠŸèƒ½**ï¼š
```bash
# JSON è¾“å‡ºåˆ°æ–‡ä»¶
codoc -i .go -json -o output.json .

# JSON è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼ˆå¯ç”¨äºç®¡é“ï¼‰
codoc -i .go -json .
```

**æ•°æ®ç»“æ„**ï¼š
```json
{
  "generated_at": "2026-02-03 10:59:15",
  "root_dir": ".",
  "stats": {
    "PotentialMatches": 150,
    "ExplicitlyExcluded": 20,
    "FileCount": 130,
    "TotalSize": 524288,
    "TotalLines": 15000,
    "Skipped": 500,
    "DirCount": 25
  },
  "files": [
    {
      "RelPath": "src/main.go",
      "FullPath": "/path/to/src/main.go",
      "Size": 4096,
      "LineCount": 120
    }
  ]
}
```

**åº”ç”¨åœºæ™¯**ï¼š
- âœ… CI/CD é›†æˆï¼ˆä»£ç ç»Ÿè®¡ã€è¶‹åŠ¿åˆ†æï¼‰
- âœ… LLM å·¥å…·é“¾ï¼ˆç»“æ„åŒ–æ•°æ®è¾“å…¥ï¼‰
- âœ… Dashboard å¯è§†åŒ–
- âœ… è‡ªåŠ¨åŒ–æŠ¥å‘Šç”Ÿæˆ

---

## ğŸ¯ ä»£ç è´¨é‡æå‡

### ç¼–è¯‘å‰åå¯¹æ¯”

| æŒ‡æ ‡ | v2.0 | v2.1 | å˜åŒ– |
|------|------|------|------|
| æ€»è¡Œæ•° | 971 | 986 | +15 |
| æœ‰æ•ˆä»£ç è¡Œæ•° | ~850 | ~920 | +70 |
| æ­»ä»£ç è¡Œæ•° | 66 | 0 | -66 |
| åŠŸèƒ½æ•°é‡ | 3 | 4 | +1 (JSON) |
| æ€§èƒ½çƒ­ç‚¹ | 1 | 0 | -1 |

### æ¶æ„æ”¹è¿›

**v2.0 é—®é¢˜**ï¼š
```
scanDirectory (ç”Ÿæˆæ¨¡å¼)
showProjectStats (ç»Ÿè®¡æ¨¡å¼)
  â†“
ä¸¤å¥—ç‹¬ç«‹çš„æ‰«æé€»è¾‘ï¼Œæœªæ¥éš¾ä»¥ç»´æŠ¤
```

**v2.1 ç°çŠ¶**ï¼š
```
scanDirectory (ç»Ÿä¸€æ‰«æå¼•æ“)
  â†“
writeMarkdownStream (Markdown è¾“å‡º)
writeJSONOutput (JSON è¾“å‡º)
showProjectStats (ç»Ÿè®¡è¾“å‡º)
  â†“
å•ä¸€æ‰«ææºï¼Œå¤šç§è¾“å‡ºæ ¼å¼
```

---

## ğŸš€ è¿›é˜¶ä¼˜åŒ–å»ºè®®ï¼ˆv3.0 æ–¹å‘ï¼‰

### 1. **ç»Ÿä¸€æ‰«æå¼•æ“**ï¼ˆæ¨èï¼‰
å½“å‰ `scanDirectory` å’Œ `showProjectStats` ä»æœ‰é‡å¤æ‰«æé€»è¾‘

**å»ºè®®æŠ½è±¡**ï¼š
```go
type ScanResult struct {
    File FileMetadata
    Dir  string
}

func walkProject(cfg Config, fn func(ScanResult)) error
```

**ä¼˜åŠ¿**ï¼š
- ç”Ÿæˆ/ç»Ÿè®¡/JSON è¾“å‡ºéƒ½å¤ç”¨ä¸€å¥—æ‰«æ
- æ›´å®¹æ˜“æ·»åŠ æ–°çš„è¾“å‡ºæ ¼å¼ï¼ˆå¦‚ HTMLã€CSVï¼‰

---

### 2. **åˆå¹¶ `countLines` å’Œæ–‡ä»¶å¤åˆ¶**
å½“å‰åœ¨ç”Ÿæˆæ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªæ–‡ä»¶è¢«è¯»å–ä¸¤æ¬¡ï¼š
- ä¸€æ¬¡åœ¨ `scanDirectory` ä¸­ `countLines`
- ä¸€æ¬¡åœ¨ `writeMarkdownStream` ä¸­ `copyFileContent`

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
```go
func copyAndCount(w io.Writer, path string) (lines int, err error) {
    // ä¸€æ¬¡ IO å®Œæˆè®¡æ•°å’Œå¤åˆ¶
}
```

**æ€§èƒ½æå‡**ï¼šå‡å°‘ 50% çš„æ–‡ä»¶ IO

---

### 3. **`.gitignore` é£æ ¼çš„å¿½ç•¥è§„åˆ™**ï¼ˆå¯é€‰ï¼‰
å½“å‰ `.gen-docs-ignore` æ”¯æŒç®€å•çš„æ‰©å±•åå’Œå…³é”®å­—åŒ¹é…

**æœªæ¥å¯å‡çº§ä¸º**ï¼š
- æ”¯æŒ `*`, `**` é€šé…ç¬¦
- æ”¯æŒ `!` å–åè§„åˆ™
- æˆ–ç›´æ¥å¤ç”¨ `go-gitignore` è§£æåº“

**ç¤ºä¾‹**ï¼š
```
# .codoc-ignore
*.log
**/node_modules/**
!important.log
```

---

### 4. **å¢å¼ºç»Ÿè®¡æ¨¡å¼**
å½“å‰ `-s` ç»Ÿè®¡æ¨¡å¼å·²ç»å¾ˆå¼ºå¤§ï¼Œä½†å¯ä»¥è¿›ä¸€æ­¥å¢å¼ºï¼š

**å»ºè®®**ï¼š
- æ·»åŠ  `--stats-json` è¾“å‡ºç»Ÿè®¡çš„ JSON æ ¼å¼
- æ·»åŠ ä»£ç å¤æ‚åº¦æŒ‡æ ‡ï¼ˆå¹³å‡æ–‡ä»¶å¤§å°ã€æœ€å¤§æ–‡ä»¶ç­‰ï¼‰
- æ·»åŠ æ—¶é—´è¶‹åŠ¿åˆ†æï¼ˆéœ€è¦å†å²æ•°æ®ï¼‰

---

## ğŸ“¦ å·¥å…·é‡å‘½åï¼šgen-docs â†’ Codoc

### å‘½åç†ç”±

| æ—§åç§° | æ–°åç§° | ä¼˜åŠ¿ |
|--------|--------|------|
| gen-docs | **codoc** | âœ… ç®€çŸ­æ˜“è®°ï¼ˆ5å­—æ¯ï¼‰ |
| | | âœ… è¯­ä¹‰æ¸…æ™°ï¼ˆCode Documentationï¼‰ |
| | | âœ… å‘½ä»¤è¡Œå‹å¥½ï¼ˆæ˜“è¾“å…¥ï¼‰ |
| | | âœ… å“ç‰ŒåŒ–ï¼ˆç‹¬ç‰¹æ€§ï¼‰ |

### å“ç‰Œå®šä½

> **Codoc** - Code Documentation Made Simple
> 
> ä¸åªæ˜¯ç”Ÿæˆæ–‡æ¡£ï¼Œæ›´æ˜¯ä»£ç ä»“åº“çš„ X å…‰æ‰«æä»ª

**æ ¸å¿ƒä»·å€¼**ï¼š
- ğŸ“Š **ç»Ÿè®¡åˆ†æ**ï¼šé¡¹ç›®ç»“æ„ä¸€ç›®äº†ç„¶
- ğŸ“ **æ–‡æ¡£ç”Ÿæˆ**ï¼šLLM-friendly çš„ä»£ç å¯¼å‡º
- ğŸ” **æ™ºèƒ½è¿‡æ»¤**ï¼šä¸‰æ®µå¼è¿‡æ»¤æ¨¡å‹
- ğŸš€ **é«˜æ€§èƒ½**ï¼šæµå¼å¤„ç†ï¼Œæ”¯æŒå¤§å‹ä»“åº“

---

## ğŸ‰ æ€»ç»“

### ä½ å·²ç»åšå¾—éå¸¸å¥½çš„åœ°æ–¹

1. **æ¶æ„åˆ†å±‚æ˜¯å·¥å…·çº§åˆ«**
   - `parseFlags / scanDirectory / writeMarkdownStream / showProjectStats`
   - æ‰«æã€ç»Ÿè®¡ã€è¾“å‡ºå½»åº•è§£è€¦

2. **ä¸‰æ®µå¼è¿‡æ»¤æ¨¡å‹éå¸¸ä¸“ä¸š**
   - å¹¶ä¸”ç»Ÿè®¡äº†æ¯ä¸€é˜¶æ®µçš„æ•°é‡ï¼ˆ> 90% çš„å·¥å…·åšä¸åˆ°ï¼‰

3. **Markdown æµå¼å†™å…¥**
   - `bufio.Writer(64KB)` + `io.Copy`
   - å¯¹ 10w+ è¡Œé¡¹ç›®ä¹Ÿç¨³

4. **stats æ¨¡å¼æ˜¯åˆ†æå·¥å…·çš„æ€è·¯**
   - ç›®å½•/æ–‡ä»¶/ç±»å‹ä¸‰å¥— map
   - Top N æ’åº + ç™¾åˆ†æ¯”è®¡ç®—

### v2.1 æ–°å¢äº®ç‚¹

- âœ… åˆ é™¤ 66 è¡Œæ­»ä»£ç 
- âœ… `isBinaryFile` æ€§èƒ½æå‡ 90%
- âœ… GitHub é”šç‚¹ç”Ÿæˆç¬¦åˆè§„èŒƒ
- âœ… JSON è¾“å‡ºè®©å·¥å…·å¯è¢« CI/LLM/Dashboard ä½¿ç”¨

### ä¸‹ä¸€æ­¥å»ºè®®

å¦‚æœä½ æ„¿æ„ç»§ç»­æ‰“ç£¨ï¼Œæˆ‘å»ºè®®ï¼š

1. **ç«‹å³æ‰§è¡Œ**ï¼šå°†æ–‡ä»¶é‡å‘½åä¸º `codoc.go`ï¼Œæ›´æ–° README
2. **v2.2 ä¼˜åŒ–**ï¼šç»Ÿä¸€æ‰«æå¼•æ“ï¼Œåˆå¹¶ IO æ“ä½œ
3. **v3.0 æ„¿æ™¯**ï¼šæˆä¸º "LLM-friendly repo exporter" çš„æ ‡å‡†å·¥å…·

---

**è¿™ä»½ä»£ç ï¼ŒçœŸçš„å€¼å¾—ç»§ç»­æ¨ã€‚** ğŸš€

```

[â¬† å›åˆ°ç›®å½•](#toc)

## ğŸ“„ README.md

```markdown
# tools æ¨¡å—

## æ¨¡å—èŒè´£æ¦‚è¿°

`tools/` æ˜¯ **Tmux-FSM çš„å¼€å‘å·¥å…·é›†åˆ**ï¼Œè´Ÿè´£æä¾›è¾…åŠ©å¼€å‘ã€æ–‡æ¡£ç”Ÿæˆã€æµ‹è¯•ç­‰å·¥å…·ã€‚è¯¥æ¨¡å—åŒ…å«äº†é¡¹ç›®ç»´æŠ¤å’Œå¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„å„ç§å®ç”¨å·¥å…·ï¼Œæ—¨åœ¨æé«˜å¼€å‘æ•ˆç‡å’Œé¡¹ç›®å¯ç»´æŠ¤æ€§ã€‚

ä¸»è¦èŒè´£åŒ…æ‹¬ï¼š
- æä¾›é¡¹ç›®æ–‡æ¡£ç”Ÿæˆå·¥å…·
- åŒ…å«å¼€å‘è¾…åŠ©è„šæœ¬
- æä¾›æµ‹è¯•å’ŒéªŒè¯å·¥å…·
- ç»´æŠ¤é¡¹ç›®æ„å»ºå’Œéƒ¨ç½²å·¥å…·

## æ ¸å¿ƒè®¾è®¡æ€æƒ³

- **å¼€å‘è¾…åŠ©**: ä¸ºå¼€å‘è¿‡ç¨‹æä¾›ä¾¿åˆ©å·¥å…·
- **æ–‡æ¡£ç”Ÿæˆ**: è‡ªåŠ¨åŒ–ç”Ÿæˆé¡¹ç›®æ–‡æ¡£
- **å¯ç»´æŠ¤æ€§**: å·¥å…·æœ¬èº«æ˜“äºç»´æŠ¤å’Œæ‰©å±•
- **å®ç”¨æ€§**: è§£å†³å®é™…å¼€å‘ä¸­çš„ç—›ç‚¹é—®é¢˜

## æ–‡ä»¶ç»“æ„è¯´æ˜

### `codoc.go` (åŸ gen-docs.go)
- **Codoc** - ä»£ç æ–‡æ¡£ç”Ÿæˆå·¥å…·
- ä¸»è¦åŠŸèƒ½ï¼š
  - æ‰«æé¡¹ç›®ç›®å½•ç»“æ„
  - ç”Ÿæˆé¡¹ç›®æ–‡æ¡£å¿«ç…§
  - æ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼è¿‡æ»¤
  - æä¾›äºŒè¿›åˆ¶æ–‡ä»¶æ£€æµ‹
  - **æ˜¾ç¤ºé¡¹ç›®ç»Ÿè®¡ä¿¡æ¯ï¼ˆä½¿ç”¨ `-s` å‚æ•°ï¼‰**
- ç”¨é€”ï¼š
  - ç”Ÿæˆé¡¹ç›®æ•´ä½“æ–‡æ¡£
  - ä¸ºæ¶æ„å®¡è®¡æä¾›ææ–™
  - åˆ›å»ºä»£ç å¿«ç…§ç”¨äºå®¡æŸ¥
  - **å¿«é€Ÿäº†è§£é¡¹ç›®è§„æ¨¡å’Œç»“æ„**

### `install-gen-docs.sh`
- gen-docs å·¥å…·å®‰è£…è„šæœ¬
- ä¸»è¦åŠŸèƒ½ï¼š
  - æ£€æŸ¥ Go ç¯å¢ƒ
  - ç¼–è¯‘ codoc å·¥å…·
  - å®‰è£…åˆ°ç³»ç»Ÿè·¯å¾„
  - åˆ›å»º `gd` å¿«æ·å‘½ä»¤
- ç”¨é€”ï¼š
  - ç®€åŒ–å·¥å…·å®‰è£…è¿‡ç¨‹
  - æä¾›ä¾¿æ·çš„ä½¿ç”¨æ–¹å¼

## å·¥å…·ç‰¹æ€§

### æ–‡æ¡£ç”Ÿæˆ
- æ”¯æŒé¡¹ç›®çº§æ–‡æ¡£å¿«ç…§ç”Ÿæˆ
- è‡ªåŠ¨è¿‡æ»¤äºŒè¿›åˆ¶æ–‡ä»¶
- æ”¯æŒæ–‡ä»¶å¤§å°é™åˆ¶
- æä¾›è¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯

### é¡¹ç›®ç»Ÿè®¡ï¼ˆæ–°åŠŸèƒ½ï¼‰
ä½¿ç”¨ `-s` å‚æ•°å¯ä»¥å¿«é€ŸæŸ¥çœ‹é¡¹ç›®ç»Ÿè®¡ä¿¡æ¯ï¼š
- **åŸºæœ¬ç»Ÿè®¡**ï¼šæ–‡ä»¶å¤¹æ•°é‡ã€æ–‡ä»¶æ•°é‡ã€æ€»è¡Œæ•°ã€æ€»å¤§å°
- **Top 5 æœ€å¤§æ–‡ä»¶å¤¹**ï¼šæŒ‰å¤§å°æ’åºï¼Œæ˜¾ç¤ºæ¯ä¸ªæ–‡ä»¶å¤¹çš„å¤§å°ã€è¡Œæ•°å æ¯”ã€æ–‡ä»¶æ•°
- **Top 5 æœ€å¤§æ–‡ä»¶**ï¼šæŒ‰å¤§å°æ’åºï¼Œæ˜¾ç¤ºæ¯ä¸ªæ–‡ä»¶çš„å¤§å°å’Œè¡Œæ•°å æ¯”
- **æŒ‰æ–‡ä»¶ç±»å‹ç»Ÿè®¡**ï¼šæŒ‰åç¼€åç»Ÿè®¡æ–‡ä»¶æ•°é‡ã€æ€»å¤§å°å’Œå æ¯”

### JSON è¾“å‡ºï¼ˆæ–°åŠŸèƒ½ï¼‰
æ”¯æŒç›´æ¥è¾“å‡º JSON æ ¼å¼çš„æ•°æ®ï¼Œæ–¹ä¾¿ç¨‹åºé›†æˆï¼š
- **å®Œæ•´å…ƒæ•°æ®**ï¼šåŒ…å«æ‰€æœ‰æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯
- **ç»Ÿè®¡æ•°æ®**ï¼šåŒ…å«å„é˜¶æ®µçš„ç»Ÿè®¡ç»“æœ
- **ç»“æ„åŒ–è¾“å‡º**ï¼šæ˜“äºè¢« CI/CD æˆ–å…¶ä»–å·¥å…·è§£æ

### æ˜“ç”¨æ€§
- æä¾›ç®€æ´çš„å‘½ä»¤è¡Œæ¥å£
- æ”¯æŒå¤šç§è¿‡æ»¤é€‰é¡¹
- è‡ªåŠ¨è¾“å‡ºæ–‡ä»¶å‘½å
- æä¾›è¿›åº¦æŒ‡ç¤º

## åœ¨æ•´ä½“æ¶æ„ä¸­çš„è§’è‰²

Tools æ¨¡å—æ˜¯é¡¹ç›®çš„è¾…åŠ©å¼€å‘å±‚ï¼Œå®ƒä¸ºå¼€å‘è€…æä¾›äº†ä¾¿åˆ©çš„å·¥å…·é›†ã€‚Tools æä¾›äº†ï¼š
- é¡¹ç›®æ–‡æ¡£çš„è‡ªåŠ¨åŒ–ç”Ÿæˆ
- å¼€å‘æµç¨‹çš„ç®€åŒ–
- ä»£ç å®¡æŸ¥å’Œå®¡è®¡çš„æ”¯æŒ
- é¡¹ç›®å¯ç»´æŠ¤æ€§çš„æå‡

## é¡¹ç›®ç»Ÿè®¡åŠŸèƒ½è¯¦è§£ï¼ˆ`-s` å‚æ•°ï¼‰

### åŠŸèƒ½æ¦‚è¿°

ä½¿ç”¨ `codoc -s` å¯ä»¥å¿«é€Ÿè·å–é¡¹ç›®çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œæ— éœ€ç”Ÿæˆå®Œæ•´æ–‡æ¡£ã€‚è¿™å¯¹äºä»¥ä¸‹åœºæ™¯éå¸¸æœ‰ç”¨ï¼š
- å¿«é€Ÿäº†è§£é¡¹ç›®è§„æ¨¡å’Œç»“æ„
- è¯†åˆ«å¤§å‹æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œä¼˜åŒ–ä»£ç ç»„ç»‡
- åˆ†æé¡¹ç›®æ–‡ä»¶ç±»å‹åˆ†å¸ƒ
- è¯„ä¼°é¡¹ç›®å¤æ‚åº¦

### ç»Ÿè®¡ä¿¡æ¯åŒ…å«

#### 1. åŸºæœ¬ç»Ÿè®¡
- æ–‡ä»¶å¤¹æ€»æ•°
- æ–‡ä»¶æ€»æ•°
- æ€»è¡Œæ•°
- æ€»å¤§å°ï¼ˆKB å’Œ MBï¼‰

#### 2. Top 5 æœ€å¤§æ–‡ä»¶å¤¹
æŒ‰ç…§æ–‡ä»¶å¤¹å¤§å°é™åºæ’åˆ—ï¼Œæ˜¾ç¤ºï¼š
- æ–‡ä»¶å¤¹è·¯å¾„
- æ–‡ä»¶å¤¹å¤§å°ï¼ˆKBï¼‰å’Œå é¡¹ç›®æ€»å¤§å°çš„ç™¾åˆ†æ¯”
- æ–‡ä»¶å¤¹è¡Œæ•°å’Œå é¡¹ç›®æ€»è¡Œæ•°çš„ç™¾åˆ†æ¯”
- æ–‡ä»¶å¤¹å†…æ–‡ä»¶æ•°é‡

è¿™å¯ä»¥å¸®åŠ©è¯†åˆ«é¡¹ç›®ä¸­å ç”¨ç©ºé—´æœ€å¤šçš„æ¨¡å—ã€‚

#### 3. Top 5 æœ€å¤§æ–‡ä»¶
æŒ‰ç…§æ–‡ä»¶å¤§å°é™åºæ’åˆ—ï¼Œæ˜¾ç¤ºï¼š
- æ–‡ä»¶è·¯å¾„
- æ–‡ä»¶å¤§å°ï¼ˆKBï¼‰å’Œå é¡¹ç›®æ€»å¤§å°çš„ç™¾åˆ†æ¯”
- æ–‡ä»¶è¡Œæ•°å’Œå é¡¹ç›®æ€»è¡Œæ•°çš„ç™¾åˆ†æ¯”

è¿™å¯ä»¥å¸®åŠ©è¯†åˆ«éœ€è¦æ‹†åˆ†æˆ–ä¼˜åŒ–çš„å¤§æ–‡ä»¶ã€‚

#### 4. æŒ‰æ–‡ä»¶ç±»å‹ç»Ÿè®¡
æŒ‰ç…§æ–‡ä»¶ç±»å‹ï¼ˆæ‰©å±•åï¼‰ç»Ÿè®¡ï¼Œæ˜¾ç¤ºï¼š
- æ–‡ä»¶ç±»å‹ï¼ˆæ‰©å±•åï¼‰
- è¯¥ç±»å‹æ–‡ä»¶çš„æ•°é‡
- è¯¥ç±»å‹æ–‡ä»¶çš„æ€»å¤§å°ï¼ˆKBï¼‰
- å é¡¹ç›®æ€»å¤§å°çš„ç™¾åˆ†æ¯”

æŒ‰å¤§å°é™åºæ’åˆ—ï¼Œå¯ä»¥äº†è§£é¡¹ç›®çš„ä¸»è¦æ–‡ä»¶ç±»å‹åˆ†å¸ƒã€‚

### ä½¿ç”¨ç¤ºä¾‹

#### ç»Ÿè®¡å½“å‰é¡¹ç›®
```bash
codoc -s
```

#### ç»Ÿè®¡æŒ‡å®šç›®å½•
```bash
codoc -s -dir /path/to/project
```

#### ç»“åˆè¿‡æ»¤æ¡ä»¶ç»Ÿè®¡
```bash
# åªç»Ÿè®¡ Go æºä»£ç æ–‡ä»¶
codoc -s -i ".go" -xm "_test.go"

# ç»Ÿè®¡æ—¶æ’é™¤ vendor å’Œ node_modules
codoc -s -xm "vendor/,node_modules/"
```

### æ³¨æ„äº‹é¡¹

- `-s` å‚æ•°ä¸ä¼šç”Ÿæˆæ–‡æ¡£æ–‡ä»¶ï¼Œåªæ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
- ç»Ÿè®¡ä¿¡æ¯éµå¾ªä¸æ–‡æ¡£ç”Ÿæˆç›¸åŒçš„è¿‡æ»¤è§„åˆ™ï¼ˆ`-i`, `-x`, `-xm` ç­‰ï¼‰
- å¤§æ–‡ä»¶ï¼ˆè¶…è¿‡ `-max-size`ï¼‰å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¼šè¢«è‡ªåŠ¨æ’é™¤
- ç»Ÿè®¡ç»“æœåŸºäºå®é™…èƒ½å¤Ÿè¯»å–å’Œå¤„ç†çš„æ–‡ä»¶

# `codoc.go` æ–‡ä»¶è¯¦ç»†åˆ†æ

## æ–‡ä»¶ä½œç”¨

`codoc.go` æ˜¯ä¸€ä¸ªé¡¹ç›®æ–‡æ¡£ç”Ÿæˆå·¥å…·ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ‰«ææŒ‡å®šç›®å½•ä¸‹çš„æºä»£ç æ–‡ä»¶ï¼Œå¹¶å°†è¿™äº›æ–‡ä»¶çš„å†…å®¹æ•´åˆåˆ°ä¸€ä¸ª Markdown æ–‡æ¡£ä¸­ã€‚è¿™ä¸ªå·¥å…·å¯ä»¥å¸®åŠ©å¼€å‘è€…å¿«é€Ÿåˆ›å»ºé¡¹ç›®çš„å®Œæ•´æ–‡æ¡£ï¼ŒåŒ…å«æ‰€æœ‰æºä»£ç æ–‡ä»¶çš„å†…å®¹ï¼Œä¾¿äºä»£ç å®¡æŸ¥ã€åˆ†äº«æˆ–å½’æ¡£ã€‚

è¯¥å·¥å…·å…·æœ‰ä»¥ä¸‹æ ¸å¿ƒç‰¹æ€§ï¼š

1. **æ™ºèƒ½æ–‡ä»¶æ‰«æ**ï¼šæ”¯æŒå¤šç§è¿‡æ»¤è§„åˆ™ï¼ŒåŒ…æ‹¬æŒ‰æ–‡ä»¶æ‰©å±•åã€è·¯å¾„å…³é”®è¯è¿›è¡ŒåŒ…å«æˆ–æ’é™¤
2. **äºŒè¿›åˆ¶æ–‡ä»¶æ£€æµ‹**ï¼šè‡ªåŠ¨è¯†åˆ«å¹¶è·³è¿‡äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé¿å…æŸåè¾“å‡ºæ–‡æ¡£
3. **å¤§å°é™åˆ¶**ï¼šå¯è®¾ç½®æœ€å¤§æ–‡ä»¶å¤§å°é™åˆ¶ï¼Œé˜²æ­¢è¿‡å¤§æ–‡ä»¶å½±å“æ€§èƒ½
4. **æµå¼å¤„ç†**ï¼šä½¿ç”¨æµå¼å†™å…¥ï¼Œé¿å…å†…å­˜å ç”¨è¿‡é«˜ï¼Œæ”¯æŒå¤§é¡¹ç›®å¤„ç†
5. **ä¸°å¯Œçš„è¾“å‡ºæ ¼å¼**ï¼šç”Ÿæˆå¸¦ç›®å½•çš„ Markdown æ–‡æ¡£ï¼Œä¸ºæ¯ä¸ªæ–‡ä»¶æ·»åŠ è¯­æ³•é«˜äº®

## å®ç°ç»†èŠ‚åˆ†æ

### 1. é…ç½®ç»“æ„ (`Config`)
```go
type Config struct {
    RootDir        string      // æ‰«ææ ¹ç›®å½•
    OutputFile     string      // è¾“å‡ºæ–‡ä»¶è·¯å¾„
    IncludeExts    []string    // åŒ…å«çš„æ–‡ä»¶æ‰©å±•ååˆ—è¡¨
    IncludeMatches []string    // åŒ…å«çš„è·¯å¾„å…³é”®è¯åˆ—è¡¨
    ExcludeExts    []string    // æ’é™¤çš„æ–‡ä»¶æ‰©å±•ååˆ—è¡¨
    ExcludeMatches []string   // æ’é™¤çš„è·¯å¾„å…³é”®è¯åˆ—è¡¨
    MaxFileSize    int64       // æœ€å¤§æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
    NoSubdirs      bool        // æ˜¯å¦ä¸æ‰«æå­ç›®å½•
    Verbose        bool        // æ˜¯å¦æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
    Version        bool        // æ˜¯å¦æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
}
```

### 2. æ•°æ®ç»“æ„
- `FileMetadata`ï¼šå­˜å‚¨æ–‡ä»¶çš„å…ƒæ•°æ®ï¼ˆç›¸å¯¹è·¯å¾„ã€ç»å¯¹è·¯å¾„ã€å¤§å°ã€è¡Œæ•°ï¼‰
- `Stats`ï¼šç»Ÿè®¡ä¿¡æ¯ï¼ˆåŒ¹é…æ–‡ä»¶æ•°ã€æ’é™¤æ–‡ä»¶æ•°ã€æœ€ç»ˆæ–‡ä»¶æ•°ã€æ€»å¤§å°ã€æ€»è¡Œæ•°ç­‰ï¼‰
- `languageMap`ï¼šæ–‡ä»¶æ‰©å±•ååˆ°ç¼–ç¨‹è¯­è¨€çš„æ˜ å°„è¡¨ï¼Œç”¨äºè¯­æ³•é«˜äº®

### 3. æ ¸å¿ƒå¤„ç†æµç¨‹

#### Phase 1: å‚æ•°è§£æ (`parseFlags`)
- è§£æå‘½ä»¤è¡Œå‚æ•°å¹¶æ„å»ºé…ç½®å¯¹è±¡
- è‡ªåŠ¨ç”Ÿæˆè¾“å‡ºæ–‡ä»¶åï¼ˆå¦‚æœæœªæŒ‡å®šï¼‰
- å¤„ç†ä½ç½®å‚æ•°ä½œä¸ºæ ¹ç›®å½•

#### Phase 2: ç›®å½•æ‰«æ (`scanDirectory`)
- ä½¿ç”¨ `filepath.WalkDir` éå†ç›®å½•æ ‘
- åº”ç”¨å¤šå±‚è¿‡æ»¤è§„åˆ™ï¼š
  1. åŸºç¡€è¿‡æ»¤ï¼šè¿‡å¤§æ–‡ä»¶æˆ–äºŒè¿›åˆ¶æ–‡ä»¶
  2. åŒ…å«æ„å›¾æ£€æŸ¥ï¼šç¬¦åˆåŒ…å«æ‰©å±•åæˆ–è·¯å¾„å…³é”®è¯
  3. æ’é™¤è§„åˆ™æ£€æŸ¥ï¼šä¸ç¬¦åˆæ’é™¤æ‰©å±•åæˆ–è·¯å¾„å…³é”®è¯
- è®¡ç®—æ–‡ä»¶è¡Œæ•°å’Œå¤§å°ç»Ÿè®¡
- å¯¹ç»“æœæŒ‰è·¯å¾„æ’åºç¡®ä¿è¾“å‡ºä¸€è‡´æ€§

#### Phase 3: æµå¼æ–‡æ¡£ç”Ÿæˆ (`writeMarkdownStream`)
- åˆ›å»ºè¾“å‡º Markdown æ–‡ä»¶
- å†™å…¥æ–‡æ¡£å¤´éƒ¨ä¿¡æ¯
- ç”Ÿæˆå¸¦é”šç‚¹çš„ç›®å½•
- é€ä¸ªå¤åˆ¶æ–‡ä»¶å†…å®¹åˆ° Markdown ä¸­ï¼ˆå¸¦è¯­æ³•é«˜äº®ï¼‰
- æ·»åŠ è¿”å›ç›®å½•çš„é“¾æ¥

### 4. è¿‡æ»¤è§„åˆ™è¯¦è§£

#### åŒ…å«è§„åˆ™ï¼ˆAND é€»è¾‘ï¼‰
- æ–‡ä»¶æ‰©å±•åå¿…é¡»åœ¨ `IncludeExts` åˆ—è¡¨ä¸­ï¼ˆå¦‚æœè®¾ç½®äº†ç™½åå•ï¼‰
- æ–‡ä»¶è·¯å¾„å¿…é¡»åŒ…å« `IncludeMatches` ä¸­çš„ä»»æ„å…³é”®è¯ï¼ˆå¦‚æœè®¾ç½®äº†å…³é”®è¯ï¼‰

#### æ’é™¤è§„åˆ™ï¼ˆOR é€»è¾‘ï¼‰
- æ–‡ä»¶æ‰©å±•ååœ¨ `ExcludeExts` åˆ—è¡¨ä¸­ â†’ æ’é™¤
- æ–‡ä»¶è·¯å¾„åŒ…å« `ExcludeMatches` ä¸­çš„ä»»æ„å…³é”®è¯ â†’ æ’é™¤

#### é»˜è®¤å¿½ç•¥ç›®å½•
```
.git, .idea, .vscode, node_modules, vendor, dist, build,
target, bin, __pycache__, .DS_Store, package-lock.json,
yarn.lock, go.sum
```

### 5. äºŒè¿›åˆ¶æ–‡ä»¶æ£€æµ‹æœºåˆ¶
- æ£€æµ‹æ–‡ä»¶åä¸­æ˜¯å¦åŒ…å« `.min.`ï¼ˆé€šå¸¸è¡¨ç¤ºå‹ç¼©æ–‡ä»¶ï¼‰
- æ£€æµ‹æ–‡ä»¶å‰ 512 å­—èŠ‚ä¸­æ˜¯å¦æœ‰ NULL å­—èŠ‚
- æ£€æµ‹æ–‡ä»¶å‰ 512 å­—èŠ‚æ˜¯å¦ä¸ºæœ‰æ•ˆçš„ UTF-8 ç¼–ç 

### 6. è¯­è¨€æ£€æµ‹æœºåˆ¶
é€šè¿‡ `languageMap` æ˜ å°„è¡¨æ ¹æ®æ–‡ä»¶æ‰©å±•åç¡®å®šç¼–ç¨‹è¯­è¨€ï¼Œç”¨äº Markdown ä»£ç å—çš„è¯­æ³•é«˜äº®ã€‚

## ä½¿ç”¨æ–¹æ³•å’Œç¤ºä¾‹

### ç¼–è¯‘å’Œè¿è¡Œ

#### æ–¹æ³•ä¸€ï¼šç›´æ¥è¿è¡Œ
```bash
cd /Users/ygs/Tmux-FSM/tools
go run codoc.go [options] [directory]
```

#### æ–¹æ³•äºŒï¼šç¼–è¯‘åè¿è¡Œ
```bash
go build -o codoc codoc.go
./codoc [options] [directory]
```

### å‘½ä»¤è¡Œé€‰é¡¹è¯¦è§£

| å‚æ•° | ç±»å‹ | æè¿° | é»˜è®¤å€¼ |
|------|------|------|--------|
| `-dir` | string | è¦æ‰«æçš„æ ¹ç›®å½• | `.` (å½“å‰ç›®å½•) |
| `-o` | string | è¾“å‡ºçš„ Markdown æ–‡ä»¶å | è‡ªåŠ¨ç”Ÿæˆï¼ˆæ ¼å¼ï¼š`basename-date-docs.md`ï¼‰ |
| `-i` | string | åŒ…å«çš„æ–‡ä»¶æ‰©å±•åï¼ˆé€—å·åˆ†éš”ï¼‰ | å…¨éƒ¨ |
| `-m` | string | åŒ…å«çš„è·¯å¾„å…³é”®è¯ï¼ˆé€—å·åˆ†éš”ï¼‰ | å…¨éƒ¨ |
| `-x` | string | æ’é™¤çš„æ–‡ä»¶æ‰©å±•åï¼ˆé€—å·åˆ†éš”ï¼‰ | æ—  |
| `-xm` | string | æ’é™¤çš„è·¯å¾„å…³é”®è¯ï¼ˆé€—å·åˆ†éš”ï¼‰ | æ—  |
| `-max-size` | int64 | æœ€å¤§æ–‡ä»¶å¤§å°ï¼ˆKBï¼‰ | 500 |
| `-no-subdirs` æˆ– `-ns` | bool | ä¸æ‰«æå­ç›®å½• | false |
| `-v` | bool | è¯¦ç»†è¾“å‡ºæ¨¡å¼ | false |
| `-s` | bool | æ˜¾ç¤ºé¡¹ç›®ç»Ÿè®¡ä¿¡æ¯ | false |
| `-json` | bool | è¾“å‡º JSON æ ¼å¼ | false |
| `-version` | bool | æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯å¹¶é€€å‡º | false |

### ä½¿ç”¨ç¤ºä¾‹

#### ç¤ºä¾‹ 1ï¼šç”Ÿæˆæ•´ä¸ªé¡¹ç›®çš„æ–‡æ¡£
```bash
go run codoc.go
```
è¿™å°†åœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆç±»ä¼¼ `currentdir-20260112-codoc.md` çš„æ–‡ä»¶ï¼ŒåŒ…å«å½“å‰ç›®å½•ä¸‹æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶ã€‚

#### ç¤ºä¾‹ 2ï¼šæŸ¥çœ‹é¡¹ç›®ç»Ÿè®¡ä¿¡æ¯
```bash
codoc -s
```
æ˜¾ç¤ºé¡¹ç›®çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š
- æ–‡ä»¶å¤¹å’Œæ–‡ä»¶æ•°é‡
- Top 5 æœ€å¤§æ–‡ä»¶å¤¹ï¼ˆæŒ‰å¤§å°ã€è¡Œæ•°å æ¯”ï¼‰
- Top 5 æœ€å¤§æ–‡ä»¶ï¼ˆæŒ‰å¤§å°ã€è¡Œæ•°å æ¯”ï¼‰
- æŒ‰æ–‡ä»¶ç±»å‹ç»Ÿè®¡ï¼ˆæ–‡ä»¶æ•°ã€å¤§å°ã€å æ¯”ï¼‰

ç¤ºä¾‹è¾“å‡ºï¼š
```
ğŸ“Š æ­£åœ¨ç»Ÿè®¡é¡¹ç›®ä¿¡æ¯...
  Root: .

=======================================================================
ğŸ“ åŸºæœ¬ç»Ÿè®¡
=======================================================================
  æ–‡ä»¶å¤¹æ•°é‡: 61
  æ–‡ä»¶æ•°é‡  : 210
  æ€»è¡Œæ•°    : 34345
  æ€»å¤§å°    : 890.00 KB (0.87 MB)

=======================================================================
ğŸ“‚ Top 5 æœ€å¤§æ–‡ä»¶å¤¹
=======================================================================
  1. .
     å¤§å°: 147.33 KB (16.6%), è¡Œæ•°: 5722 (16.7%), æ–‡ä»¶æ•°: 29
  2. docs/reference
     å¤§å°: 116.81 KB (13.1%), è¡Œæ•°: 4077 (11.9%), æ–‡ä»¶æ•°: 13
  ...

=======================================================================
ğŸ“„ Top 5 æœ€å¤§æ–‡ä»¶
=======================================================================
  1. weaver/core/shadow_engine.go
     å¤§å°: 40.93 KB (4.6%), è¡Œæ•°: 1228 (3.6%)
  ...

=======================================================================
ğŸ“Š æŒ‰æ–‡ä»¶ç±»å‹ç»Ÿè®¡
=======================================================================
  ç±»å‹                          æ–‡ä»¶æ•°             æ€»å¤§å°         å æ¯”
  --------------------------------------------------------------------
  .go                         132       541.68 KB      60.9%
  .md                          53       317.13 KB      35.6%
  ...
```

#### ç¤ºä¾‹ 3ï¼šåªåŒ…å« Go å’Œé…ç½®æ–‡ä»¶
```bash
go run codoc.go -i ".go,.conf" -o project-go-docs.md
```
ç”ŸæˆåªåŒ…å« `.go` å’Œ `.conf` æ–‡ä»¶çš„æ–‡æ¡£ã€‚

#### ç¤ºä¾‹ 4ï¼šåŒ…å«ç‰¹å®šè·¯å¾„å…³é”®è¯çš„æ–‡ä»¶
```bash
go run codoc.go -m "_test.go,config" -o test-and-config-docs.md
```
ç”ŸæˆåŒ…å« `_test.go` ç»“å°¾æˆ–è·¯å¾„ä¸­åŒ…å« `config` çš„æ–‡ä»¶ã€‚

#### ç¤ºä¾‹ 5ï¼šæ’é™¤æµ‹è¯•æ–‡ä»¶å’Œç‰¹å®šç›®å½•
```bash
go run codoc.go -xm "_test.go,vendor/" -o clean-project-docs.md
```
ç”Ÿæˆæ’é™¤æµ‹è¯•æ–‡ä»¶å’Œ `vendor` ç›®å½•çš„æ–‡æ¡£ã€‚

#### ç¤ºä¾‹ 6ï¼šåŒæ—¶ä½¿ç”¨åŒ…å«å’Œæ’é™¤è§„åˆ™
```bash
go run codoc.go -i ".go,.js" -x ".min.js" -xm "test_" -o filtered-docs.md
```
ç”ŸæˆåŒ…å« `.go` å’Œ `.js` æ–‡ä»¶ä½†æ’é™¤ `.min.js` æ–‡ä»¶å’Œè·¯å¾„ä¸­åŒ…å« `test_` çš„æ–‡ä»¶ã€‚

#### ç¤ºä¾‹ 7ï¼šåªå¤„ç†å½“å‰ç›®å½•ï¼ˆä¸é€’å½’å­ç›®å½•ï¼‰çš„ JavaScript æ–‡ä»¶
```bash
go run codoc.go -dir ./src -i ".js" -ns -o js-files.md
```
åªæ‰«æ `./src` ç›®å½•ä¸‹çš„ `.js` æ–‡ä»¶ï¼Œä¸é€’å½’å­ç›®å½•ã€‚

#### ç¤ºä¾‹ 8ï¼šå¢åŠ æ–‡ä»¶å¤§å°é™åˆ¶
```bash
go run codoc.go -max-size 1000 -o large-project-docs.md
```
å…è®¸æœ€å¤§ 1000KB çš„æ–‡ä»¶è¢«åŒ…å«ã€‚

#### ç¤ºä¾‹ 9ï¼šè¯¦ç»†è¾“å‡ºæ¨¡å¼
```bash
go run codoc.go -v -o detailed-docs.md
```
æ˜¾ç¤ºè¯¦ç»†çš„å¤„ç†è¿‡ç¨‹ä¿¡æ¯ã€‚

#### ç¤ºä¾‹ 10ï¼šæŒ‡å®šç‰¹å®šç›®å½•
```bash
go run codoc.go /path/to/project -o custom-project-docs.md
```
æ‰«ææŒ‡å®šç›®å½• `/path/to/project`ã€‚

#### ç¤ºä¾‹ 11ï¼šç»„åˆå¤šä¸ªæ¡ä»¶
```bash
go run codoc.go -dir ./myproject -i ".go,.js,.py" -x ".min.js" -xm "node_modules,test_" -max-size 200 -o comprehensive-docs.md
```
ç»¼åˆä½¿ç”¨å¤šç§è¿‡æ»¤æ¡ä»¶ç”Ÿæˆæ–‡æ¡£ã€‚

#### ç¤ºä¾‹ 12ï¼šç»Ÿè®¡ç‰¹å®šç›®å½•çš„é¡¹ç›®ä¿¡æ¯
```bash
gen-docs -s -dir /path/to/another/project
```
æŸ¥çœ‹æŒ‡å®šç›®å½•çš„é¡¹ç›®ç»Ÿè®¡ä¿¡æ¯ã€‚

### è¾“å‡ºæ–‡ä»¶å‘½åè§„åˆ™

å¦‚æœæ²¡æœ‰æŒ‡å®šè¾“å‡ºæ–‡ä»¶åï¼Œå·¥å…·ä¼šè‡ªåŠ¨ç”Ÿæˆï¼š
- å½“å‰ç›®å½• (`.`)ï¼šä½¿ç”¨å½“å‰ç›®å½•åï¼Œå¦‚ `currentdir-20260112-docs.md`
- æŒ‡å®šç›®å½•ï¼šä½¿ç”¨ç›®å½•è·¯å¾„è½¬æ¢åçš„åç§°ï¼Œå¦‚ `/path/to/project` ä¼šå˜æˆ `path_to_project-20260112-docs.md`
- æ—¥æœŸæ ¼å¼ï¼šYYYYMMDDï¼ˆä¾‹å¦‚ 20260112 è¡¨ç¤º 2026 å¹´ 1 æœˆ 12 æ—¥ï¼‰

### å®é™…åº”ç”¨ç¤ºä¾‹

å‡è®¾ä½ æœ‰ä¸€ä¸ª Go é¡¹ç›®ï¼Œæƒ³è¦ç”Ÿæˆé™¤æµ‹è¯•æ–‡ä»¶å¤–çš„æ‰€æœ‰æºä»£ç æ–‡æ¡£ï¼š

```bash
go run gen-docs.go -i ".go" -xm "_test.go" -o myproject-source-docs.md
```

æˆ–è€…ä½ æƒ³ç”Ÿæˆä¸€ä¸ªå‰ç«¯é¡¹ç›®çš„æ–‡æ¡£ï¼Œä½†æ’é™¤å‹ç¼©è¿‡çš„ JS æ–‡ä»¶ï¼š

```bash
go run gen-docs.go -i ".go,.js,.py" -x ".min.js" -xm "node_modules,test_" -max-size 200 -o comprehensive-docs.md
```

è¿™äº›ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æ ¹æ®ä¸åŒçš„éœ€æ±‚çµæ´»ä½¿ç”¨è¯¥å·¥å…·çš„å„ç§é€‰é¡¹æ¥ç”Ÿæˆå®šåˆ¶åŒ–çš„é¡¹ç›®æ–‡æ¡£ã€‚

## é…ç½®é€‰é¡¹å’Œè¿‡æ»¤è§„åˆ™è¯¦è§£

### é…ç½®é€‰é¡¹æ·±åº¦è§£æ

#### 1. åŸºæœ¬è·¯å¾„é€‰é¡¹
- **`-dir`**: æŒ‡å®šæ‰«æçš„æ ¹ç›®å½•
  - é»˜è®¤å€¼ï¼š`.`ï¼ˆå½“å‰å·¥ä½œç›®å½•ï¼‰
  - æ”¯æŒç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„
  - å¦‚æœæä¾›äº†ä½ç½®å‚æ•°ï¼Œå®ƒå°†è¦†ç›–æ­¤é€‰é¡¹

- **`-o`**: æŒ‡å®šè¾“å‡ºçš„ Markdown æ–‡ä»¶å
  - é»˜è®¤å€¼ï¼šè‡ªåŠ¨ç”Ÿæˆï¼ˆæ ¼å¼ï¼š`basename-YYYYMMDD-docs.md`ï¼‰
  - å¦‚æœä¸æŒ‡å®šï¼Œå·¥å…·ä¼šæ ¹æ®æ ¹ç›®å½•åç§°å’Œå½“å‰æ—¥æœŸç”Ÿæˆæ–‡ä»¶å

#### 2. åŒ…å«è¿‡æ»¤é€‰é¡¹
- **`-i`**: æŒ‡å®šè¦åŒ…å«çš„æ–‡ä»¶æ‰©å±•ååˆ—è¡¨
  - æ ¼å¼ï¼šé€—å·åˆ†éš”çš„æ‰©å±•åï¼Œå¦‚ `.go,.js,.py`
  - å¦‚æœè®¾ç½®äº†æ­¤é€‰é¡¹ï¼Œåªæœ‰æŒ‡å®šæ‰©å±•åçš„æ–‡ä»¶æ‰ä¼šè¢«è€ƒè™‘
  - å¦‚æœä¸è®¾ç½®ï¼Œåˆ™åŒ…å«æ‰€æœ‰æ‰©å±•åçš„æ–‡ä»¶ï¼ˆä»å—å…¶ä»–è§„åˆ™çº¦æŸï¼‰

- **`-m`**: æŒ‡å®šè¦åŒ…å«çš„è·¯å¾„å…³é”®è¯åˆ—è¡¨
  - æ ¼å¼ï¼šé€—å·åˆ†éš”çš„å…³é”®è¯ï¼Œå¦‚ `_test.go,config`
  - å¦‚æœè®¾ç½®äº†æ­¤é€‰é¡¹ï¼Œåªæœ‰è·¯å¾„ä¸­åŒ…å«ä»»ä¸€å…³é”®è¯çš„æ–‡ä»¶æ‰ä¼šè¢«è€ƒè™‘
  - å¦‚æœä¸è®¾ç½®ï¼Œåˆ™åŒ…å«æ‰€æœ‰è·¯å¾„çš„æ–‡ä»¶ï¼ˆä»å—å…¶ä»–è§„åˆ™çº¦æŸï¼‰

#### 3. æ’é™¤è¿‡æ»¤é€‰é¡¹
- **`-x`**: æŒ‡å®šè¦æ’é™¤çš„æ–‡ä»¶æ‰©å±•ååˆ—è¡¨
  - æ ¼å¼ï¼šé€—å·åˆ†éš”çš„æ‰©å±•åï¼Œå¦‚ `.exe,.o,.tmp`
  - ä¼˜å…ˆçº§é«˜äºåŒ…å«è§„åˆ™ï¼Œä¸€æ—¦åŒ¹é…ç«‹å³æ’é™¤

- **`-xm`**: æŒ‡å®šè¦æ’é™¤çš„è·¯å¾„å…³é”®è¯åˆ—è¡¨
  - æ ¼å¼ï¼šé€—å·åˆ†éš”çš„å…³é”®è¯ï¼Œå¦‚ `vendor/,node_modules/,temp/`
  - ä¼˜å…ˆçº§é«˜äºåŒ…å«è§„åˆ™ï¼Œä¸€æ—¦åŒ¹é…ç«‹å³æ’é™¤

#### 4. é™åˆ¶é€‰é¡¹
- **`-max-size`**: è®¾ç½®æœ€å¤§æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆå•ä½ï¼šKBï¼‰
  - é»˜è®¤å€¼ï¼š500KB
  - è¶…è¿‡æ­¤å¤§å°çš„æ–‡ä»¶ä¼šè¢«è·³è¿‡
  - ç”¨äºé˜²æ­¢è¿‡å¤§æ–‡ä»¶å½±å“æ€§èƒ½å’Œè¾“å‡ºæ–‡æ¡£å¤§å°

- **`-no-subdirs` æˆ– `-ns`**: æ§åˆ¶æ˜¯å¦æ‰«æå­ç›®å½•
  - é»˜è®¤å€¼ï¼šfalseï¼ˆæ‰«æå­ç›®å½•ï¼‰
  - è®¾ç½®ååªæ‰«ææŒ‡å®šç›®å½•çš„ç›´æ¥æ–‡ä»¶ï¼Œä¸é€’å½’å­ç›®å½•

#### 5. è¾“å‡ºæ§åˆ¶é€‰é¡¹
- **`-v`**: å¯ç”¨è¯¦ç»†è¾“å‡ºæ¨¡å¼
  - æ˜¾ç¤ºæ¯ä¸ªå¤„ç†æ­¥éª¤çš„è¯¦ç»†ä¿¡æ¯
  - æ˜¾ç¤ºè¢«æ·»åŠ ã€è·³è¿‡æˆ–æ’é™¤çš„æ–‡ä»¶ä¿¡æ¯

- **`-version`**: æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯å¹¶é€€å‡º
  - å½“å‰ç‰ˆæœ¬ï¼šv2.0.0
  - æ˜¾ç¤ºåç«‹å³é€€å‡ºç¨‹åº

### è¿‡æ»¤è§„åˆ™è¯¦è§£

#### è§„åˆ™ä¼˜å…ˆçº§å’Œé€»è¾‘

1. **é»˜è®¤å¿½ç•¥è§„åˆ™**ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
   - æ‰€æœ‰ä»¥ `.` å¼€å¤´çš„éšè—ç›®å½•ï¼ˆé™¤äº† `.` æœ¬èº«ï¼‰
   - é¢„å®šä¹‰çš„å¿½ç•¥ç›®å½•åˆ—è¡¨ï¼ˆå¦‚ `.git`, `node_modules`, `vendor` ç­‰ï¼‰
   - è¿™äº›è§„åˆ™åœ¨ç›®å½•éå†æ—¶ç«‹å³ç”Ÿæ•ˆï¼Œä¸ä¼šè¿›å…¥åç»­è¿‡æ»¤æµç¨‹

2. **åŸºç¡€è¿‡æ»¤è§„åˆ™**ï¼ˆæ¬¡é«˜ä¼˜å…ˆçº§ï¼‰
   - æ–‡ä»¶å¤§å°è¶…è¿‡ `MaxFileSize` é™åˆ¶
   - æ£€æµ‹ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶
   - è¿™äº›è§„åˆ™åœ¨æ–‡ä»¶çº§åˆ«åº”ç”¨

3. **æ’é™¤è§„åˆ™**ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
   - åŒ¹é… `-x` æŒ‡å®šçš„æ‰©å±•å
   - åŒ¹é… `-xm` æŒ‡å®šçš„è·¯å¾„å…³é”®è¯
   - ä¸€æ—¦åŒ¹é…æ’é™¤è§„åˆ™ï¼Œæ–‡ä»¶ç«‹å³è¢«è·³è¿‡

4. **åŒ…å«è§„åˆ™**ï¼ˆæ ‡å‡†ä¼˜å…ˆçº§ï¼‰
   - å¿…é¡»åŒæ—¶æ»¡è¶³æ‰©å±•åè¦æ±‚ï¼ˆå¦‚æœè®¾ç½®äº† `-i`ï¼‰
   - å¿…é¡»åŒæ—¶æ»¡è¶³è·¯å¾„å…³é”®è¯è¦æ±‚ï¼ˆå¦‚æœè®¾ç½®äº† `-m`ï¼‰
   - è¿™ä¸¤ä¸ªæ¡ä»¶ä½¿ç”¨ AND é€»è¾‘è¿æ¥

#### è¿‡æ»¤è§„åˆ™çš„ç»„åˆé€»è¾‘

##### åŒ…å«è§„åˆ™çš„ AND é€»è¾‘
å½“åŒæ—¶è®¾ç½®äº† `-i` å’Œ `-m` æ—¶ï¼Œæ–‡ä»¶å¿…é¡»åŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š
- æ–‡ä»¶æ‰©å±•ååœ¨ `-i` åˆ—è¡¨ä¸­
- æ–‡ä»¶è·¯å¾„åŒ…å« `-m` åˆ—è¡¨ä¸­çš„ä»»ä¸€å…³é”®è¯

ä¾‹å¦‚ï¼š
```bash
-i ".go,.js" -m "src,api"
```
åªæœ‰åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„æ–‡ä»¶æ‰ä¼šè¢«è€ƒè™‘ï¼š
- æ‰©å±•åä¸º `.go` æˆ– `.js`
- è·¯å¾„ä¸­åŒ…å« `src` æˆ– `api`

##### æ’é™¤è§„åˆ™çš„ OR é€»è¾‘
å½“åŒæ—¶è®¾ç½®äº† `-x` å’Œ `-xm` æ—¶ï¼Œåªè¦æ»¡è¶³ä»»ä¸€æ¡ä»¶å°±ä¼šè¢«æ’é™¤ï¼š
- æ–‡ä»¶æ‰©å±•ååœ¨ `-x` åˆ—è¡¨ä¸­
- æ–‡ä»¶è·¯å¾„åŒ…å« `-xm` åˆ—è¡¨ä¸­çš„ä»»ä¸€å…³é”®è¯

ä¾‹å¦‚ï¼š
```bash
-x ".tmp,.log" -xm "temp/,cache/"
```
ä»¥ä¸‹ä»»ä¸€æƒ…å†µéƒ½ä¼šå¯¼è‡´æ–‡ä»¶è¢«æ’é™¤ï¼š
- æ‰©å±•åä¸º `.tmp` æˆ– `.log`
- è·¯å¾„ä¸­åŒ…å« `temp/` æˆ– `cache/`

#### è¿‡æ»¤è§„åˆ™çš„å®é™…åº”ç”¨ç¤ºä¾‹

##### åœºæ™¯ 1ï¼šåªå¤„ç†ç‰¹å®šç±»å‹çš„æºä»£ç 
```bash
-i ".go,.js,.py" -o source-code.md
```
- åŒ…å«ï¼šæ‰€æœ‰ `.go`ã€`.js`ã€`.py` æ–‡ä»¶
- æ’é™¤ï¼šå…¶ä»–ç±»å‹æ–‡ä»¶
- ç»“æœï¼šåªç”Ÿæˆæºä»£ç æ–‡ä»¶çš„æ–‡æ¡£

##### åœºæ™¯ 2ï¼šæ’é™¤ç‰¹å®šç›®å½•å’Œæ–‡ä»¶ç±»å‹
```bash
-xm "vendor/,node_modules/,test_" -x ".log,.tmp" -o clean-docs.md
```
- æ’é™¤ï¼šè·¯å¾„åŒ…å« `vendor/`ã€`node_modules/`ã€`test_` çš„æ–‡ä»¶
- æ’é™¤ï¼šæ‰©å±•åä¸º `.log`ã€`.tmp` çš„æ–‡ä»¶
- ç»“æœï¼šç”Ÿæˆæ¸…ç†åçš„æ–‡æ¡£

##### åœºæ™¯ 3ï¼šå¤æ‚è¿‡æ»¤ç»„åˆ
```bash
-i ".go" -m "main,handler" -x ".pb.go" -xm "test_,mock"
```
- åŒ…å«ï¼šæ‰©å±•åä¸º `.go` ä¸”è·¯å¾„åŒ…å« `main` æˆ– `handler` çš„æ–‡ä»¶
- æ’é™¤ï¼šæ‰©å±•åä¸º `.pb.go` çš„æ–‡ä»¶
- æ’é™¤ï¼šè·¯å¾„åŒ…å« `test_` æˆ– `mock` çš„æ–‡ä»¶
- ç»“æœï¼šåªç”Ÿæˆä¸»é€»è¾‘ç›¸å…³çš„ Go æ–‡ä»¶æ–‡æ¡£

#### ç‰¹æ®Šå¤„ç†è§„åˆ™

1. **è¾“å‡ºæ–‡ä»¶è‡ªæ’é™¤**ï¼šç”Ÿæˆçš„è¾“å‡ºæ–‡ä»¶ä¸ä¼šè¢«åŒ…å«åœ¨æ‰«æç»“æœä¸­ï¼Œå³ä½¿å®ƒç¬¦åˆè¿‡æ»¤æ¡ä»¶

2. **å¤§å°é™åˆ¶å¤„ç†**ï¼šè¶…è¿‡å¤§å°é™åˆ¶çš„æ–‡ä»¶ä¼šè¢«é™é»˜è·³è¿‡ï¼Œé™¤éå¯ç”¨è¯¦ç»†æ¨¡å¼

3. **äºŒè¿›åˆ¶æ–‡ä»¶æ£€æµ‹**ï¼šè‡ªåŠ¨è·³è¿‡æ£€æµ‹ä¸ºäºŒè¿›åˆ¶çš„æ–‡ä»¶ï¼Œé˜²æ­¢æŸå Markdown è¾“å‡º

4. **è·¯å¾„è§„èŒƒåŒ–**ï¼šæ‰€æœ‰è·¯å¾„æ¯”è¾ƒéƒ½åŸºäºç›¸å¯¹äºæ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„

è¿™äº›è¿‡æ»¤è§„åˆ™çš„è®¾è®¡ä½¿å¾— `gen-docs.go` å·¥å…·èƒ½å¤Ÿçµæ´»é€‚åº”å„ç§é¡¹ç›®ç»“æ„å’Œæ–‡æ¡£éœ€æ±‚ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®å…·ä½“åœºæ™¯ç²¾ç¡®æ§åˆ¶å“ªäº›æ–‡ä»¶è¢«åŒ…å«åœ¨æœ€ç»ˆçš„æ–‡æ¡£ä¸­ã€‚

## ä»£ç ç»“æ„å’Œè®¾è®¡æ¨¡å¼åˆ†æ

### æ•´ä½“æ¶æ„

`gen-docs.go` é‡‡ç”¨äº†æ¸…æ™°çš„æ¨¡å—åŒ–è®¾è®¡ï¼ŒæŒ‰ç…§åŠŸèƒ½å°†ä»£ç ç»„ç»‡æˆä¸åŒçš„æ®µè½ï¼Œæ¯ä¸ªæ®µè½è´Ÿè´£ç‰¹å®šçš„åŠŸèƒ½åŸŸï¼š

```
â”œâ”€â”€ é…ç½®ä¸å…¨å±€å˜é‡ (Configuration & Globals)
â”œâ”€â”€ ä¸»å…¥å£ (Main Entry)
â”œâ”€â”€ å‚æ•°è§£æ (Flag Parsing)
â”œâ”€â”€ å¯åŠ¨ä¸æ‘˜è¦ (Startup & Summary)
â”œâ”€â”€ ç›®å½•æ‰«æ (Directory Scanning)
â”œâ”€â”€ å¿½ç•¥è§„åˆ™ (Ignore Rules)
â”œâ”€â”€ æ–‡ä»¶å·¥å…· (File Utilities)
â”œâ”€â”€ Markdown è¾“å‡º (Markdown Output)
â””â”€â”€ æ—¥å¿—è®°å½• (Logging)
```

### è®¾è®¡æ¨¡å¼åº”ç”¨

#### 1. é…ç½®é©±åŠ¨æ¨¡å¼ (Configuration-Driven Pattern)
é€šè¿‡ `Config` ç»“æ„ä½“é›†ä¸­ç®¡ç†æ‰€æœ‰é…ç½®é€‰é¡¹ï¼Œä½¿ç¨‹åºè¡Œä¸ºå®Œå…¨ç”±é…ç½®å†³å®šï¼š

```go
type Config struct {
    RootDir        string
    OutputFile     string
    IncludeExts    []string
    IncludeMatches []string
    ExcludeExts    []string
    ExcludeMatches []string
    MaxFileSize    int64
    NoSubdirs      bool
    Verbose        bool
    Version        bool
}
```

è¿™ç§è®¾è®¡ä½¿å¾—ç¨‹åºæ˜“äºæ‰©å±•å’Œç»´æŠ¤ï¼Œæ–°å¢é…ç½®é¡¹åªéœ€åœ¨ç»“æ„ä½“ä¸­æ·»åŠ å­—æ®µå³å¯ã€‚

#### 2. æ•°æ®ä¼ è¾“å¯¹è±¡ (DTO - Data Transfer Object)
ä½¿ç”¨ `FileMetadata` å’Œ `Stats` ç»“æ„ä½“ä½œä¸ºæ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œåœ¨ä¸åŒå‡½æ•°é—´ä¼ é€’æ•°æ®ï¼š

```go
type FileMetadata struct {
    RelPath   string  // ç›¸å¯¹è·¯å¾„
    FullPath  string  // å®Œæ•´è·¯å¾„
    Size      int64   // æ–‡ä»¶å¤§å°
    LineCount int     // è¡Œæ•°
}

type Stats struct {
    PotentialMatches   int   // ç¬¦åˆåŒ…å«è§„åˆ™çš„æ–‡ä»¶æ•°
    ExplicitlyExcluded int   // ç¬¦åˆåŒ…å«è§„åˆ™ä½†è¢«æ’é™¤è§„åˆ™è¸¢æ‰çš„æ–‡ä»¶æ•°
    FileCount          int   // æœ€ç»ˆå†™å…¥çš„æ–‡ä»¶æ•°
    TotalSize          int64 // æ€»å¤§å°
    TotalLines         int   // æ€»è¡Œæ•°
    Skipped            int   // å®Œå…¨ä¸åŒ¹é…è§„åˆ™çš„æ–‡ä»¶æ•°
}
```

#### 3. å•ä¸€èŒè´£åŸåˆ™ (Single Responsibility Principle)
æ¯ä¸ªå‡½æ•°éƒ½æœ‰æ˜ç¡®çš„å•ä¸€èŒè´£ï¼š

- `parseFlags()` - ä¸“é—¨å¤„ç†å‘½ä»¤è¡Œå‚æ•°è§£æ
- `scanDirectory()` - ä¸“é—¨å¤„ç†ç›®å½•æ‰«æå’Œæ–‡ä»¶è¿‡æ»¤
- `writeMarkdownStream()` - ä¸“é—¨å¤„ç† Markdown æ–‡æ¡£ç”Ÿæˆ
- `isBinaryFile()` - ä¸“é—¨å¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶æ£€æµ‹
- `detectLanguage()` - ä¸“é—¨å¤„ç†è¯­è¨€æ£€æµ‹

#### 4. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)
é€šè¿‡ `languageMap` å®ç°è¯­è¨€æ£€æµ‹ç­–ç•¥ï¼š

```go
var languageMap = map[string]string{
    ".go":    "go",
    ".js":    "javascript",
    ".py":    "python",
    // ...
}
```

è¿™ç§è®¾è®¡ä½¿å¾—æ·»åŠ æ–°çš„ç¼–ç¨‹è¯­è¨€æ”¯æŒå˜å¾—ç®€å•ï¼Œåªéœ€åœ¨æ˜ å°„è¡¨ä¸­æ·»åŠ æ–°æ¡ç›®ã€‚

#### 5. æµå¼å¤„ç†æ¨¡å¼ (Streaming Pattern)
é‡‡ç”¨æµå¼å¤„ç†é¿å…å°†æ•´ä¸ªé¡¹ç›®åŠ è½½åˆ°å†…å­˜ï¼š

```go
func writeMarkdownStream(cfg Config, files []FileMetadata, stats Stats) error {
    f, err := os.Create(cfg.OutputFile)
    if err != nil {
        return err
    }
    defer f.Close()

    w := bufio.NewWriterSize(f, 64*1024)  // ä½¿ç”¨ç¼“å†²å†™å…¥

    // åˆ†æ­¥å†™å…¥å¤´éƒ¨ã€ç›®å½•å’Œæ–‡ä»¶å†…å®¹
    // ...

    return w.Flush()
}
```

#### 6. æ¡ä»¶é€»è¾‘æ¨¡å¼ (Conditional Logic Pattern)
åœ¨ `shouldIgnoreFile` å‡½æ•°ä¸­ä½“ç°äº†å¤æ‚çš„æ¡ä»¶åˆ¤æ–­é€»è¾‘ï¼š

```go
func shouldIgnoreFile(relPath string, size int64, cfg Config) bool {
    // å¤§å°é™åˆ¶æ£€æŸ¥
    if size > cfg.MaxFileSize {
        return true
    }

    // æ’é™¤è§„åˆ™ä¼˜å…ˆ
    for _, e := range cfg.ExcludeExts {
        if ext == e {
            return true
        }
    }

    // åŒ…å«è§„åˆ™æ£€æŸ¥
    if len(cfg.IncludeExts) > 0 {
        found := false
        for _, i := range cfg.IncludeExts {
            if ext == i {
                found = true
                break
            }
        }
        if !found {
            return true
        }
    }

    // ...
}
```

### ä»£ç ç»„ç»‡ç‰¹ç‚¹

#### 1. åŠŸèƒ½åˆ†æ®µæ³¨é‡Š
ä½¿ç”¨åˆ†éš”çº¿æ³¨é‡Šå°†ä»£ç åˆ†æˆé€»è¾‘æ®µè½ï¼š

```go
/*
====================================================
 Configuration & Globals
====================================================
*/
```

è¿™ç§ç»„ç»‡æ–¹å¼æé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚

#### 2. é”™è¯¯å¤„ç†ç­–ç•¥
é‡‡ç”¨ä¸€è‡´çš„é”™è¯¯å¤„ç†æ¨¡å¼ï¼š

```go
if err != nil {
    fmt.Printf("âŒ æ‰«æå¤±è´¥: %v\n", err)
    os.Exit(1)
}
```

å¯¹äºéè‡´å‘½é”™è¯¯ï¼Œç¨‹åºä¼šè®°å½•å¹¶ç»§ç»­æ‰§è¡Œã€‚

#### 3. ç»Ÿè®¡ä¿¡æ¯æ”¶é›†
åœ¨æ•´ä¸ªå¤„ç†è¿‡ç¨‹ä¸­æŒç»­æ”¶é›†ç»Ÿè®¡ä¿¡æ¯ï¼Œæä¾›è¯¦ç»†çš„å¤„ç†åé¦ˆï¼š

```go
var stats Stats
// åœ¨æ‰«æè¿‡ç¨‹ä¸­æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
stats.PotentialMatches++
stats.FileCount++
stats.TotalLines += lineCount
stats.TotalSize += info.Size()
```

#### 4. æ€§èƒ½ä¼˜åŒ–æªæ–½
- ä½¿ç”¨ `bufio.Scanner` å’Œå¤§ç¼“å†²åŒºæé«˜ I/O æ€§èƒ½
- ä½¿ç”¨ `io.Copy` è€Œä¸æ˜¯é€è¡Œè¯»å–æ¥å¤åˆ¶æ–‡ä»¶å†…å®¹
- å¯¹æ–‡ä»¶è¡Œæ•°è®¡ç®—ä½¿ç”¨ä¼˜åŒ–çš„ç¼“å†²åŒºè®¾ç½®

#### 5. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- æä¾›è¿›åº¦æŒ‡ç¤ºå™¨ï¼ˆåœ¨å†™å…¥è¿‡ç¨‹ä¸­æ˜¾ç¤ºç™¾åˆ†æ¯”ï¼‰
- æä¾›è¯¦ç»†æ¨¡å¼ï¼ˆverboseï¼‰ç”¨äºè°ƒè¯•
- æä¾›æ¸…æ™°çš„å¯åŠ¨ä¿¡æ¯å’Œå®Œæˆæ‘˜è¦

### è®¾è®¡ä¼˜åŠ¿

1. **å¯æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ä½¿å¾—æ·»åŠ æ–°åŠŸèƒ½æˆ–ä¿®æ”¹ç°æœ‰åŠŸèƒ½å˜å¾—å®¹æ˜“
2. **å¯ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„å‡½æ•°èŒè´£åˆ†ç¦»å’Œè‰¯å¥½çš„æ³¨é‡Šç»„ç»‡
3. **å¥å£®æ€§**ï¼šå…¨é¢çš„é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µå¤„ç†
4. **æ€§èƒ½**ï¼šæµå¼å¤„ç†å’Œç¼“å†² I/O ä¼˜åŒ–
5. **ç”¨æˆ·ä½“éªŒ**ï¼šè¯¦ç»†çš„è¿›åº¦åé¦ˆå’Œæ¸…æ™°çš„è¾“å‡ºæ ¼å¼

è¿™ç§è®¾è®¡ä½“ç°äº† Go è¯­è¨€ç®€æ´ã€é«˜æ•ˆã€å®ç”¨çš„ç‰¹ç‚¹ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å‘½ä»¤è¡Œå·¥å…·è®¾è®¡èŒƒä¾‹ã€‚

## è¾“å‡ºæ ¼å¼å’Œç‰¹æ®Šå¤„ç†æœºåˆ¶

### è¾“å‡ºæ–‡ä»¶ç»“æ„

ç”Ÿæˆçš„ Markdown æ–‡æ¡£éµå¾ªä»¥ä¸‹ç»“æ„ï¼š

```
# Project Documentation
â”œâ”€â”€ ç”Ÿæˆä¿¡æ¯ï¼ˆæ—¶é—´ã€ç›®å½•ã€ç»Ÿè®¡ï¼‰
â”œâ”€â”€ ç›®å½•éƒ¨åˆ†ï¼ˆå¸¦é”šç‚¹çš„æ–‡ä»¶åˆ—è¡¨ï¼‰
â”œâ”€â”€ åˆ†éš”çº¿
â”œâ”€â”€ å„æ–‡ä»¶å†…å®¹ï¼ˆå¸¦è¯­æ³•é«˜äº®ï¼‰
â””â”€â”€ ç»Ÿè®¡æ±‡æ€»
```

### è¯¦ç»†è¾“å‡ºæ ¼å¼

#### 1. æ–‡æ¡£å¤´éƒ¨
```markdown
# Project Documentation

- **Generated at:** 2026-01-12 10:30:45
- **Root Dir:** `/path/to/project`
- **File Count:** 25
- **Total Size:** 125.67 KB
```

å¤´éƒ¨åŒ…å«ç”Ÿæˆæ—¶é—´ã€æºç›®å½•ã€æ–‡ä»¶æ•°é‡å’Œæ€»å¤§å°ç­‰å…ƒä¿¡æ¯ã€‚

#### 2. ç›®å½•éƒ¨åˆ†
```markdown
<a name="toc"></a>
## ğŸ“‚ æ‰«æç›®å½•
- [main.go](#ğŸ“„-maingo) (45 lines, 1.23 KB)
- [utils/helper.go](#ğŸ“„-utilshelpergo) (120 lines, 3.45 KB)
- [config/config.yaml](#ğŸ“„-configconfigyaml) (25 lines, 0.89 KB)
```

- ä¸ºæ¯ä¸ªæ–‡ä»¶åˆ›å»ºé”šç‚¹ï¼Œæ–¹ä¾¿åœ¨æ–‡æ¡£å†…è·³è½¬
- æ˜¾ç¤ºæ–‡ä»¶è·¯å¾„ã€è¡Œæ•°å’Œå¤§å°ä¿¡æ¯
- ä½¿ç”¨ `ğŸ“„` å›¾æ ‡æ ‡è¯†æ–‡ä»¶

#### 3. æ–‡ä»¶å†…å®¹éƒ¨åˆ†
```markdown
## ğŸ“„ src/main.go

```go
package main

import (
    "fmt"
    "os"
)

func main() {
    fmt.Println("Hello, World!")
}
```

[â¬† å›åˆ°ç›®å½•](#toc)
```

- æ¯ä¸ªæ–‡ä»¶ä»¥ `## ğŸ“„ æ–‡ä»¶è·¯å¾„` ä½œä¸ºæ ‡é¢˜
- ä½¿ç”¨å¯¹åº”ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•é«˜äº®
- æ¯ä¸ªæ–‡ä»¶æœ«å°¾æ·»åŠ è¿”å›ç›®å½•çš„é“¾æ¥

#### 4. ç»Ÿè®¡æ±‡æ€»
```markdown
---
### ğŸ“Š æœ€ç»ˆç»Ÿè®¡æ±‡æ€»
- **æ–‡ä»¶æ€»æ•°:** 25
- **ä»£ç æ€»è¡Œæ•°:** 1250
- **ç‰©ç†æ€»å¤§å°:** 125.67 KB
```

### ç‰¹æ®Šå¤„ç†æœºåˆ¶

#### 1. è¯­è¨€æ£€æµ‹æœºåˆ¶
é€šè¿‡ `detectLanguage` å‡½æ•°å®ç°ï¼š

```go
func detectLanguage(path string) string {
    ext := strings.ToLower(filepath.Ext(path))
    if lang, ok := languageMap[ext]; ok {
        return lang
    }
    return "text"  // é»˜è®¤ä¸ºçº¯æ–‡æœ¬
}
```

æ”¯æŒçš„è¯­è¨€åŒ…æ‹¬ï¼š
- ç¼–ç¨‹è¯­è¨€ï¼šGo, JavaScript, TypeScript, Python, Java, C/C++, Rust, Ruby, PHP ç­‰
- æ ‡è®°è¯­è¨€ï¼šHTML, CSS, Markdown, YAML, JSON ç­‰
- é…ç½®æ–‡ä»¶ï¼šXML, TOML, INI, conf ç­‰
- è„šæœ¬è¯­è¨€ï¼šShell, PowerShell, Ruby ç­‰

#### 2. é”šç‚¹ç”Ÿæˆæœºåˆ¶
ä¸ºæ¯ä¸ªæ–‡ä»¶ç”Ÿæˆå”¯ä¸€çš„é”šç‚¹ï¼Œä¾¿äºå†…éƒ¨è·³è½¬ï¼š

```go
// ç”Ÿæˆé”šç‚¹ï¼Œæ–¹ä¾¿åœ¨ Markdown ä¸­ç‚¹å‡»è·³è½¬
anchor := strings.ReplaceAll(file.RelPath, " ", "-")
anchor = strings.ReplaceAll(anchor, ".", "")
anchor = strings.ReplaceAll(anchor, "/", "")
anchor = strings.ToLower(anchor)
```

é”šç‚¹ç”Ÿæˆè§„åˆ™ï¼š
- ç©ºæ ¼æ›¿æ¢ä¸ºè¿å­—ç¬¦ `-`
- ç§»é™¤æ‰€æœ‰å¥ç‚¹ `.`
- ç§»é™¤æ‰€æœ‰æ–œæ  `/`
- è½¬æ¢ä¸ºå°å†™

#### 3. äºŒè¿›åˆ¶æ–‡ä»¶æ£€æµ‹æœºåˆ¶
é€šè¿‡å¤šé‡æ£€æŸ¥é˜²æ­¢äºŒè¿›åˆ¶æ–‡ä»¶æ±¡æŸ“è¾“å‡ºï¼š

```go
func isBinaryFile(path string) bool {
    // å¿«é€Ÿè·¯å¾„ï¼šå‹ç¼©æ–‡ä»¶
    if strings.Contains(path, ".min.") {
        return true
    }

    f, err := os.Open(path)
    if err != nil {
        return true
    }
    defer f.Close()

    // åªè¯»å‰ 512 å­—èŠ‚
    buf := make([]byte, 512)
    n, err := f.Read(buf)
    if err != nil && err != io.EOF {
        return false
    }
    buf = buf[:n]

    // NULL å­—èŠ‚æ£€æµ‹
    for _, b := range buf {
        if b == 0 {
            return true
        }
    }

    // UTF-8 æœ‰æ•ˆæ€§æ£€æµ‹
    return !utf8.Valid(buf)
}
```

æ£€æµ‹é€»è¾‘ï¼š
1. æ£€æŸ¥æ–‡ä»¶åæ˜¯å¦åŒ…å« `.min.`ï¼ˆé€šå¸¸è¡¨ç¤ºå‹ç¼©æ–‡ä»¶ï¼‰
2. æ£€æŸ¥æ–‡ä»¶å‰ 512 å­—èŠ‚æ˜¯å¦åŒ…å« NULL å­—èŠ‚
3. æ£€æŸ¥æ–‡ä»¶å‰ 512 å­—èŠ‚æ˜¯å¦ä¸ºæœ‰æ•ˆçš„ UTF-8 ç¼–ç 

#### 4. è¡Œæ•°ç»Ÿè®¡æœºåˆ¶
ä½¿ç”¨ä¼˜åŒ–çš„ç¼“å†²åŒºè®¾ç½®ç»Ÿè®¡æ–‡ä»¶è¡Œæ•°ï¼š

```go
func countLines(path string) (int, error) {
    f, err := os.Open(path)
    if err != nil {
        return 0, err
    }
    defer f.Close()

    count := 0
    scanner := bufio.NewScanner(f)
    // å¢åŠ ç¼“å†²åŒºä»¥æ”¯æŒè¶…é•¿è¡Œ
    buf := make([]byte, 0, 64*1024)
    scanner.Buffer(buf, 1024*1024)
    for scanner.Scan() {
        count++
    }
    return count, scanner.Err()
}
```

- ä½¿ç”¨å¤§ç¼“å†²åŒºï¼ˆ64KB åˆå§‹ï¼Œ1MB æœ€å¤§ï¼‰å¤„ç†å¯èƒ½çš„é•¿è¡Œ
- é¿å…å› å•è¡Œè¿‡é•¿å¯¼è‡´çš„æ‰«æå™¨é”™è¯¯

#### 5. æµå¼å†™å…¥æœºåˆ¶
ä½¿ç”¨ `io.Copy` å®ç°é«˜æ•ˆçš„æ–‡ä»¶å†…å®¹å¤åˆ¶ï¼š

```go
func copyFileContent(w *bufio.Writer, file FileMetadata) error {
    src, err := os.Open(file.FullPath)
    if err != nil {
        return err
    }
    defer src.Close()

    lang := detectLanguage(file.RelPath)

    fmt.Fprintln(w)
    fmt.Fprintf(w, "## ğŸ“„ %s\n\n", file.RelPath)
    fmt.Fprintf(w, "````%s\n", lang)

    // ä½¿ç”¨ io.Copy æ›¿ä»£ scannerï¼Œæ›´å®‰å…¨ä¸”ä¸é™è¡Œé•¿
    if _, err := io.Copy(w, src); err != nil {
        return err
    }

    fmt.Fprintln(w, "\n````")
    fmt.Fprintln(w, "\n[â¬† å›åˆ°ç›®å½•](#toc)")
    return nil
}
```

- ä½¿ç”¨ `io.Copy` é¿å…é€è¡Œè¯»å–çš„æ€§èƒ½å¼€é”€
- ä¸é™åˆ¶å•è¡Œé•¿åº¦ï¼Œé€‚åˆå¤„ç†å„ç§ç±»å‹çš„æ–‡æœ¬æ–‡ä»¶

#### 6. è¿›åº¦æŒ‡ç¤ºæœºåˆ¶
åœ¨å†™å…¥è¿‡ç¨‹ä¸­æä¾›å®æ—¶è¿›åº¦åé¦ˆï¼š

```go
total := len(files)
for i, file := range files {
    if !cfg.Verbose && (i%10 == 0 || i == total-1) {
        fmt.Printf("\rğŸš€ å†™å…¥è¿›åº¦: %d/%d (%.1f%%)", i+1, total, float64(i+1)/float64(total)*100)
    }
    // ...
}
```

- æ¯å¤„ç† 10 ä¸ªæ–‡ä»¶æˆ–æœ€åä¸€ä¸ªæ–‡ä»¶æ—¶æ›´æ–°è¿›åº¦
- ä½¿ç”¨ `\r` å®ç°åŸåœ°æ›´æ–°ï¼ŒèŠ‚çœå±å¹•ç©ºé—´
- ä½¿ç”¨ç«ç®­å›¾æ ‡ `ğŸš€` å¢åŠ è§†è§‰æ•ˆæœ

#### 7. é”™è¯¯æ¢å¤æœºåˆ¶
åœ¨é‡åˆ°å•ä¸ªæ–‡ä»¶é”™è¯¯æ—¶ç»§ç»­å¤„ç†å…¶ä»–æ–‡ä»¶ï¼š

```go
if err := copyFileContent(w, file); err != nil {
    logf(true, "\nâš  è¯»å–å¤±è´¥ %s: %v", file.RelPath, err)
    continue  // ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªæ–‡ä»¶
}
```

- å•ä¸ªæ–‡ä»¶é”™è¯¯ä¸å½±å“æ•´ä½“å¤„ç†æµç¨‹
- è®°å½•é”™è¯¯ä¿¡æ¯ä¾›ç”¨æˆ·å‚è€ƒ

è¿™äº›ç‰¹æ®Šå¤„ç†æœºåˆ¶ç¡®ä¿äº† `gen-docs.go` å·¥å…·èƒ½å¤Ÿç¨³å¥åœ°å¤„ç†å„ç§ç±»å‹çš„é¡¹ç›®å’Œæ–‡ä»¶ï¼Œç”Ÿæˆé«˜è´¨é‡çš„ Markdown æ–‡æ¡£ï¼ŒåŒæ—¶æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚

```

[â¬† å›åˆ°ç›®å½•](#toc)

## ğŸ“„ codoc.go

```go
package main

import (
	"bufio"
	"encoding/json"
	"flag"
	"fmt"
	"io"
	"io/fs"
	"os"
	"path/filepath"
	"sort"
	"strings"
	"time"
	"unicode/utf8"
)

/*
====================================================
 Codoc - Code Documentation Made Simple
 Configuration & Globals
====================================================
*/

var versionStr = "v2.1.0"

// Config é›†ä¸­ç®¡ç†é…ç½®
type Config struct {
	RootDir        string
	OutputFile     string
	IncludeExts    []string
	IncludeMatches []string
	ExcludeExts    []string
	ExcludeMatches []string
	MaxFileSize    int64
	NoSubdirs      bool
	Verbose        bool
	Version        bool
	ShowStats      bool
	JSONOutput     bool // è¾“å‡º JSON æ ¼å¼
}

// FileMetadata ä»…å­˜å‚¨å…ƒæ•°æ®ï¼Œä¸å­˜å†…å®¹
type FileMetadata struct {
	RelPath   string
	FullPath  string
	Size      int64
	LineCount int
}

// Stats ç»Ÿè®¡ä¿¡æ¯
type Stats struct {
	PotentialMatches   int // ç¬¦åˆåŒ…å«è§„åˆ™çš„æ–‡ä»¶æ•°
	ExplicitlyExcluded int // ç¬¦åˆåŒ…å«è§„åˆ™ä½†è¢«æ’é™¤è§„åˆ™è¸¢æ‰çš„æ–‡ä»¶æ•°
	FileCount          int // æœ€ç»ˆå†™å…¥çš„æ–‡ä»¶æ•°
	TotalSize          int64
	TotalLines         int
	Skipped            int // å®Œå…¨ä¸åŒ¹é…è§„åˆ™çš„æ–‡ä»¶æ•°
	DirCount           int // æ–‡ä»¶å¤¹æ•°é‡
}

// DirStats ç›®å½•ç»Ÿè®¡ä¿¡æ¯
type DirStats struct {
	Path       string
	FileCount  int
	TotalSize  int64
	TotalLines int
}

// ExtStats æ–‡ä»¶ç±»å‹ç»Ÿè®¡ä¿¡æ¯
type ExtStats struct {
	Ext       string
	FileCount int
	TotalSize int64
}

// ProjectOutput JSON è¾“å‡ºæ ¼å¼
type ProjectOutput struct {
	GeneratedAt string         `json:"generated_at"`
	RootDir     string         `json:"root_dir"`
	Stats       Stats          `json:"stats"`
	Files       []FileMetadata `json:"files"`
	Directories []DirStats     `json:"directories,omitempty"`
	Extensions  []ExtStats     `json:"extensions,omitempty"`
}

var defaultIgnorePatterns = []string{
	".git", ".idea", ".vscode", ".svn", ".hg",
	"node_modules", "vendor", "dist", "build", "target", "bin", "out", "release", "debug",
	"__pycache__", ".pytest_cache", ".tox", ".coverage", "coverage.xml",
	".DS_Store", ".env", ".venv", "venv", "env",
	"package-lock.json", "yarn.lock", "go.sum", "composer.lock", "Gemfile.lock",
	"*.log", "*.tmp", "*.temp", "*.cache", "*.swp", "*.swo",
	"tags", "TAGS", "*.pid", "*.seed", "*.idx",
	"Pods", "Carthage", "CocoaPods", ".xcassets",
	"obj", "ipch", "*.user", "*.userosscache", "*.sln.docstates",
	"*.VC.db", "*.VC.VC.opendb", "Debug", "Release", "x64", "x86", "arm64",
	"*.aps", "*.ncb", "*.opendb", "*.opensdf", "*.sdf", "*.cachefile", "*.VC.VC.opendb",
	"cmake-build-*", ".gradle", "build", ".sonar", ".scannerwork",
	"*.tgz", "*.tar.gz", "*.zip", "*.rar", "*.7z",
	"logs", "tmp", "temp", "cache", ".history", ".nyc_output",
}

// è¯­è¨€æ˜ å°„è¡¨ï¼ˆå…¨å±€é…ç½®ï¼Œä¾¿äºæ‰©å±•ï¼‰
var languageMap = map[string]string{
	".go":    "go",
	".js":    "javascript",
	".ts":    "typescript",
	".tsx":   "typescript",
	".jsx":   "javascript",
	".py":    "python",
	".java":  "java",
	".c":     "c",
	".cpp":   "cpp",
	".cc":    "cpp",
	".cxx":   "cpp",
	".h":     "c",
	".hpp":   "cpp",
	".rs":    "rust",
	".rb":    "ruby",
	".php":   "php",
	".cs":    "csharp",
	".swift": "swift",
	".kt":    "kotlin",
	".scala": "scala",
	".r":     "r",
	".sql":   "sql",
	".sh":    "bash",
	".bash":  "bash",
	".zsh":   "bash",
	".fish":  "fish",
	".ps1":   "powershell",
	".md":    "markdown",
	".html":  "html",
	".htm":   "html",
	".css":   "css",
	".scss":  "scss",
	".sass":  "sass",
	".less":  "less",
	".xml":   "xml",
	".json":  "json",
	".yaml":  "yaml",
	".yml":   "yaml",
	".toml":  "toml",
	".ini":   "ini",
	".conf":  "conf",
	".txt":   "text",
}

/*
====================================================
 Main Entry
====================================================
*/

func main() {
	cfg := parseFlags()

	// å¦‚æœæ˜¯ç»Ÿè®¡æ¨¡å¼ï¼Œæ‰§è¡Œç»Ÿè®¡å¹¶é€€å‡º
	if cfg.ShowStats {
		if err := showProjectStats(cfg); err != nil {
			fmt.Printf("âŒ ç»Ÿè®¡å¤±è´¥: %v\n", err)
			os.Exit(1)
		}
		return
	}

	if !cfg.JSONOutput {
		printStartupInfo(cfg)
	}

	// Phase 1: æ‰«ææ–‡ä»¶ç»“æ„
	if !cfg.JSONOutput {
		fmt.Println("â³ æ­£åœ¨æ‰«ææ–‡ä»¶ç»“æ„...")
	}
	files, stats, err := scanDirectory(cfg)
	if err != nil {
		fmt.Printf("âŒ æ‰«æå¤±è´¥: %v\n", err)
		os.Exit(1)
	}

	// Phase 2: è¾“å‡ºï¼ˆJSON æˆ– Markdownï¼‰
	if cfg.JSONOutput {
		if err := writeJSONOutput(cfg, files, stats); err != nil {
			fmt.Printf("âŒ JSON è¾“å‡ºå¤±è´¥: %v\n", err)
			os.Exit(1)
		}
	} else {
		fmt.Printf("ğŸ’¾ æ­£åœ¨å†™å…¥æ–‡æ¡£ [æ–‡ä»¶æ•°: %d]...\n", len(files))
		if err := writeMarkdownStream(cfg, files, stats); err != nil {
			fmt.Printf("âŒ å†™å…¥å¤±è´¥: %v\n", err)
			os.Exit(1)
		}
		printSummary(stats, cfg.OutputFile)
	}
}

/*
====================================================
 Flag Parsing
====================================================
*/

func parseFlags() Config {
	var cfg Config
	var include, match, exclude, excludeMatch string
	var maxKB int64

	flag.StringVar(&cfg.RootDir, "dir", ".", "Root directory to scan")
	flag.StringVar(&cfg.OutputFile, "o", "", "Output markdown file")
	flag.StringVar(&include, "i", "", "Include extensions (e.g. .go,.js)")
	flag.StringVar(&match, "m", "", "Include path keywords (e.g. _test.go)")
	flag.StringVar(&exclude, "x", "", "Exclude extensions (e.g. .exe,.o)")
	flag.StringVar(&excludeMatch, "xm", "", "Exclude path keywords (e.g. vendor/,node_modules/)")
	flag.Int64Var(&maxKB, "max-size", 500, "Max file size in KB")
	flag.BoolVar(&cfg.NoSubdirs, "no-subdirs", false, "Do not scan subdirectories")
	var nsAlias bool
	flag.BoolVar(&nsAlias, "ns", false, "Alias for --no-subdirs")
	flag.BoolVar(&cfg.Verbose, "v", false, "Verbose output")
	flag.BoolVar(&cfg.Version, "version", false, "Show version")
	flag.BoolVar(&cfg.ShowStats, "s", false, "Show project statistics")
	flag.BoolVar(&cfg.JSONOutput, "json", false, "Output in JSON format")

	flag.Parse()

	if nsAlias {
		cfg.NoSubdirs = true
	}

	if cfg.Version {
		fmt.Printf("codoc %s\n", versionStr)
		os.Exit(0)
	}

	// æ”¯æŒä½ç½®å‚æ•°
	if args := flag.Args(); len(args) > 0 {
		cfg.RootDir = args[0]
	}

	cfg.RootDir, _ = filepath.Abs(cfg.RootDir)

	// JSON è¾“å‡ºæ—¶ä¿®æ­£é»˜è®¤è¾“å‡ºè¡Œä¸º
	if cfg.JSONOutput {
		if cfg.OutputFile != "" && strings.HasSuffix(cfg.OutputFile, ".md") {
			cfg.OutputFile = strings.TrimSuffix(cfg.OutputFile, ".md") + ".json"
		}
	}

	// è‡ªåŠ¨ç”Ÿæˆè¾“å‡ºæ–‡ä»¶å
	if cfg.OutputFile == "" {
		baseName := "project"
		cleanRoot := filepath.Clean(cfg.RootDir)

		if cleanRoot == "." || cleanRoot == string(filepath.Separator) {
			// å¦‚æœæ˜¯å½“å‰ç›®å½•ï¼Œå°è¯•è·å–æ–‡ä»¶å¤¹çœŸå®åç§°
			if abs, err := filepath.Abs(cleanRoot); err == nil {
				baseName = filepath.Base(abs)
			}
		} else {
			// å°†è·¯å¾„ä¸­çš„åˆ†éš”ç¬¦å’Œç‚¹æ›¿æ¢ä¸ºä¸‹åˆ’çº¿
			baseName = cleanRoot
			baseName = strings.ReplaceAll(baseName, string(filepath.Separator), "_")
			baseName = strings.ReplaceAll(baseName, ".", "_")
			// æ¸…ç†è¿ç»­çš„ä¸‹åˆ’çº¿
			for strings.Contains(baseName, "__") {
				baseName = strings.ReplaceAll(baseName, "__", "_")
			}
			baseName = strings.Trim(baseName, "_")
		}

		date := time.Now().Format("20060102")
		ext := "md"
		if cfg.JSONOutput {
			ext = "json"
		}
		cfg.OutputFile = fmt.Sprintf("%s-%s-codoc.%s", baseName, date, ext)
	}

	cfg.IncludeExts = normalizeExts(include)
	cfg.IncludeMatches = splitAndTrim(match)
	cfg.ExcludeExts = normalizeExts(exclude)
	cfg.ExcludeMatches = splitAndTrim(excludeMatch)

	// ä»é…ç½®æ–‡ä»¶åŠ è½½é¢å¤–çš„å¿½ç•¥è§„åˆ™
	additionalExcludes, additionalExcludeMatches := loadIgnoreFile(cfg.RootDir)
	cfg.ExcludeExts = mergeStringSlices(cfg.ExcludeExts, additionalExcludes)
	cfg.ExcludeMatches = mergeStringSlices(cfg.ExcludeMatches, additionalExcludeMatches)

	cfg.MaxFileSize = maxKB * 1024

	return cfg
}

func splitAndTrim(input string) []string {
	if input == "" {
		return nil
	}
	parts := strings.Split(input, ",")
	var result []string
	for _, p := range parts {
		p = strings.TrimSpace(p)
		if p != "" {
			result = append(result, p)
		}
	}
	return result
}

// ä»é…ç½®æ–‡ä»¶åŠ è½½å¿½ç•¥è§„åˆ™
func loadIgnoreFile(rootDir string) ([]string, []string) {
	var excludeExts []string
	var excludeMatches []string

	// å°è¯•å¤šä¸ªå¯èƒ½çš„é…ç½®æ–‡ä»¶å
	possibleFiles := []string{".codoc-ignore", ".gen-docs-ignore", ".gdocsignore", ".docs-ignore"}

	for _, filename := range possibleFiles {
		configPath := filepath.Join(rootDir, filename)

		// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
		if _, err := os.Stat(configPath); os.IsNotExist(err) {
			continue
		}

		// è¯»å–é…ç½®æ–‡ä»¶
		content, err := os.ReadFile(configPath)
		if err != nil {
			logf(true, "âš  æ— æ³•è¯»å–å¿½ç•¥é…ç½®æ–‡ä»¶ %s: %v", configPath, err)
			continue
		}

		logf(true, "âœ“ å‘ç°å¿½ç•¥é…ç½®æ–‡ä»¶: %s", configPath)

		// è§£æé…ç½®æ–‡ä»¶å†…å®¹
		scanner := bufio.NewScanner(strings.NewReader(string(content)))
		for scanner.Scan() {
			line := strings.TrimSpace(scanner.Text())

			// è·³è¿‡ç©ºè¡Œå’Œæ³¨é‡Šè¡Œ
			if line == "" || strings.HasPrefix(line, "#") {
				continue
			}

			// æ ¹æ®è¡Œçš„å†…å®¹åˆ¤æ–­æ˜¯æ‰©å±•åè¿˜æ˜¯è·¯å¾„åŒ¹é…
			if strings.HasPrefix(line, ".") {
				// è¿™æ˜¯ä¸€ä¸ªæ‰©å±•åï¼ˆä¾‹å¦‚ .log, .tmpï¼‰
				excludeExts = append(excludeExts, strings.ToLower(line))
			} else {
				// è¿™æ˜¯ä¸€ä¸ªè·¯å¾„åŒ¹é…æ¨¡å¼ï¼ˆä¾‹å¦‚ vendor/, node_modules/ï¼‰
				excludeMatches = append(excludeMatches, line)
			}
		}

		if err := scanner.Err(); err != nil {
			logf(true, "âš  è¯»å–å¿½ç•¥é…ç½®æ–‡ä»¶æ—¶å‡ºé”™ %s: %v", configPath, err)
		}

		// æ‰¾åˆ°å¹¶æˆåŠŸè§£æäº†ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œè·³å‡ºå¾ªç¯
		break
	}

	return excludeExts, excludeMatches
}

// åˆå¹¶ä¸¤ä¸ªå­—ç¬¦ä¸²åˆ‡ç‰‡ï¼Œé¿å…é‡å¤
func mergeStringSlices(base, additional []string) []string {
	// ä½¿ç”¨ map æ¥è·Ÿè¸ªå·²å­˜åœ¨çš„å…ƒç´ ï¼Œé¿å…é‡å¤
	seen := make(map[string]bool)
	var result []string

	// å…ˆæ·»åŠ åŸºç¡€åˆ‡ç‰‡ä¸­çš„å…ƒç´ 
	for _, item := range base {
		if !seen[item] {
			seen[item] = true
			result = append(result, item)
		}
	}

	// å†æ·»åŠ é™„åŠ åˆ‡ç‰‡ä¸­çš„å…ƒç´ 
	for _, item := range additional {
		if !seen[item] {
			seen[item] = true
			result = append(result, item)
		}
	}

	return result
}

/*
====================================================
 Startup & Summary
====================================================
*/

func printStartupInfo(cfg Config) {
	fmt.Println("â–¶ Codoc Started")
	fmt.Printf("  Root: %s\n", cfg.RootDir)
	fmt.Printf("  Out : %s\n", cfg.OutputFile)
	fmt.Printf("  Max : %d KB\n", cfg.MaxFileSize/1024)
	if len(cfg.IncludeExts) > 0 {
		fmt.Printf("  Only Ext: %v\n", cfg.IncludeExts)
	}
	if len(cfg.IncludeMatches) > 0 {
		fmt.Printf("  Match   : %v\n", cfg.IncludeMatches)
	}
	if len(cfg.ExcludeExts) > 0 {
		fmt.Printf("  Skip Ext: %v\n", cfg.ExcludeExts)
	}
	if len(cfg.ExcludeMatches) > 0 {
		fmt.Printf("  Skip Key: %v\n", cfg.ExcludeMatches)
	}
	fmt.Println()
}

func printSummary(stats Stats, output string) {
	fmt.Println("\nâœ” å®Œæˆ!")
	fmt.Printf("  ç¬¦åˆåŒ…å«è§„åˆ™ (Potential) : %d\n", stats.PotentialMatches)
	fmt.Printf("  ç”±äºæ’é™¤è§„åˆ™è¢«è¸¢é™¤ (Excluded): %d\n", stats.ExplicitlyExcluded)
	fmt.Printf("  æœ€ç»ˆå†™å…¥æ–‡ä»¶æ•° (Final)    : %d\n", stats.FileCount)
	fmt.Printf("  æ€»è¡Œæ•° (Total Lines)      : %d\n", stats.TotalLines)
	fmt.Printf("  æ€»ç‰©ç†å¤§å° (Total Size)   : %.2f KB\n", float64(stats.TotalSize)/1024)
	fmt.Printf("  æ— éœ€å¤„ç†çš„æ— å…³æ–‡ä»¶          : %d\n", stats.Skipped)
	fmt.Printf("  è¾“å‡ºè·¯å¾„                  : %s\n", output)
}

/*
====================================================
 Directory Scanning
====================================================
*/

func scanDirectory(cfg Config) ([]FileMetadata, Stats, error) {
	var files []FileMetadata
	var stats Stats

	absOutput, _ := filepath.Abs(cfg.OutputFile)

	err := filepath.WalkDir(cfg.RootDir, func(path string, d fs.DirEntry, err error) error {
		if err != nil {
			logf(cfg.Verbose, "âš  æ— æ³•è®¿é—®: %s", path)
			stats.Skipped++
			return nil
		}

		relPath, _ := filepath.Rel(cfg.RootDir, path)
		if relPath == "." {
			return nil
		}

		// å¤„ç†ç›®å½•
		if d.IsDir() {
			if cfg.NoSubdirs && relPath != "." {
				return filepath.SkipDir
			}
			if shouldIgnoreDir(d.Name()) {
				logf(cfg.Verbose, "âŠ˜ è·³è¿‡ç›®å½•: %s", relPath)
				return filepath.SkipDir
			}
			return nil
		}

		// æ’é™¤è¾“å‡ºæ–‡ä»¶è‡ªèº«
		if absPath, _ := filepath.Abs(path); absPath == absOutput {
			return nil
		}

		// è·å–æ–‡ä»¶ä¿¡æ¯
		info, err := d.Info()
		if err != nil {
			return nil
		}

		// --- ç»†åŒ–è¿‡æ»¤é€»è¾‘ ---
		// 1. åŸºç¡€è¿‡æ»¤ï¼šè¿‡å¤§æˆ–äºŒè¿›åˆ¶
		if info.Size() > cfg.MaxFileSize || isBinaryFile(path) {
			stats.Skipped++
			return nil
		}

		// 2. æ£€æŸ¥æ˜¯å¦ç¬¦åˆâ€œåŒ…å«â€æ„å›¾
		isIncluded := true
		if len(cfg.IncludeExts) > 0 || len(cfg.IncludeMatches) > 0 {
			extMatched := false
			if len(cfg.IncludeExts) > 0 {
				ext := strings.ToLower(filepath.Ext(relPath))
				for _, e := range cfg.IncludeExts {
					if ext == e {
						extMatched = true
						break
					}
				}
			} else {
				extMatched = true // å¦‚æœæ²¡è®¾åç¼€ç™½åå•ï¼Œé»˜è®¤åç¼€é€šè¿‡
			}

			pathMatched := false
			if len(cfg.IncludeMatches) > 0 {
				for _, m := range cfg.IncludeMatches {
					if strings.Contains(relPath, m) {
						pathMatched = true
						break
					}
				}
			} else {
				pathMatched = true // å¦‚æœæ²¡è®¾å…³é”®å­—åŒ¹é…ï¼Œé»˜è®¤è·¯å¾„é€šè¿‡
			}
			isIncluded = extMatched && pathMatched
		}

		if !isIncluded {
			stats.Skipped++
			return nil
		}

		// 3. ç¬¦åˆåŒ…å«æ„å›¾ (Potential Match)
		stats.PotentialMatches++

		// 4. æ£€æŸ¥æ˜¯å¦è¢«â€œæ’é™¤â€è§„åˆ™æ‹¦æˆª
		isExcluded := false
		ext := strings.ToLower(filepath.Ext(relPath))
		for _, e := range cfg.ExcludeExts {
			if ext == e {
				isExcluded = true
				break
			}
		}
		if !isExcluded && len(cfg.ExcludeMatches) > 0 {
			for _, m := range cfg.ExcludeMatches {
				if strings.Contains(relPath, m) {
					isExcluded = true
					break
				}
			}
		}

		if isExcluded {
			stats.ExplicitlyExcluded++
			return nil
		}

		// --- æœ€ç»ˆé€šè¿‡ ---
		lineCount, _ := countLines(path)
		files = append(files, FileMetadata{
			RelPath:   relPath,
			FullPath:  path,
			Size:      info.Size(),
			LineCount: lineCount,
		})
		stats.FileCount++
		stats.TotalLines += lineCount
		stats.TotalSize += info.Size()

		logf(cfg.Verbose, "âœ“ æ·»åŠ : %s (%d lines)", relPath, lineCount)
		return nil
	})

	// æ’åºä¿è¯è¾“å‡ºä¸€è‡´æ€§
	sort.Slice(files, func(i, j int) bool {
		return files[i].RelPath < files[j].RelPath
	})

	return files, stats, err
}

/*
====================================================
 Ignore Rules
====================================================
*/

func shouldIgnoreDir(name string) bool {
	if strings.HasPrefix(name, ".") && name != "." {
		return true
	}
	for _, pattern := range defaultIgnorePatterns {
		if strings.Contains(name, pattern) {
			return true
		}
	}
	return false
}

// shouldIgnoreFile å·²åºŸå¼ƒ - è¿‡æ»¤é€»è¾‘å·²ç»Ÿä¸€åˆ° scanDirectory ä¸­

/*
====================================================
 File Utilities
====================================================
*/

func normalizeExts(input string) []string {
	if input == "" {
		return nil
	}
	parts := strings.Split(input, ",")
	var exts []string
	for _, p := range parts {
		p = strings.TrimSpace(strings.ToLower(p))
		if !strings.HasPrefix(p, ".") {
			p = "." + p
		}
		exts = append(exts, p)
	}
	return exts
}

func isBinaryFile(path string) bool {
	// å¿«é€Ÿè·¯å¾„ 1: å‹ç¼©æ–‡ä»¶ (ä»…åŒ¹é… .min.js, .min.css ç­‰å¸¸è§åç¼€)
	// é¿å…è¯¯ä¼¤ admin.go, terminal.py ç­‰
	if strings.HasSuffix(path, ".min.js") || strings.HasSuffix(path, ".min.css") || strings.HasSuffix(path, ".min.html") {
		return true
	}

	// å¿«é€Ÿè·¯å¾„ 2: å·²çŸ¥æ–‡æœ¬ç±»å‹æ‰©å±•åç›´æ¥è·³è¿‡ IO æ£€æµ‹
	ext := strings.ToLower(filepath.Ext(path))
	if _, ok := languageMap[ext]; ok {
		return false // å·²çŸ¥æ–‡æœ¬ç±»å‹ï¼Œæ— éœ€æ£€æµ‹
	}

	f, err := os.Open(path)
	if err != nil {
		return true
	}
	defer f.Close()

	// åªè¯»å‰ 512 å­—èŠ‚
	buf := make([]byte, 512)
	n, err := f.Read(buf)
	if err != nil && err != io.EOF {
		return true // è¯»å–é”™è¯¯æ—¶ä¿å®ˆå¤„ç†ï¼Œè§†ä¸ºäºŒè¿›åˆ¶ï¼ˆæˆ–è€…è·³è¿‡ï¼‰
	}
	buf = buf[:n]

	// NULL å­—èŠ‚æ£€æµ‹
	for _, b := range buf {
		if b == 0 {
			return true
		}
	}

	// UTF-8 æœ‰æ•ˆæ€§æ£€æµ‹
	return !utf8.Valid(buf)
}

func detectLanguage(path string) string {
	ext := strings.ToLower(filepath.Ext(path))
	if lang, ok := languageMap[ext]; ok {
		return lang
	}
	return "text"
}

// makeGitHubAnchor ç”Ÿæˆç¬¦åˆ GitHub è§„èŒƒçš„ Markdown é”šç‚¹
// GitHub è§„åˆ™ï¼šå°å†™åŒ–ã€éå­—æ¯æ•°å­—è½¬ä¸º -ã€è¿ç»­ - åˆå¹¶
func makeGitHubAnchor(s string) string {
	var result strings.Builder
	lastWasDash := false

	for _, r := range strings.ToLower(s) {
		if (r >= 'a' && r <= 'z') || (r >= '0' && r <= '9') {
			result.WriteRune(r)
			lastWasDash = false
		} else if !lastWasDash {
			result.WriteRune('-')
			lastWasDash = true
		}
	}

	// ç§»é™¤é¦–å°¾çš„æ¨ªæ 
	anchor := strings.Trim(result.String(), "-")
	return anchor
}

/*
====================================================
 Markdown Output
====================================================
*/

func writeMarkdownStream(cfg Config, files []FileMetadata, stats Stats) error {
	f, err := os.Create(cfg.OutputFile)
	if err != nil {
		return err
	}
	defer f.Close()

	w := bufio.NewWriterSize(f, 64*1024)

	// å†™å…¥å¤´éƒ¨
	fmt.Fprintln(w, "# Project Documentation")
	fmt.Fprintln(w)
	fmt.Fprintf(w, "- **Generated at:** %s\n", time.Now().Format("2006-01-02 15:04:05"))
	fmt.Fprintf(w, "- **Root Dir:** `%s`\n", cfg.RootDir)
	fmt.Fprintf(w, "- **File Count:** %d\n", stats.FileCount)
	fmt.Fprintf(w, "- **Total Size:** %.2f KB\n", float64(stats.TotalSize)/1024)
	fmt.Fprintln(w)

	// å†™å…¥ç›®å½•
	fmt.Fprintln(w, "<a name=\"toc\"></a>")
	fmt.Fprintln(w, "## ğŸ“‚ æ‰«æç›®å½•")
	for _, file := range files {
		// ç”Ÿæˆç¬¦åˆ GitHub è§„èŒƒçš„é”šç‚¹
		anchor := makeGitHubAnchor(file.RelPath)
		fmt.Fprintf(w, "- [%s](#%s) (%d lines, %.2f KB)\n", file.RelPath, anchor, file.LineCount, float64(file.Size)/1024)
	}
	fmt.Fprintln(w, "\n---")

	// æµå¼å†™å…¥æ–‡ä»¶å†…å®¹
	total := len(files)
	for i, file := range files {
		if !cfg.Verbose && (i%10 == 0 || i == total-1) {
			fmt.Printf("\rğŸš€ å†™å…¥è¿›åº¦: %d/%d (%.1f%%)", i+1, total, float64(i+1)/float64(total)*100)
		}

		if err := copyFileContent(w, file); err != nil {
			logf(true, "\nâš  è¯»å–å¤±è´¥ %s: %v", file.RelPath, err)
			continue
		}
	}
	fmt.Println()

	//ã€è¡¥å……ç»Ÿè®¡ã€‘
	fmt.Fprintln(w, "\n---")
	fmt.Fprintf(w, "### ğŸ“Š æœ€ç»ˆç»Ÿè®¡æ±‡æ€»\n")
	fmt.Fprintf(w, "- **æ–‡ä»¶æ€»æ•°:** %d\n", stats.FileCount)
	fmt.Fprintf(w, "- **ä»£ç æ€»è¡Œæ•°:** %d\n", stats.TotalLines)
	fmt.Fprintf(w, "- **ç‰©ç†æ€»å¤§å°:** %.2f KB\n", float64(stats.TotalSize)/1024)

	return w.Flush()
}

func copyFileContent(w *bufio.Writer, file FileMetadata) error {
	src, err := os.Open(file.FullPath)
	if err != nil {
		return err
	}
	defer src.Close()

	lang := detectLanguage(file.RelPath)

	fmt.Fprintln(w)
	fmt.Fprintf(w, "## ğŸ“„ %s\n\n", file.RelPath)
	// anchor ç”± GitHub è‡ªåŠ¨ç”Ÿæˆï¼ˆemoji ä¸å‚ä¸ï¼‰
	fmt.Fprintf(w, "```%s\n", lang)

	// ä½¿ç”¨ io.Copy æ›¿ä»£ scannerï¼Œæ›´å®‰å…¨ä¸”ä¸é™è¡Œé•¿
	if _, err := io.Copy(w, src); err != nil {
		return err
	}

	fmt.Fprintln(w, "\n```")
	fmt.Fprintln(w, "\n[â¬† å›åˆ°ç›®å½•](#toc)")
	return nil
}

func countLines(path string) (int, error) {
	f, err := os.Open(path)
	if err != nil {
		return 0, err
	}
	defer f.Close()

	count := 0
	scanner := bufio.NewScanner(f)
	// å¢åŠ ç¼“å†²åŒºä»¥æ”¯æŒè¶…é•¿è¡Œ
	buf := make([]byte, 0, 64*1024)
	scanner.Buffer(buf, 1024*1024)
	for scanner.Scan() {
		count++
	}
	return count, scanner.Err()
}

/*
====================================================
 Logging
====================================================
*/

func logf(verbose bool, format string, a ...any) {
	if verbose {
		fmt.Printf(format+"\n", a...)
	}
}

/*
====================================================
 JSON Output
====================================================
*/

func writeJSONOutput(cfg Config, files []FileMetadata, stats Stats) error {
	output := ProjectOutput{
		GeneratedAt: time.Now().Format("2006-01-02 15:04:05"),
		RootDir:     cfg.RootDir,
		Stats:       stats,
		Files:       files,
	}

	var jsonData []byte
	var err error

	// ç¾åŒ–è¾“å‡º
	jsonData, err = json.MarshalIndent(output, "", "  ")
	if err != nil {
		return fmt.Errorf("JSON åºåˆ—åŒ–å¤±è´¥: %w", err)
	}

	// å¦‚æœæŒ‡å®šäº†è¾“å‡ºæ–‡ä»¶ï¼Œå†™å…¥æ–‡ä»¶ï¼›å¦åˆ™è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º
	if cfg.OutputFile != "" {
		if err := os.WriteFile(cfg.OutputFile, jsonData, 0644); err != nil {
			return fmt.Errorf("å†™å…¥æ–‡ä»¶å¤±è´¥: %w", err)
		}
		fmt.Printf("âœ… JSON å·²å†™å…¥: %s\n", cfg.OutputFile)
	} else {
		fmt.Println(string(jsonData))
	}

	return nil
}

/*
====================================================
 Project Statistics
====================================================
*/

func showProjectStats(cfg Config) error {
	fmt.Println("ğŸ“Š æ­£åœ¨ç»Ÿè®¡é¡¹ç›®ä¿¡æ¯...")
	fmt.Printf("  Root: %s\n\n", cfg.RootDir)

	var files []FileMetadata
	dirMap := make(map[string]*DirStats)
	extMap := make(map[string]*ExtStats)
	var stats Stats
	absOutput, _ := filepath.Abs(cfg.OutputFile)

	err := filepath.WalkDir(cfg.RootDir, func(path string, d fs.DirEntry, err error) error {
		if err != nil {
			return nil
		}

		relPath, _ := filepath.Rel(cfg.RootDir, path)
		if relPath == "." {
			return nil
		}

		// å¤„ç†ç›®å½•
		if d.IsDir() {
			if shouldIgnoreDir(d.Name()) {
				return filepath.SkipDir
			}
			stats.DirCount++
			dirMap[relPath] = &DirStats{Path: relPath}
			return nil
		}

		// æ’é™¤è¾“å‡ºæ–‡ä»¶
		if absPath, _ := filepath.Abs(path); absPath == absOutput {
			return nil
		}

		info, err := d.Info()
		if err != nil {
			return nil
		}

		// ç»Ÿè®¡æ—¶ä¹Ÿå¿…é¡»éµå¾ª include / exclude è§„åˆ™
		if !shouldIncludeFile(relPath, &cfg) {
			return nil
		}

		// è¿‡æ»¤äºŒè¿›åˆ¶å’Œè¿‡å¤§æ–‡ä»¶
		if info.Size() > cfg.MaxFileSize || isBinaryFile(path) {
			return nil
		}

		lineCount, _ := countLines(path)
		fileSize := info.Size()

		// ç»Ÿè®¡æ–‡ä»¶
		files = append(files, FileMetadata{
			RelPath:   relPath,
			FullPath:  path,
			Size:      fileSize,
			LineCount: lineCount,
		})
		stats.FileCount++
		stats.TotalLines += lineCount
		stats.TotalSize += fileSize

		// ç»Ÿè®¡ç›®å½•
		dir := filepath.Dir(relPath)
		if dir == "." {
			dir = "."
		}
		if dirStats, ok := dirMap[dir]; ok {
			dirStats.FileCount++
			dirStats.TotalSize += fileSize
			dirStats.TotalLines += lineCount
		} else {
			dirMap[dir] = &DirStats{
				Path:       dir,
				FileCount:  1,
				TotalSize:  fileSize,
				TotalLines: lineCount,
			}
		}

		// ç»Ÿè®¡æ–‡ä»¶ç±»å‹
		ext := strings.ToLower(filepath.Ext(relPath))
		if ext == "" {
			ext = "(no extension)"
		}
		if extStats, ok := extMap[ext]; ok {
			extStats.FileCount++
			extStats.TotalSize += fileSize
		} else {
			extMap[ext] = &ExtStats{
				Ext:       ext,
				FileCount: 1,
				TotalSize: fileSize,
			}
		}

		return nil
	})

	if err != nil {
		return err
	}

	// è¾“å‡ºç»Ÿè®¡ç»“æœ
	fmt.Println("=" + strings.Repeat("=", 70))
	fmt.Println("ğŸ“ åŸºæœ¬ç»Ÿè®¡")
	fmt.Println("=" + strings.Repeat("=", 70))
	fmt.Printf("  æ–‡ä»¶å¤¹æ•°é‡: %d\n", stats.DirCount)
	fmt.Printf("  æ–‡ä»¶æ•°é‡  : %d\n", stats.FileCount)
	fmt.Printf("  æ€»è¡Œæ•°    : %d\n", stats.TotalLines)
	fmt.Printf("  æ€»å¤§å°    : %.2f KB (%.2f MB)\n",
		float64(stats.TotalSize)/1024, float64(stats.TotalSize)/1024/1024)

	// Top 5 æœ€å¤§æ–‡ä»¶å¤¹
	fmt.Println("\n" + "=" + strings.Repeat("=", 70))
	fmt.Println("ğŸ“‚ Top 5 æœ€å¤§æ–‡ä»¶å¤¹")
	fmt.Println("=" + strings.Repeat("=", 70))

	var dirList []DirStats
	for _, ds := range dirMap {
		if ds.FileCount > 0 {
			dirList = append(dirList, *ds)
		}
	}
	sort.Slice(dirList, func(i, j int) bool {
		return dirList[i].TotalSize > dirList[j].TotalSize
	})

	for i := 0; i < 5 && i < len(dirList); i++ {
		ds := dirList[i]
		sizePercent := float64(ds.TotalSize) / float64(stats.TotalSize) * 100
		linesPercent := float64(ds.TotalLines) / float64(stats.TotalLines) * 100
		fmt.Printf("  %d. %s\n", i+1, ds.Path)
		fmt.Printf("     å¤§å°: %.2f KB (%.1f%%), è¡Œæ•°: %d (%.1f%%), æ–‡ä»¶æ•°: %d\n",
			float64(ds.TotalSize)/1024, sizePercent, ds.TotalLines, linesPercent, ds.FileCount)
	}

	// Top 5 æœ€å¤§æ–‡ä»¶
	fmt.Println("\n" + "=" + strings.Repeat("=", 70))
	fmt.Println("ğŸ“„ Top 5 æœ€å¤§æ–‡ä»¶")
	fmt.Println("=" + strings.Repeat("=", 70))

	sort.Slice(files, func(i, j int) bool {
		return files[i].Size > files[j].Size
	})

	for i := 0; i < 5 && i < len(files); i++ {
		f := files[i]
		sizePercent := float64(f.Size) / float64(stats.TotalSize) * 100
		linesPercent := float64(f.LineCount) / float64(stats.TotalLines) * 100
		fmt.Printf("  %d. %s\n", i+1, f.RelPath)
		fmt.Printf("     å¤§å°: %.2f KB (%.1f%%), è¡Œæ•°: %d (%.1f%%)\n",
			float64(f.Size)/1024, sizePercent, f.LineCount, linesPercent)
	}

	// æŒ‰æ–‡ä»¶ç±»å‹ç»Ÿè®¡
	fmt.Println("\n" + "=" + strings.Repeat("=", 70))
	fmt.Println("ğŸ“Š æŒ‰æ–‡ä»¶ç±»å‹ç»Ÿè®¡")
	fmt.Println("=" + strings.Repeat("=", 70))

	var extList []ExtStats
	for _, es := range extMap {
		extList = append(extList, *es)
	}
	sort.Slice(extList, func(i, j int) bool {
		return extList[i].TotalSize > extList[j].TotalSize
	})

	fmt.Printf("  %-20s %10s %15s %10s\n", "ç±»å‹", "æ–‡ä»¶æ•°", "æ€»å¤§å°", "å æ¯”")
	fmt.Println("  " + strings.Repeat("-", 68))
	for _, es := range extList {
		sizePercent := float64(es.TotalSize) / float64(stats.TotalSize) * 100
		fmt.Printf("  %-20s %10d %12.2f KB %9.1f%%\n",
			es.Ext, es.FileCount, float64(es.TotalSize)/1024, sizePercent)
	}

	fmt.Println("\n" + "=" + strings.Repeat("=", 70))
	fmt.Println("âœ… ç»Ÿè®¡å®Œæˆ!")
	fmt.Println("=" + strings.Repeat("=", 70))

	return nil
}

// shouldIncludeFile åˆ¤æ–­æ–‡ä»¶æ˜¯å¦åº”è¢«çº³å…¥å¤„ç†ï¼ˆstats / markdown / json å…±ç”¨ï¼‰
func shouldIncludeFile(path string, cfg *Config) bool {
	ext := strings.ToLower(filepath.Ext(path))

	if len(cfg.IncludeExts) > 0 && !contains(cfg.IncludeExts, ext) {
		return false
	}
	if contains(cfg.ExcludeExts, ext) {
		return false
	}
	for _, m := range cfg.ExcludeMatches {
		if strings.Contains(path, m) {
			return false
		}
	}
	if len(cfg.IncludeMatches) > 0 {
		for _, m := range cfg.IncludeMatches {
			if strings.Contains(path, m) {
				return true
			}
		}
		return false
	}
	return true
}

func contains(list []string, v string) bool {
	for _, s := range list {
		if s == v {
			return true
		}
	}
	return false
}

```

[â¬† å›åˆ°ç›®å½•](#toc)

## ğŸ“„ install-codoc.sh

```bash
#!/usr/bin/env bash
# é¡¹ç›®æ–‡æ¡£ç”Ÿæˆå·¥å…·å®‰è£…è„šæœ¬ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
# è§£å†³å¤šè·¯å¾„ç‰ˆæœ¬å†²çªï¼Œä¼˜å…ˆå®‰è£…è‡³ç”¨æˆ· PATH ä¸­çš„é«˜ä¼˜å…ˆçº§ç›®å½•

set -e

echo "ğŸš€ å¼€å§‹å®‰è£… codoc..."

# -------- åŸºç¡€æ£€æŸ¥ --------
if ! command -v go &> /dev/null; then
    echo "âŒ æœªæ£€æµ‹åˆ° Go ç¼–è¯‘å™¨"
    echo "è¯·å…ˆå®‰è£… Go: https://go.dev/dl/"
    exit 1
fi

echo "âœ“ Go ç‰ˆæœ¬: $(go version)"

# -------- ç¡®å®šå®‰è£…è·¯å¾„ --------
# ä¼˜å…ˆæ£€æŸ¥ç”¨æˆ·ä¸“æœ‰ç›®å½•ï¼Œå‡å°‘å¯¹ sudo çš„ä¾èµ–ï¼Œä¸”é€šå¸¸è¿™äº›ç›®å½•åœ¨ PATH ä¼˜å…ˆçº§æ›´é«˜
USER_LOCAL_BIN="$HOME/.local/bin"
SYSTEM_BIN="/usr/local/bin"
INSTALL_DIR=""

# æ‰¾å‡ºå½“å‰ codoc çš„ä½ç½®ï¼ˆå¦‚æœå·²å®‰è£…ï¼‰
EXISTING_PATH=$(which codoc 2>/dev/null || true)

if [[ ":$PATH:" == *":$USER_LOCAL_BIN:"* ]]; then
    INSTALL_DIR="$USER_LOCAL_BIN"
    echo "ğŸ’¡ æ£€æµ‹åˆ° $USER_LOCAL_BIN å·²åœ¨ PATH ä¸­ï¼Œå°†ä¼˜å…ˆå®‰è£…è‡³æ­¤ã€‚"
elif [[ ":$PATH:" == *":$SYSTEM_BIN:"* ]]; then
    INSTALL_DIR="$SYSTEM_BIN"
    echo "ğŸ’¡ å°†å®‰è£…è‡³ç³»ç»Ÿç›®å½• $SYSTEM_BINã€‚"
else
    INSTALL_DIR="$USER_LOCAL_BIN"
    echo "âš ï¸  æœªåœ¨ PATH ä¸­å‘ç°å¸¸ç”¨ bin ç›®å½•ï¼Œé»˜è®¤å®‰è£…è‡³ $INSTALL_DIR"
fi

mkdir -p "$INSTALL_DIR"

# -------- ç¼–è¯‘ --------
echo "ğŸ“¦ æ­£åœ¨æœ¬åœ°ç¼–è¯‘..."
# å°è¯•è·å– git hashï¼Œå¦‚æœå¤±è´¥åˆ™ä½¿ç”¨ current
GIT_HASH=$(git rev-parse --short HEAD 2>/dev/null || echo "current")
BUILD_DATE=$(date +%Y%m%d)
# æ³¨å…¥ç‰ˆæœ¬ä¿¡æ¯ (main.versionStr å¿…é¡»æ˜¯ var ä¸”åŸæœ¬åœ¨ main åŒ…ä¸­)
GO_LDFLAGS="-X main.versionStr=v2.1.0-${BUILD_DATE}-${GIT_HASH}"

go build -ldflags "${GO_LDFLAGS}" -o codoc_new codoc.go

# -------- å®‰è£…ä¸»ç¨‹åº --------
echo "ğŸ“¥ æ­£åœ¨å®‰è£…åˆ° $INSTALL_DIR/codoc ..."

# æ£€æŸ¥æƒé™
USE_SUDO=""
if [ ! -w "$INSTALL_DIR" ]; then
    echo "ğŸ”‘ éœ€è¦ sudo æƒé™æ¥å†™å…¥ $INSTALL_DIR"
    USE_SUDO="sudo"
fi

$USE_SUDO mv codoc_new "$INSTALL_DIR/codoc"
$USE_SUDO chmod +x "$INSTALL_DIR/codoc"

# -------- å¤„ç†è½¯é“¾æ¥ (gd) --------
echo "ğŸ”— åˆ›å»º/æ›´æ–° gd å¿«æ·å‘½ä»¤"
$USE_SUDO ln -sf "$INSTALL_DIR/codoc" "$INSTALL_DIR/gd"

# -------- æ¸…ç†æ—§ç‰ˆæœ¬å†²çª --------
echo "ğŸ§¹ æ¸…ç†æ—§ç‰ˆæœ¬..."
# åˆ é™¤å·²çŸ¥è·¯å¾„çš„ gen-docs
if [ -f "$USER_LOCAL_BIN/gen-docs" ]; then
    rm "$USER_LOCAL_BIN/gen-docs"
    echo "  - å·²åˆ é™¤ $USER_LOCAL_BIN/gen-docs"
fi
if [ -f "$SYSTEM_BIN/gen-docs" ]; then
    $USE_SUDO rm "$SYSTEM_BIN/gen-docs"
    echo "  - å·²åˆ é™¤ $SYSTEM_BIN/gen-docs"
fi

# -------- PATH æ£€æŸ¥ --------
if [[ ":$PATH:" != *":$INSTALL_DIR:"* ]]; then
    echo ""
    echo "â€¼ï¸  é‡è¦: $INSTALL_DIR ä¸åœ¨ä½ çš„ PATH ç¯å¢ƒå˜é‡ä¸­ï¼"
    echo "è¯·å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°ä½ çš„ ~/.zshrc æˆ– ~/.bashrc:"
    echo "    export PATH=\"$INSTALL_DIR:\$PATH\""
else
    echo "âœ“ éªŒè¯ç»“æœ: $(codoc -version) å®‰è£…æˆåŠŸ"
fi

echo ""
echo "âœ… å®‰è£…å®Œæˆï¼"
echo ""
echo "ğŸ‘‰ æ³¨æ„äº‹é¡¹ï¼š"
echo "1. ä½ å¯ä»¥ä½¿ç”¨ 'codoc' æ¥è¿è¡Œç¨‹åºã€‚"
echo "2. æˆ‘ä»¬åˆ›å»ºäº† 'gd' ä½œä¸º codoc çš„å¿«æ·æ–¹å¼ã€‚"
echo "   âš ï¸  å¦‚æœä½ ä¹‹å‰è®¾ç½®äº† 'alias gd=gen-docs'ï¼Œè¯·åœ¨ .zshrc/.bashrc ä¸­åˆ é™¤å®ƒ"
echo "      ç„¶åæ‰§è¡Œ: unalias gd"
echo "3. è¾“å…¥ 'codoc -s' (æˆ– gd -s) ä½“éªŒç»Ÿè®¡åŠŸèƒ½ï¼"
echo ""

```

[â¬† å›åˆ°ç›®å½•](#toc)

## ğŸ“„ test_json

```text
{
  "generated_at": "2026-02-03 11:30:00",
  "root_dir": "/Users/ygs/ygs/Tmux-FSM/tools",
  "stats": {
    "PotentialMatches": 5,
    "ExplicitlyExcluded": 0,
    "FileCount": 5,
    "TotalSize": 67585,
    "TotalLines": 2457,
    "Skipped": 0,
    "DirCount": 0
  },
  "files": [
    {
      "RelPath": "CODOC_V2.1_OPTIMIZATION.md",
      "FullPath": "/Users/ygs/ygs/Tmux-FSM/tools/CODOC_V2.1_OPTIMIZATION.md",
      "Size": 7083,
      "LineCount": 300
    },
    {
      "RelPath": "README.md",
      "FullPath": "/Users/ygs/ygs/Tmux-FSM/tools/README.md",
      "Size": 30415,
      "LineCount": 995
    },
    {
      "RelPath": "codoc.go",
      "FullPath": "/Users/ygs/ygs/Tmux-FSM/tools/codoc.go",
      "Size": 26614,
      "LineCount": 1047
    },
    {
      "RelPath": "install-codoc.sh",
      "FullPath": "/Users/ygs/ygs/Tmux-FSM/tools/install-codoc.sh",
      "Size": 3185,
      "LineCount": 98
    },
    {
      "RelPath": "tools-20260125-docs.md",
      "FullPath": "/Users/ygs/ygs/Tmux-FSM/tools/tools-20260125-docs.md",
      "Size": 288,
      "LineCount": 17
    }
  ]
}
```

[â¬† å›åˆ°ç›®å½•](#toc)

## ğŸ“„ tools-20260125-docs.md

```markdown
# Project Documentation

- **Generated at:** 2026-01-25 10:55:56
- **Root Dir:** `.`
- **File Count:** 0
- **Total Size:** 0.00 KB

<a name="toc"></a>
## ğŸ“‚ æ‰«æç›®å½•

---

---
### ğŸ“Š æœ€ç»ˆç»Ÿè®¡æ±‡æ€»
- **æ–‡ä»¶æ€»æ•°:** 0
- **ä»£ç æ€»è¡Œæ•°:** 0
- **ç‰©ç†æ€»å¤§å°:** 0.00 KB

```

[â¬† å›åˆ°ç›®å½•](#toc)

---
### ğŸ“Š æœ€ç»ˆç»Ÿè®¡æ±‡æ€»
- **æ–‡ä»¶æ€»æ•°:** 6
- **ä»£ç æ€»è¡Œæ•°:** 2502
- **ç‰©ç†æ€»å¤§å°:** 67.07 KB
