# tools æ¨¡å—

## æ¨¡å—èŒè´£æ¦‚è¿°

`tools/` æ˜¯ **Tmux-FSM çš„å¼€å‘å·¥å…·é›†åˆ**ï¼Œè´Ÿè´£æä¾›è¾…åŠ©å¼€å‘ã€æ–‡æ¡£ç”Ÿæˆã€æµ‹è¯•ç­‰å·¥å…·ã€‚è¯¥æ¨¡å—åŒ…å«äº†é¡¹ç›®ç»´æŠ¤å’Œå¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„å„ç§å®ç”¨å·¥å…·ï¼Œæ—¨åœ¨æé«˜å¼€å‘æ•ˆç‡å’Œé¡¹ç›®å¯ç»´æŠ¤æ€§ã€‚

ä¸»è¦èŒè´£åŒ…æ‹¬ï¼š
- æä¾›é¡¹ç›®æ–‡æ¡£ç”Ÿæˆå·¥å…·
- åŒ…å«å¼€å‘è¾…åŠ©è„šæœ¬
- æä¾›æµ‹è¯•å’ŒéªŒè¯å·¥å…·
- ç»´æŠ¤é¡¹ç›®æ„å»ºå’Œéƒ¨ç½²å·¥å…·

## æ ¸å¿ƒè®¾è®¡æ€æƒ³

- **å¼€å‘è¾…åŠ©**: ä¸ºå¼€å‘è¿‡ç¨‹æä¾›ä¾¿åˆ©å·¥å…·
- **æ–‡æ¡£ç”Ÿæˆ**: è‡ªåŠ¨åŒ–ç”Ÿæˆé¡¹ç›®æ–‡æ¡£
- **å¯ç»´æŠ¤æ€§**: å·¥å…·æœ¬èº«æ˜“äºç»´æŠ¤å’Œæ‰©å±•
- **å®ç”¨æ€§**: è§£å†³å®é™…å¼€å‘ä¸­çš„ç—›ç‚¹é—®é¢˜

## æ–‡ä»¶ç»“æ„è¯´æ˜

### `gen-docs.go`
- é¡¹ç›®æ–‡æ¡£ç”Ÿæˆå·¥å…·
- ä¸»è¦åŠŸèƒ½ï¼š
  - æ‰«æé¡¹ç›®ç›®å½•ç»“æ„
  - ç”Ÿæˆé¡¹ç›®æ–‡æ¡£å¿«ç…§
  - æ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼è¿‡æ»¤
  - æä¾›äºŒè¿›åˆ¶æ–‡ä»¶æ£€æµ‹
- ç”¨é€”ï¼š
  - ç”Ÿæˆé¡¹ç›®æ•´ä½“æ–‡æ¡£
  - ä¸ºæ¶æ„å®¡è®¡æä¾›ææ–™
  - åˆ›å»ºä»£ç å¿«ç…§ç”¨äºå®¡æŸ¥

### `install-gen-docs.sh`
- gen-docs å·¥å…·å®‰è£…è„šæœ¬
- ä¸»è¦åŠŸèƒ½ï¼š
  - æ£€æŸ¥ Go ç¯å¢ƒ
  - ç¼–è¯‘ gen-docs å·¥å…·
  - å®‰è£…åˆ°ç³»ç»Ÿè·¯å¾„
  - åˆ›å»º `gd` å¿«æ·å‘½ä»¤
- ç”¨é€”ï¼š
  - ç®€åŒ–å·¥å…·å®‰è£…è¿‡ç¨‹
  - æä¾›ä¾¿æ·çš„ä½¿ç”¨æ–¹å¼

## å·¥å…·ç‰¹æ€§

### æ–‡æ¡£ç”Ÿæˆ
- æ”¯æŒé¡¹ç›®çº§æ–‡æ¡£å¿«ç…§ç”Ÿæˆ
- è‡ªåŠ¨è¿‡æ»¤äºŒè¿›åˆ¶æ–‡ä»¶
- æ”¯æŒæ–‡ä»¶å¤§å°é™åˆ¶
- æä¾›è¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯

### æ˜“ç”¨æ€§
- æä¾›ç®€æ´çš„å‘½ä»¤è¡Œæ¥å£
- æ”¯æŒå¤šç§è¿‡æ»¤é€‰é¡¹
- è‡ªåŠ¨è¾“å‡ºæ–‡ä»¶å‘½å
- æä¾›è¿›åº¦æŒ‡ç¤º

## åœ¨æ•´ä½“æ¶æ„ä¸­çš„è§’è‰²

Tools æ¨¡å—æ˜¯é¡¹ç›®çš„è¾…åŠ©å¼€å‘å±‚ï¼Œå®ƒä¸ºå¼€å‘è€…æä¾›äº†ä¾¿åˆ©çš„å·¥å…·é›†ã€‚Tools æä¾›äº†ï¼š
- é¡¹ç›®æ–‡æ¡£çš„è‡ªåŠ¨åŒ–ç”Ÿæˆ
- å¼€å‘æµç¨‹çš„ç®€åŒ–
- ä»£ç å®¡æŸ¥å’Œå®¡è®¡çš„æ”¯æŒ
- é¡¹ç›®å¯ç»´æŠ¤æ€§çš„æå‡

# `gen-docs.go` æ–‡ä»¶è¯¦ç»†åˆ†æ

## æ–‡ä»¶ä½œç”¨

`gen-docs.go` æ˜¯ä¸€ä¸ªé¡¹ç›®æ–‡æ¡£ç”Ÿæˆå·¥å…·ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ‰«ææŒ‡å®šç›®å½•ä¸‹çš„æºä»£ç æ–‡ä»¶ï¼Œå¹¶å°†è¿™äº›æ–‡ä»¶çš„å†…å®¹æ•´åˆåˆ°ä¸€ä¸ª Markdown æ–‡æ¡£ä¸­ã€‚è¿™ä¸ªå·¥å…·å¯ä»¥å¸®åŠ©å¼€å‘è€…å¿«é€Ÿåˆ›å»ºé¡¹ç›®çš„å®Œæ•´æ–‡æ¡£ï¼ŒåŒ…å«æ‰€æœ‰æºä»£ç æ–‡ä»¶çš„å†…å®¹ï¼Œä¾¿äºä»£ç å®¡æŸ¥ã€åˆ†äº«æˆ–å½’æ¡£ã€‚

è¯¥å·¥å…·å…·æœ‰ä»¥ä¸‹æ ¸å¿ƒç‰¹æ€§ï¼š

1. **æ™ºèƒ½æ–‡ä»¶æ‰«æ**ï¼šæ”¯æŒå¤šç§è¿‡æ»¤è§„åˆ™ï¼ŒåŒ…æ‹¬æŒ‰æ–‡ä»¶æ‰©å±•åã€è·¯å¾„å…³é”®è¯è¿›è¡ŒåŒ…å«æˆ–æ’é™¤
2. **äºŒè¿›åˆ¶æ–‡ä»¶æ£€æµ‹**ï¼šè‡ªåŠ¨è¯†åˆ«å¹¶è·³è¿‡äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé¿å…æŸåè¾“å‡ºæ–‡æ¡£
3. **å¤§å°é™åˆ¶**ï¼šå¯è®¾ç½®æœ€å¤§æ–‡ä»¶å¤§å°é™åˆ¶ï¼Œé˜²æ­¢è¿‡å¤§æ–‡ä»¶å½±å“æ€§èƒ½
4. **æµå¼å¤„ç†**ï¼šä½¿ç”¨æµå¼å†™å…¥ï¼Œé¿å…å†…å­˜å ç”¨è¿‡é«˜ï¼Œæ”¯æŒå¤§é¡¹ç›®å¤„ç†
5. **ä¸°å¯Œçš„è¾“å‡ºæ ¼å¼**ï¼šç”Ÿæˆå¸¦ç›®å½•çš„ Markdown æ–‡æ¡£ï¼Œä¸ºæ¯ä¸ªæ–‡ä»¶æ·»åŠ è¯­æ³•é«˜äº®

## å®ç°ç»†èŠ‚åˆ†æ

### 1. é…ç½®ç»“æ„ (`Config`)
```go
type Config struct {
    RootDir        string      // æ‰«ææ ¹ç›®å½•
    OutputFile     string      // è¾“å‡ºæ–‡ä»¶è·¯å¾„
    IncludeExts    []string    // åŒ…å«çš„æ–‡ä»¶æ‰©å±•ååˆ—è¡¨
    IncludeMatches []string    // åŒ…å«çš„è·¯å¾„å…³é”®è¯åˆ—è¡¨
    ExcludeExts    []string    // æ’é™¤çš„æ–‡ä»¶æ‰©å±•ååˆ—è¡¨
    ExcludeMatches []string   // æ’é™¤çš„è·¯å¾„å…³é”®è¯åˆ—è¡¨
    MaxFileSize    int64       // æœ€å¤§æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
    NoSubdirs      bool        // æ˜¯å¦ä¸æ‰«æå­ç›®å½•
    Verbose        bool        // æ˜¯å¦æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
    Version        bool        // æ˜¯å¦æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
}
```

### 2. æ•°æ®ç»“æ„
- `FileMetadata`ï¼šå­˜å‚¨æ–‡ä»¶çš„å…ƒæ•°æ®ï¼ˆç›¸å¯¹è·¯å¾„ã€ç»å¯¹è·¯å¾„ã€å¤§å°ã€è¡Œæ•°ï¼‰
- `Stats`ï¼šç»Ÿè®¡ä¿¡æ¯ï¼ˆåŒ¹é…æ–‡ä»¶æ•°ã€æ’é™¤æ–‡ä»¶æ•°ã€æœ€ç»ˆæ–‡ä»¶æ•°ã€æ€»å¤§å°ã€æ€»è¡Œæ•°ç­‰ï¼‰
- `languageMap`ï¼šæ–‡ä»¶æ‰©å±•ååˆ°ç¼–ç¨‹è¯­è¨€çš„æ˜ å°„è¡¨ï¼Œç”¨äºè¯­æ³•é«˜äº®

### 3. æ ¸å¿ƒå¤„ç†æµç¨‹

#### Phase 1: å‚æ•°è§£æ (`parseFlags`)
- è§£æå‘½ä»¤è¡Œå‚æ•°å¹¶æ„å»ºé…ç½®å¯¹è±¡
- è‡ªåŠ¨ç”Ÿæˆè¾“å‡ºæ–‡ä»¶åï¼ˆå¦‚æœæœªæŒ‡å®šï¼‰
- å¤„ç†ä½ç½®å‚æ•°ä½œä¸ºæ ¹ç›®å½•

#### Phase 2: ç›®å½•æ‰«æ (`scanDirectory`)
- ä½¿ç”¨ `filepath.WalkDir` éå†ç›®å½•æ ‘
- åº”ç”¨å¤šå±‚è¿‡æ»¤è§„åˆ™ï¼š
  1. åŸºç¡€è¿‡æ»¤ï¼šè¿‡å¤§æ–‡ä»¶æˆ–äºŒè¿›åˆ¶æ–‡ä»¶
  2. åŒ…å«æ„å›¾æ£€æŸ¥ï¼šç¬¦åˆåŒ…å«æ‰©å±•åæˆ–è·¯å¾„å…³é”®è¯
  3. æ’é™¤è§„åˆ™æ£€æŸ¥ï¼šä¸ç¬¦åˆæ’é™¤æ‰©å±•åæˆ–è·¯å¾„å…³é”®è¯
- è®¡ç®—æ–‡ä»¶è¡Œæ•°å’Œå¤§å°ç»Ÿè®¡
- å¯¹ç»“æœæŒ‰è·¯å¾„æ’åºç¡®ä¿è¾“å‡ºä¸€è‡´æ€§

#### Phase 3: æµå¼æ–‡æ¡£ç”Ÿæˆ (`writeMarkdownStream`)
- åˆ›å»ºè¾“å‡º Markdown æ–‡ä»¶
- å†™å…¥æ–‡æ¡£å¤´éƒ¨ä¿¡æ¯
- ç”Ÿæˆå¸¦é”šç‚¹çš„ç›®å½•
- é€ä¸ªå¤åˆ¶æ–‡ä»¶å†…å®¹åˆ° Markdown ä¸­ï¼ˆå¸¦è¯­æ³•é«˜äº®ï¼‰
- æ·»åŠ è¿”å›ç›®å½•çš„é“¾æ¥

### 4. è¿‡æ»¤è§„åˆ™è¯¦è§£

#### åŒ…å«è§„åˆ™ï¼ˆAND é€»è¾‘ï¼‰
- æ–‡ä»¶æ‰©å±•åå¿…é¡»åœ¨ `IncludeExts` åˆ—è¡¨ä¸­ï¼ˆå¦‚æœè®¾ç½®äº†ç™½åå•ï¼‰
- æ–‡ä»¶è·¯å¾„å¿…é¡»åŒ…å« `IncludeMatches` ä¸­çš„ä»»æ„å…³é”®è¯ï¼ˆå¦‚æœè®¾ç½®äº†å…³é”®è¯ï¼‰

#### æ’é™¤è§„åˆ™ï¼ˆOR é€»è¾‘ï¼‰
- æ–‡ä»¶æ‰©å±•ååœ¨ `ExcludeExts` åˆ—è¡¨ä¸­ â†’ æ’é™¤
- æ–‡ä»¶è·¯å¾„åŒ…å« `ExcludeMatches` ä¸­çš„ä»»æ„å…³é”®è¯ â†’ æ’é™¤

#### é»˜è®¤å¿½ç•¥ç›®å½•
```
.git, .idea, .vscode, node_modules, vendor, dist, build,
target, bin, __pycache__, .DS_Store, package-lock.json,
yarn.lock, go.sum
```

### 5. äºŒè¿›åˆ¶æ–‡ä»¶æ£€æµ‹æœºåˆ¶
- æ£€æµ‹æ–‡ä»¶åä¸­æ˜¯å¦åŒ…å« `.min.`ï¼ˆé€šå¸¸è¡¨ç¤ºå‹ç¼©æ–‡ä»¶ï¼‰
- æ£€æµ‹æ–‡ä»¶å‰ 512 å­—èŠ‚ä¸­æ˜¯å¦æœ‰ NULL å­—èŠ‚
- æ£€æµ‹æ–‡ä»¶å‰ 512 å­—èŠ‚æ˜¯å¦ä¸ºæœ‰æ•ˆçš„ UTF-8 ç¼–ç 

### 6. è¯­è¨€æ£€æµ‹æœºåˆ¶
é€šè¿‡ `languageMap` æ˜ å°„è¡¨æ ¹æ®æ–‡ä»¶æ‰©å±•åç¡®å®šç¼–ç¨‹è¯­è¨€ï¼Œç”¨äº Markdown ä»£ç å—çš„è¯­æ³•é«˜äº®ã€‚

## ä½¿ç”¨æ–¹æ³•å’Œç¤ºä¾‹

### ç¼–è¯‘å’Œè¿è¡Œ

#### æ–¹æ³•ä¸€ï¼šç›´æ¥è¿è¡Œ
```bash
cd /Users/ygs/Tmux-FSM/tools
go run gen-docs.go [options] [directory]
```

#### æ–¹æ³•äºŒï¼šç¼–è¯‘åè¿è¡Œ
```bash
go build -o gen-docs gen-docs.go
./gen-docs [options] [directory]
```

### å‘½ä»¤è¡Œé€‰é¡¹è¯¦è§£

| å‚æ•° | ç±»å‹ | æè¿° | é»˜è®¤å€¼ |
|------|------|------|--------|
| `-dir` | string | è¦æ‰«æçš„æ ¹ç›®å½• | `.` (å½“å‰ç›®å½•) |
| `-o` | string | è¾“å‡ºçš„ Markdown æ–‡ä»¶å | è‡ªåŠ¨ç”Ÿæˆï¼ˆæ ¼å¼ï¼š`basename-date-docs.md`ï¼‰ |
| `-i` | string | åŒ…å«çš„æ–‡ä»¶æ‰©å±•åï¼ˆé€—å·åˆ†éš”ï¼‰ | å…¨éƒ¨ |
| `-m` | string | åŒ…å«çš„è·¯å¾„å…³é”®è¯ï¼ˆé€—å·åˆ†éš”ï¼‰ | å…¨éƒ¨ |
| `-x` | string | æ’é™¤çš„æ–‡ä»¶æ‰©å±•åï¼ˆé€—å·åˆ†éš”ï¼‰ | æ—  |
| `-xm` | string | æ’é™¤çš„è·¯å¾„å…³é”®è¯ï¼ˆé€—å·åˆ†éš”ï¼‰ | æ—  |
| `-max-size` | int64 | æœ€å¤§æ–‡ä»¶å¤§å°ï¼ˆKBï¼‰ | 500 |
| `-no-subdirs` æˆ– `-ns` | bool | ä¸æ‰«æå­ç›®å½• | false |
| `-v` | bool | è¯¦ç»†è¾“å‡ºæ¨¡å¼ | false |
| `-version` | bool | æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯å¹¶é€€å‡º | false |

### ä½¿ç”¨ç¤ºä¾‹

#### ç¤ºä¾‹ 1ï¼šç”Ÿæˆæ•´ä¸ªé¡¹ç›®çš„æ–‡æ¡£
```bash
go run gen-docs.go
```
è¿™å°†åœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆç±»ä¼¼ `currentdir-20260112-docs.md` çš„æ–‡ä»¶ï¼ŒåŒ…å«å½“å‰ç›®å½•ä¸‹æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶ã€‚

#### ç¤ºä¾‹ 2ï¼šåªåŒ…å« Go å’Œé…ç½®æ–‡ä»¶
```bash
go run gen-docs.go -i ".go,.conf" -o project-go-docs.md
```
ç”ŸæˆåªåŒ…å« `.go` å’Œ `.conf` æ–‡ä»¶çš„æ–‡æ¡£ã€‚

#### ç¤ºä¾‹ 3ï¼šåŒ…å«ç‰¹å®šè·¯å¾„å…³é”®è¯çš„æ–‡ä»¶
```bash
go run gen-docs.go -m "_test.go,config" -o test-and-config-docs.md
```
ç”ŸæˆåŒ…å« `_test.go` ç»“å°¾æˆ–è·¯å¾„ä¸­åŒ…å« `config` çš„æ–‡ä»¶ã€‚

#### ç¤ºä¾‹ 4ï¼šæ’é™¤æµ‹è¯•æ–‡ä»¶å’Œç‰¹å®šç›®å½•
```bash
go run gen-docs.go -xm "_test.go,vendor/" -o clean-project-docs.md
```
ç”Ÿæˆæ’é™¤æµ‹è¯•æ–‡ä»¶å’Œ `vendor` ç›®å½•çš„æ–‡æ¡£ã€‚

#### ç¤ºä¾‹ 5ï¼šåŒæ—¶ä½¿ç”¨åŒ…å«å’Œæ’é™¤è§„åˆ™
```bash
go run gen-docs.go -i ".go,.js" -x ".min.js" -xm "test_" -o filtered-docs.md
```
ç”ŸæˆåŒ…å« `.go` å’Œ `.js` æ–‡ä»¶ä½†æ’é™¤ `.min.js` æ–‡ä»¶å’Œè·¯å¾„ä¸­åŒ…å« `test_` çš„æ–‡ä»¶ã€‚

#### ç¤ºä¾‹ 6ï¼šåªå¤„ç†å½“å‰ç›®å½•ï¼ˆä¸é€’å½’å­ç›®å½•ï¼‰çš„ JavaScript æ–‡ä»¶
```bash
go run gen-docs.go -dir ./src -i ".js" -ns -o js-files.md
```
åªæ‰«æ `./src` ç›®å½•ä¸‹çš„ `.js` æ–‡ä»¶ï¼Œä¸é€’å½’å­ç›®å½•ã€‚

#### ç¤ºä¾‹ 7ï¼šå¢åŠ æ–‡ä»¶å¤§å°é™åˆ¶
```bash
go run gen-docs.go -max-size 1000 -o large-project-docs.md
```
å…è®¸æœ€å¤§ 1000KB çš„æ–‡ä»¶è¢«åŒ…å«ã€‚

#### ç¤ºä¾‹ 8ï¼šè¯¦ç»†è¾“å‡ºæ¨¡å¼
```bash
go run gen-docs.go -v -o detailed-docs.md
```
æ˜¾ç¤ºè¯¦ç»†çš„å¤„ç†è¿‡ç¨‹ä¿¡æ¯ã€‚

#### ç¤ºä¾‹ 9ï¼šæŒ‡å®šç‰¹å®šç›®å½•
```bash
go run gen-docs.go /path/to/project -o custom-project-docs.md
```
æ‰«ææŒ‡å®šç›®å½• `/path/to/project`ã€‚

#### ç¤ºä¾‹ 10ï¼šç»„åˆå¤šä¸ªæ¡ä»¶
```bash
go run gen-docs.go -dir ./myproject -i ".go,.js,.py" -x ".min.js" -xm "node_modules,test_" -max-size 200 -o comprehensive-docs.md
```
ç»¼åˆä½¿ç”¨å¤šç§è¿‡æ»¤æ¡ä»¶ç”Ÿæˆæ–‡æ¡£ã€‚

### è¾“å‡ºæ–‡ä»¶å‘½åè§„åˆ™

å¦‚æœæ²¡æœ‰æŒ‡å®šè¾“å‡ºæ–‡ä»¶åï¼Œå·¥å…·ä¼šè‡ªåŠ¨ç”Ÿæˆï¼š
- å½“å‰ç›®å½• (`.`)ï¼šä½¿ç”¨å½“å‰ç›®å½•åï¼Œå¦‚ `currentdir-20260112-docs.md`
- æŒ‡å®šç›®å½•ï¼šä½¿ç”¨ç›®å½•è·¯å¾„è½¬æ¢åçš„åç§°ï¼Œå¦‚ `/path/to/project` ä¼šå˜æˆ `path_to_project-20260112-docs.md`
- æ—¥æœŸæ ¼å¼ï¼šYYYYMMDDï¼ˆä¾‹å¦‚ 20260112 è¡¨ç¤º 2026 å¹´ 1 æœˆ 12 æ—¥ï¼‰

### å®é™…åº”ç”¨ç¤ºä¾‹

å‡è®¾ä½ æœ‰ä¸€ä¸ª Go é¡¹ç›®ï¼Œæƒ³è¦ç”Ÿæˆé™¤æµ‹è¯•æ–‡ä»¶å¤–çš„æ‰€æœ‰æºä»£ç æ–‡æ¡£ï¼š

```bash
go run gen-docs.go -i ".go" -xm "_test.go" -o myproject-source-docs.md
```

æˆ–è€…ä½ æƒ³ç”Ÿæˆä¸€ä¸ªå‰ç«¯é¡¹ç›®çš„æ–‡æ¡£ï¼Œä½†æ’é™¤å‹ç¼©è¿‡çš„ JS æ–‡ä»¶ï¼š

```bash
go run gen-docs.go -i ".go,.js,.py" -x ".min.js" -xm "node_modules,test_" -max-size 200 -o comprehensive-docs.md
```

è¿™äº›ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æ ¹æ®ä¸åŒçš„éœ€æ±‚çµæ´»ä½¿ç”¨è¯¥å·¥å…·çš„å„ç§é€‰é¡¹æ¥ç”Ÿæˆå®šåˆ¶åŒ–çš„é¡¹ç›®æ–‡æ¡£ã€‚

## é…ç½®é€‰é¡¹å’Œè¿‡æ»¤è§„åˆ™è¯¦è§£

### é…ç½®é€‰é¡¹æ·±åº¦è§£æ

#### 1. åŸºæœ¬è·¯å¾„é€‰é¡¹
- **`-dir`**: æŒ‡å®šæ‰«æçš„æ ¹ç›®å½•
  - é»˜è®¤å€¼ï¼š`.`ï¼ˆå½“å‰å·¥ä½œç›®å½•ï¼‰
  - æ”¯æŒç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„
  - å¦‚æœæä¾›äº†ä½ç½®å‚æ•°ï¼Œå®ƒå°†è¦†ç›–æ­¤é€‰é¡¹

- **`-o`**: æŒ‡å®šè¾“å‡ºçš„ Markdown æ–‡ä»¶å
  - é»˜è®¤å€¼ï¼šè‡ªåŠ¨ç”Ÿæˆï¼ˆæ ¼å¼ï¼š`basename-YYYYMMDD-docs.md`ï¼‰
  - å¦‚æœä¸æŒ‡å®šï¼Œå·¥å…·ä¼šæ ¹æ®æ ¹ç›®å½•åç§°å’Œå½“å‰æ—¥æœŸç”Ÿæˆæ–‡ä»¶å

#### 2. åŒ…å«è¿‡æ»¤é€‰é¡¹
- **`-i`**: æŒ‡å®šè¦åŒ…å«çš„æ–‡ä»¶æ‰©å±•ååˆ—è¡¨
  - æ ¼å¼ï¼šé€—å·åˆ†éš”çš„æ‰©å±•åï¼Œå¦‚ `.go,.js,.py`
  - å¦‚æœè®¾ç½®äº†æ­¤é€‰é¡¹ï¼Œåªæœ‰æŒ‡å®šæ‰©å±•åçš„æ–‡ä»¶æ‰ä¼šè¢«è€ƒè™‘
  - å¦‚æœä¸è®¾ç½®ï¼Œåˆ™åŒ…å«æ‰€æœ‰æ‰©å±•åçš„æ–‡ä»¶ï¼ˆä»å—å…¶ä»–è§„åˆ™çº¦æŸï¼‰

- **`-m`**: æŒ‡å®šè¦åŒ…å«çš„è·¯å¾„å…³é”®è¯åˆ—è¡¨
  - æ ¼å¼ï¼šé€—å·åˆ†éš”çš„å…³é”®è¯ï¼Œå¦‚ `_test.go,config`
  - å¦‚æœè®¾ç½®äº†æ­¤é€‰é¡¹ï¼Œåªæœ‰è·¯å¾„ä¸­åŒ…å«ä»»ä¸€å…³é”®è¯çš„æ–‡ä»¶æ‰ä¼šè¢«è€ƒè™‘
  - å¦‚æœä¸è®¾ç½®ï¼Œåˆ™åŒ…å«æ‰€æœ‰è·¯å¾„çš„æ–‡ä»¶ï¼ˆä»å—å…¶ä»–è§„åˆ™çº¦æŸï¼‰

#### 3. æ’é™¤è¿‡æ»¤é€‰é¡¹
- **`-x`**: æŒ‡å®šè¦æ’é™¤çš„æ–‡ä»¶æ‰©å±•ååˆ—è¡¨
  - æ ¼å¼ï¼šé€—å·åˆ†éš”çš„æ‰©å±•åï¼Œå¦‚ `.exe,.o,.tmp`
  - ä¼˜å…ˆçº§é«˜äºåŒ…å«è§„åˆ™ï¼Œä¸€æ—¦åŒ¹é…ç«‹å³æ’é™¤

- **`-xm`**: æŒ‡å®šè¦æ’é™¤çš„è·¯å¾„å…³é”®è¯åˆ—è¡¨
  - æ ¼å¼ï¼šé€—å·åˆ†éš”çš„å…³é”®è¯ï¼Œå¦‚ `vendor/,node_modules/,temp/`
  - ä¼˜å…ˆçº§é«˜äºåŒ…å«è§„åˆ™ï¼Œä¸€æ—¦åŒ¹é…ç«‹å³æ’é™¤

#### 4. é™åˆ¶é€‰é¡¹
- **`-max-size`**: è®¾ç½®æœ€å¤§æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆå•ä½ï¼šKBï¼‰
  - é»˜è®¤å€¼ï¼š500KB
  - è¶…è¿‡æ­¤å¤§å°çš„æ–‡ä»¶ä¼šè¢«è·³è¿‡
  - ç”¨äºé˜²æ­¢è¿‡å¤§æ–‡ä»¶å½±å“æ€§èƒ½å’Œè¾“å‡ºæ–‡æ¡£å¤§å°

- **`-no-subdirs` æˆ– `-ns`**: æ§åˆ¶æ˜¯å¦æ‰«æå­ç›®å½•
  - é»˜è®¤å€¼ï¼šfalseï¼ˆæ‰«æå­ç›®å½•ï¼‰
  - è®¾ç½®ååªæ‰«ææŒ‡å®šç›®å½•çš„ç›´æ¥æ–‡ä»¶ï¼Œä¸é€’å½’å­ç›®å½•

#### 5. è¾“å‡ºæ§åˆ¶é€‰é¡¹
- **`-v`**: å¯ç”¨è¯¦ç»†è¾“å‡ºæ¨¡å¼
  - æ˜¾ç¤ºæ¯ä¸ªå¤„ç†æ­¥éª¤çš„è¯¦ç»†ä¿¡æ¯
  - æ˜¾ç¤ºè¢«æ·»åŠ ã€è·³è¿‡æˆ–æ’é™¤çš„æ–‡ä»¶ä¿¡æ¯

- **`-version`**: æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯å¹¶é€€å‡º
  - å½“å‰ç‰ˆæœ¬ï¼šv2.0.0
  - æ˜¾ç¤ºåç«‹å³é€€å‡ºç¨‹åº

### è¿‡æ»¤è§„åˆ™è¯¦è§£

#### è§„åˆ™ä¼˜å…ˆçº§å’Œé€»è¾‘

1. **é»˜è®¤å¿½ç•¥è§„åˆ™**ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
   - æ‰€æœ‰ä»¥ `.` å¼€å¤´çš„éšè—ç›®å½•ï¼ˆé™¤äº† `.` æœ¬èº«ï¼‰
   - é¢„å®šä¹‰çš„å¿½ç•¥ç›®å½•åˆ—è¡¨ï¼ˆå¦‚ `.git`, `node_modules`, `vendor` ç­‰ï¼‰
   - è¿™äº›è§„åˆ™åœ¨ç›®å½•éå†æ—¶ç«‹å³ç”Ÿæ•ˆï¼Œä¸ä¼šè¿›å…¥åç»­è¿‡æ»¤æµç¨‹

2. **åŸºç¡€è¿‡æ»¤è§„åˆ™**ï¼ˆæ¬¡é«˜ä¼˜å…ˆçº§ï¼‰
   - æ–‡ä»¶å¤§å°è¶…è¿‡ `MaxFileSize` é™åˆ¶
   - æ£€æµ‹ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶
   - è¿™äº›è§„åˆ™åœ¨æ–‡ä»¶çº§åˆ«åº”ç”¨

3. **æ’é™¤è§„åˆ™**ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
   - åŒ¹é… `-x` æŒ‡å®šçš„æ‰©å±•å
   - åŒ¹é… `-xm` æŒ‡å®šçš„è·¯å¾„å…³é”®è¯
   - ä¸€æ—¦åŒ¹é…æ’é™¤è§„åˆ™ï¼Œæ–‡ä»¶ç«‹å³è¢«è·³è¿‡

4. **åŒ…å«è§„åˆ™**ï¼ˆæ ‡å‡†ä¼˜å…ˆçº§ï¼‰
   - å¿…é¡»åŒæ—¶æ»¡è¶³æ‰©å±•åè¦æ±‚ï¼ˆå¦‚æœè®¾ç½®äº† `-i`ï¼‰
   - å¿…é¡»åŒæ—¶æ»¡è¶³è·¯å¾„å…³é”®è¯è¦æ±‚ï¼ˆå¦‚æœè®¾ç½®äº† `-m`ï¼‰
   - è¿™ä¸¤ä¸ªæ¡ä»¶ä½¿ç”¨ AND é€»è¾‘è¿æ¥

#### è¿‡æ»¤è§„åˆ™çš„ç»„åˆé€»è¾‘

##### åŒ…å«è§„åˆ™çš„ AND é€»è¾‘
å½“åŒæ—¶è®¾ç½®äº† `-i` å’Œ `-m` æ—¶ï¼Œæ–‡ä»¶å¿…é¡»åŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š
- æ–‡ä»¶æ‰©å±•ååœ¨ `-i` åˆ—è¡¨ä¸­
- æ–‡ä»¶è·¯å¾„åŒ…å« `-m` åˆ—è¡¨ä¸­çš„ä»»ä¸€å…³é”®è¯

ä¾‹å¦‚ï¼š
```bash
-i ".go,.js" -m "src,api"
```
åªæœ‰åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„æ–‡ä»¶æ‰ä¼šè¢«è€ƒè™‘ï¼š
- æ‰©å±•åä¸º `.go` æˆ– `.js`
- è·¯å¾„ä¸­åŒ…å« `src` æˆ– `api`

##### æ’é™¤è§„åˆ™çš„ OR é€»è¾‘
å½“åŒæ—¶è®¾ç½®äº† `-x` å’Œ `-xm` æ—¶ï¼Œåªè¦æ»¡è¶³ä»»ä¸€æ¡ä»¶å°±ä¼šè¢«æ’é™¤ï¼š
- æ–‡ä»¶æ‰©å±•ååœ¨ `-x` åˆ—è¡¨ä¸­
- æ–‡ä»¶è·¯å¾„åŒ…å« `-xm` åˆ—è¡¨ä¸­çš„ä»»ä¸€å…³é”®è¯

ä¾‹å¦‚ï¼š
```bash
-x ".tmp,.log" -xm "temp/,cache/"
```
ä»¥ä¸‹ä»»ä¸€æƒ…å†µéƒ½ä¼šå¯¼è‡´æ–‡ä»¶è¢«æ’é™¤ï¼š
- æ‰©å±•åä¸º `.tmp` æˆ– `.log`
- è·¯å¾„ä¸­åŒ…å« `temp/` æˆ– `cache/`

#### è¿‡æ»¤è§„åˆ™çš„å®é™…åº”ç”¨ç¤ºä¾‹

##### åœºæ™¯ 1ï¼šåªå¤„ç†ç‰¹å®šç±»å‹çš„æºä»£ç 
```bash
-i ".go,.js,.py" -o source-code.md
```
- åŒ…å«ï¼šæ‰€æœ‰ `.go`ã€`.js`ã€`.py` æ–‡ä»¶
- æ’é™¤ï¼šå…¶ä»–ç±»å‹æ–‡ä»¶
- ç»“æœï¼šåªç”Ÿæˆæºä»£ç æ–‡ä»¶çš„æ–‡æ¡£

##### åœºæ™¯ 2ï¼šæ’é™¤ç‰¹å®šç›®å½•å’Œæ–‡ä»¶ç±»å‹
```bash
-xm "vendor/,node_modules/,test_" -x ".log,.tmp" -o clean-docs.md
```
- æ’é™¤ï¼šè·¯å¾„åŒ…å« `vendor/`ã€`node_modules/`ã€`test_` çš„æ–‡ä»¶
- æ’é™¤ï¼šæ‰©å±•åä¸º `.log`ã€`.tmp` çš„æ–‡ä»¶
- ç»“æœï¼šç”Ÿæˆæ¸…ç†åçš„æ–‡æ¡£

##### åœºæ™¯ 3ï¼šå¤æ‚è¿‡æ»¤ç»„åˆ
```bash
-i ".go" -m "main,handler" -x ".pb.go" -xm "test_,mock"
```
- åŒ…å«ï¼šæ‰©å±•åä¸º `.go` ä¸”è·¯å¾„åŒ…å« `main` æˆ– `handler` çš„æ–‡ä»¶
- æ’é™¤ï¼šæ‰©å±•åä¸º `.pb.go` çš„æ–‡ä»¶
- æ’é™¤ï¼šè·¯å¾„åŒ…å« `test_` æˆ– `mock` çš„æ–‡ä»¶
- ç»“æœï¼šåªç”Ÿæˆä¸»é€»è¾‘ç›¸å…³çš„ Go æ–‡ä»¶æ–‡æ¡£

#### ç‰¹æ®Šå¤„ç†è§„åˆ™

1. **è¾“å‡ºæ–‡ä»¶è‡ªæ’é™¤**ï¼šç”Ÿæˆçš„è¾“å‡ºæ–‡ä»¶ä¸ä¼šè¢«åŒ…å«åœ¨æ‰«æç»“æœä¸­ï¼Œå³ä½¿å®ƒç¬¦åˆè¿‡æ»¤æ¡ä»¶

2. **å¤§å°é™åˆ¶å¤„ç†**ï¼šè¶…è¿‡å¤§å°é™åˆ¶çš„æ–‡ä»¶ä¼šè¢«é™é»˜è·³è¿‡ï¼Œé™¤éå¯ç”¨è¯¦ç»†æ¨¡å¼

3. **äºŒè¿›åˆ¶æ–‡ä»¶æ£€æµ‹**ï¼šè‡ªåŠ¨è·³è¿‡æ£€æµ‹ä¸ºäºŒè¿›åˆ¶çš„æ–‡ä»¶ï¼Œé˜²æ­¢æŸå Markdown è¾“å‡º

4. **è·¯å¾„è§„èŒƒåŒ–**ï¼šæ‰€æœ‰è·¯å¾„æ¯”è¾ƒéƒ½åŸºäºç›¸å¯¹äºæ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„

è¿™äº›è¿‡æ»¤è§„åˆ™çš„è®¾è®¡ä½¿å¾— `gen-docs.go` å·¥å…·èƒ½å¤Ÿçµæ´»é€‚åº”å„ç§é¡¹ç›®ç»“æ„å’Œæ–‡æ¡£éœ€æ±‚ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®å…·ä½“åœºæ™¯ç²¾ç¡®æ§åˆ¶å“ªäº›æ–‡ä»¶è¢«åŒ…å«åœ¨æœ€ç»ˆçš„æ–‡æ¡£ä¸­ã€‚

## ä»£ç ç»“æ„å’Œè®¾è®¡æ¨¡å¼åˆ†æ

### æ•´ä½“æ¶æ„

`gen-docs.go` é‡‡ç”¨äº†æ¸…æ™°çš„æ¨¡å—åŒ–è®¾è®¡ï¼ŒæŒ‰ç…§åŠŸèƒ½å°†ä»£ç ç»„ç»‡æˆä¸åŒçš„æ®µè½ï¼Œæ¯ä¸ªæ®µè½è´Ÿè´£ç‰¹å®šçš„åŠŸèƒ½åŸŸï¼š

```
â”œâ”€â”€ é…ç½®ä¸å…¨å±€å˜é‡ (Configuration & Globals)
â”œâ”€â”€ ä¸»å…¥å£ (Main Entry)
â”œâ”€â”€ å‚æ•°è§£æ (Flag Parsing)
â”œâ”€â”€ å¯åŠ¨ä¸æ‘˜è¦ (Startup & Summary)
â”œâ”€â”€ ç›®å½•æ‰«æ (Directory Scanning)
â”œâ”€â”€ å¿½ç•¥è§„åˆ™ (Ignore Rules)
â”œâ”€â”€ æ–‡ä»¶å·¥å…· (File Utilities)
â”œâ”€â”€ Markdown è¾“å‡º (Markdown Output)
â””â”€â”€ æ—¥å¿—è®°å½• (Logging)
```

### è®¾è®¡æ¨¡å¼åº”ç”¨

#### 1. é…ç½®é©±åŠ¨æ¨¡å¼ (Configuration-Driven Pattern)
é€šè¿‡ `Config` ç»“æ„ä½“é›†ä¸­ç®¡ç†æ‰€æœ‰é…ç½®é€‰é¡¹ï¼Œä½¿ç¨‹åºè¡Œä¸ºå®Œå…¨ç”±é…ç½®å†³å®šï¼š

```go
type Config struct {
    RootDir        string
    OutputFile     string
    IncludeExts    []string
    IncludeMatches []string
    ExcludeExts    []string
    ExcludeMatches []string
    MaxFileSize    int64
    NoSubdirs      bool
    Verbose        bool
    Version        bool
}
```

è¿™ç§è®¾è®¡ä½¿å¾—ç¨‹åºæ˜“äºæ‰©å±•å’Œç»´æŠ¤ï¼Œæ–°å¢é…ç½®é¡¹åªéœ€åœ¨ç»“æ„ä½“ä¸­æ·»åŠ å­—æ®µå³å¯ã€‚

#### 2. æ•°æ®ä¼ è¾“å¯¹è±¡ (DTO - Data Transfer Object)
ä½¿ç”¨ `FileMetadata` å’Œ `Stats` ç»“æ„ä½“ä½œä¸ºæ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œåœ¨ä¸åŒå‡½æ•°é—´ä¼ é€’æ•°æ®ï¼š

```go
type FileMetadata struct {
    RelPath   string  // ç›¸å¯¹è·¯å¾„
    FullPath  string  // å®Œæ•´è·¯å¾„
    Size      int64   // æ–‡ä»¶å¤§å°
    LineCount int     // è¡Œæ•°
}

type Stats struct {
    PotentialMatches   int   // ç¬¦åˆåŒ…å«è§„åˆ™çš„æ–‡ä»¶æ•°
    ExplicitlyExcluded int   // ç¬¦åˆåŒ…å«è§„åˆ™ä½†è¢«æ’é™¤è§„åˆ™è¸¢æ‰çš„æ–‡ä»¶æ•°
    FileCount          int   // æœ€ç»ˆå†™å…¥çš„æ–‡ä»¶æ•°
    TotalSize          int64 // æ€»å¤§å°
    TotalLines         int   // æ€»è¡Œæ•°
    Skipped            int   // å®Œå…¨ä¸åŒ¹é…è§„åˆ™çš„æ–‡ä»¶æ•°
}
```

#### 3. å•ä¸€èŒè´£åŸåˆ™ (Single Responsibility Principle)
æ¯ä¸ªå‡½æ•°éƒ½æœ‰æ˜ç¡®çš„å•ä¸€èŒè´£ï¼š

- `parseFlags()` - ä¸“é—¨å¤„ç†å‘½ä»¤è¡Œå‚æ•°è§£æ
- `scanDirectory()` - ä¸“é—¨å¤„ç†ç›®å½•æ‰«æå’Œæ–‡ä»¶è¿‡æ»¤
- `writeMarkdownStream()` - ä¸“é—¨å¤„ç† Markdown æ–‡æ¡£ç”Ÿæˆ
- `isBinaryFile()` - ä¸“é—¨å¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶æ£€æµ‹
- `detectLanguage()` - ä¸“é—¨å¤„ç†è¯­è¨€æ£€æµ‹

#### 4. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)
é€šè¿‡ `languageMap` å®ç°è¯­è¨€æ£€æµ‹ç­–ç•¥ï¼š

```go
var languageMap = map[string]string{
    ".go":    "go",
    ".js":    "javascript",
    ".py":    "python",
    // ...
}
```

è¿™ç§è®¾è®¡ä½¿å¾—æ·»åŠ æ–°çš„ç¼–ç¨‹è¯­è¨€æ”¯æŒå˜å¾—ç®€å•ï¼Œåªéœ€åœ¨æ˜ å°„è¡¨ä¸­æ·»åŠ æ–°æ¡ç›®ã€‚

#### 5. æµå¼å¤„ç†æ¨¡å¼ (Streaming Pattern)
é‡‡ç”¨æµå¼å¤„ç†é¿å…å°†æ•´ä¸ªé¡¹ç›®åŠ è½½åˆ°å†…å­˜ï¼š

```go
func writeMarkdownStream(cfg Config, files []FileMetadata, stats Stats) error {
    f, err := os.Create(cfg.OutputFile)
    if err != nil {
        return err
    }
    defer f.Close()

    w := bufio.NewWriterSize(f, 64*1024)  // ä½¿ç”¨ç¼“å†²å†™å…¥

    // åˆ†æ­¥å†™å…¥å¤´éƒ¨ã€ç›®å½•å’Œæ–‡ä»¶å†…å®¹
    // ...

    return w.Flush()
}
```

#### 6. æ¡ä»¶é€»è¾‘æ¨¡å¼ (Conditional Logic Pattern)
åœ¨ `shouldIgnoreFile` å‡½æ•°ä¸­ä½“ç°äº†å¤æ‚çš„æ¡ä»¶åˆ¤æ–­é€»è¾‘ï¼š

```go
func shouldIgnoreFile(relPath string, size int64, cfg Config) bool {
    // å¤§å°é™åˆ¶æ£€æŸ¥
    if size > cfg.MaxFileSize {
        return true
    }

    // æ’é™¤è§„åˆ™ä¼˜å…ˆ
    for _, e := range cfg.ExcludeExts {
        if ext == e {
            return true
        }
    }

    // åŒ…å«è§„åˆ™æ£€æŸ¥
    if len(cfg.IncludeExts) > 0 {
        found := false
        for _, i := range cfg.IncludeExts {
            if ext == i {
                found = true
                break
            }
        }
        if !found {
            return true
        }
    }

    // ...
}
```

### ä»£ç ç»„ç»‡ç‰¹ç‚¹

#### 1. åŠŸèƒ½åˆ†æ®µæ³¨é‡Š
ä½¿ç”¨åˆ†éš”çº¿æ³¨é‡Šå°†ä»£ç åˆ†æˆé€»è¾‘æ®µè½ï¼š

```go
/*
====================================================
 Configuration & Globals
====================================================
*/
```

è¿™ç§ç»„ç»‡æ–¹å¼æé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚

#### 2. é”™è¯¯å¤„ç†ç­–ç•¥
é‡‡ç”¨ä¸€è‡´çš„é”™è¯¯å¤„ç†æ¨¡å¼ï¼š

```go
if err != nil {
    fmt.Printf("âŒ æ‰«æå¤±è´¥: %v\n", err)
    os.Exit(1)
}
```

å¯¹äºéè‡´å‘½é”™è¯¯ï¼Œç¨‹åºä¼šè®°å½•å¹¶ç»§ç»­æ‰§è¡Œã€‚

#### 3. ç»Ÿè®¡ä¿¡æ¯æ”¶é›†
åœ¨æ•´ä¸ªå¤„ç†è¿‡ç¨‹ä¸­æŒç»­æ”¶é›†ç»Ÿè®¡ä¿¡æ¯ï¼Œæä¾›è¯¦ç»†çš„å¤„ç†åé¦ˆï¼š

```go
var stats Stats
// åœ¨æ‰«æè¿‡ç¨‹ä¸­æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
stats.PotentialMatches++
stats.FileCount++
stats.TotalLines += lineCount
stats.TotalSize += info.Size()
```

#### 4. æ€§èƒ½ä¼˜åŒ–æªæ–½
- ä½¿ç”¨ `bufio.Scanner` å’Œå¤§ç¼“å†²åŒºæé«˜ I/O æ€§èƒ½
- ä½¿ç”¨ `io.Copy` è€Œä¸æ˜¯é€è¡Œè¯»å–æ¥å¤åˆ¶æ–‡ä»¶å†…å®¹
- å¯¹æ–‡ä»¶è¡Œæ•°è®¡ç®—ä½¿ç”¨ä¼˜åŒ–çš„ç¼“å†²åŒºè®¾ç½®

#### 5. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- æä¾›è¿›åº¦æŒ‡ç¤ºå™¨ï¼ˆåœ¨å†™å…¥è¿‡ç¨‹ä¸­æ˜¾ç¤ºç™¾åˆ†æ¯”ï¼‰
- æä¾›è¯¦ç»†æ¨¡å¼ï¼ˆverboseï¼‰ç”¨äºè°ƒè¯•
- æä¾›æ¸…æ™°çš„å¯åŠ¨ä¿¡æ¯å’Œå®Œæˆæ‘˜è¦

### è®¾è®¡ä¼˜åŠ¿

1. **å¯æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ä½¿å¾—æ·»åŠ æ–°åŠŸèƒ½æˆ–ä¿®æ”¹ç°æœ‰åŠŸèƒ½å˜å¾—å®¹æ˜“
2. **å¯ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„å‡½æ•°èŒè´£åˆ†ç¦»å’Œè‰¯å¥½çš„æ³¨é‡Šç»„ç»‡
3. **å¥å£®æ€§**ï¼šå…¨é¢çš„é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µå¤„ç†
4. **æ€§èƒ½**ï¼šæµå¼å¤„ç†å’Œç¼“å†² I/O ä¼˜åŒ–
5. **ç”¨æˆ·ä½“éªŒ**ï¼šè¯¦ç»†çš„è¿›åº¦åé¦ˆå’Œæ¸…æ™°çš„è¾“å‡ºæ ¼å¼

è¿™ç§è®¾è®¡ä½“ç°äº† Go è¯­è¨€ç®€æ´ã€é«˜æ•ˆã€å®ç”¨çš„ç‰¹ç‚¹ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å‘½ä»¤è¡Œå·¥å…·è®¾è®¡èŒƒä¾‹ã€‚

## è¾“å‡ºæ ¼å¼å’Œç‰¹æ®Šå¤„ç†æœºåˆ¶

### è¾“å‡ºæ–‡ä»¶ç»“æ„

ç”Ÿæˆçš„ Markdown æ–‡æ¡£éµå¾ªä»¥ä¸‹ç»“æ„ï¼š

```
# Project Documentation
â”œâ”€â”€ ç”Ÿæˆä¿¡æ¯ï¼ˆæ—¶é—´ã€ç›®å½•ã€ç»Ÿè®¡ï¼‰
â”œâ”€â”€ ç›®å½•éƒ¨åˆ†ï¼ˆå¸¦é”šç‚¹çš„æ–‡ä»¶åˆ—è¡¨ï¼‰
â”œâ”€â”€ åˆ†éš”çº¿
â”œâ”€â”€ å„æ–‡ä»¶å†…å®¹ï¼ˆå¸¦è¯­æ³•é«˜äº®ï¼‰
â””â”€â”€ ç»Ÿè®¡æ±‡æ€»
```

### è¯¦ç»†è¾“å‡ºæ ¼å¼

#### 1. æ–‡æ¡£å¤´éƒ¨
```markdown
# Project Documentation

- **Generated at:** 2026-01-12 10:30:45
- **Root Dir:** `/path/to/project`
- **File Count:** 25
- **Total Size:** 125.67 KB
```

å¤´éƒ¨åŒ…å«ç”Ÿæˆæ—¶é—´ã€æºç›®å½•ã€æ–‡ä»¶æ•°é‡å’Œæ€»å¤§å°ç­‰å…ƒä¿¡æ¯ã€‚

#### 2. ç›®å½•éƒ¨åˆ†
```markdown
<a name="toc"></a>
## ğŸ“‚ æ‰«æç›®å½•
- [main.go](#ğŸ“„-maingo) (45 lines, 1.23 KB)
- [utils/helper.go](#ğŸ“„-utilshelpergo) (120 lines, 3.45 KB)
- [config/config.yaml](#ğŸ“„-configconfigyaml) (25 lines, 0.89 KB)
```

- ä¸ºæ¯ä¸ªæ–‡ä»¶åˆ›å»ºé”šç‚¹ï¼Œæ–¹ä¾¿åœ¨æ–‡æ¡£å†…è·³è½¬
- æ˜¾ç¤ºæ–‡ä»¶è·¯å¾„ã€è¡Œæ•°å’Œå¤§å°ä¿¡æ¯
- ä½¿ç”¨ `ğŸ“„` å›¾æ ‡æ ‡è¯†æ–‡ä»¶

#### 3. æ–‡ä»¶å†…å®¹éƒ¨åˆ†
```markdown
## ğŸ“„ src/main.go

```go
package main

import (
    "fmt"
    "os"
)

func main() {
    fmt.Println("Hello, World!")
}
```

[â¬† å›åˆ°ç›®å½•](#toc)
```

- æ¯ä¸ªæ–‡ä»¶ä»¥ `## ğŸ“„ æ–‡ä»¶è·¯å¾„` ä½œä¸ºæ ‡é¢˜
- ä½¿ç”¨å¯¹åº”ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•é«˜äº®
- æ¯ä¸ªæ–‡ä»¶æœ«å°¾æ·»åŠ è¿”å›ç›®å½•çš„é“¾æ¥

#### 4. ç»Ÿè®¡æ±‡æ€»
```markdown
---
### ğŸ“Š æœ€ç»ˆç»Ÿè®¡æ±‡æ€»
- **æ–‡ä»¶æ€»æ•°:** 25
- **ä»£ç æ€»è¡Œæ•°:** 1250
- **ç‰©ç†æ€»å¤§å°:** 125.67 KB
```

### ç‰¹æ®Šå¤„ç†æœºåˆ¶

#### 1. è¯­è¨€æ£€æµ‹æœºåˆ¶
é€šè¿‡ `detectLanguage` å‡½æ•°å®ç°ï¼š

```go
func detectLanguage(path string) string {
    ext := strings.ToLower(filepath.Ext(path))
    if lang, ok := languageMap[ext]; ok {
        return lang
    }
    return "text"  // é»˜è®¤ä¸ºçº¯æ–‡æœ¬
}
```

æ”¯æŒçš„è¯­è¨€åŒ…æ‹¬ï¼š
- ç¼–ç¨‹è¯­è¨€ï¼šGo, JavaScript, TypeScript, Python, Java, C/C++, Rust, Ruby, PHP ç­‰
- æ ‡è®°è¯­è¨€ï¼šHTML, CSS, Markdown, YAML, JSON ç­‰
- é…ç½®æ–‡ä»¶ï¼šXML, TOML, INI, conf ç­‰
- è„šæœ¬è¯­è¨€ï¼šShell, PowerShell, Ruby ç­‰

#### 2. é”šç‚¹ç”Ÿæˆæœºåˆ¶
ä¸ºæ¯ä¸ªæ–‡ä»¶ç”Ÿæˆå”¯ä¸€çš„é”šç‚¹ï¼Œä¾¿äºå†…éƒ¨è·³è½¬ï¼š

```go
// ç”Ÿæˆé”šç‚¹ï¼Œæ–¹ä¾¿åœ¨ Markdown ä¸­ç‚¹å‡»è·³è½¬
anchor := strings.ReplaceAll(file.RelPath, " ", "-")
anchor = strings.ReplaceAll(anchor, ".", "")
anchor = strings.ReplaceAll(anchor, "/", "")
anchor = strings.ToLower(anchor)
```

é”šç‚¹ç”Ÿæˆè§„åˆ™ï¼š
- ç©ºæ ¼æ›¿æ¢ä¸ºè¿å­—ç¬¦ `-`
- ç§»é™¤æ‰€æœ‰å¥ç‚¹ `.`
- ç§»é™¤æ‰€æœ‰æ–œæ  `/`
- è½¬æ¢ä¸ºå°å†™

#### 3. äºŒè¿›åˆ¶æ–‡ä»¶æ£€æµ‹æœºåˆ¶
é€šè¿‡å¤šé‡æ£€æŸ¥é˜²æ­¢äºŒè¿›åˆ¶æ–‡ä»¶æ±¡æŸ“è¾“å‡ºï¼š

```go
func isBinaryFile(path string) bool {
    // å¿«é€Ÿè·¯å¾„ï¼šå‹ç¼©æ–‡ä»¶
    if strings.Contains(path, ".min.") {
        return true
    }

    f, err := os.Open(path)
    if err != nil {
        return true
    }
    defer f.Close()

    // åªè¯»å‰ 512 å­—èŠ‚
    buf := make([]byte, 512)
    n, err := f.Read(buf)
    if err != nil && err != io.EOF {
        return false
    }
    buf = buf[:n]

    // NULL å­—èŠ‚æ£€æµ‹
    for _, b := range buf {
        if b == 0 {
            return true
        }
    }

    // UTF-8 æœ‰æ•ˆæ€§æ£€æµ‹
    return !utf8.Valid(buf)
}
```

æ£€æµ‹é€»è¾‘ï¼š
1. æ£€æŸ¥æ–‡ä»¶åæ˜¯å¦åŒ…å« `.min.`ï¼ˆé€šå¸¸è¡¨ç¤ºå‹ç¼©æ–‡ä»¶ï¼‰
2. æ£€æŸ¥æ–‡ä»¶å‰ 512 å­—èŠ‚æ˜¯å¦åŒ…å« NULL å­—èŠ‚
3. æ£€æŸ¥æ–‡ä»¶å‰ 512 å­—èŠ‚æ˜¯å¦ä¸ºæœ‰æ•ˆçš„ UTF-8 ç¼–ç 

#### 4. è¡Œæ•°ç»Ÿè®¡æœºåˆ¶
ä½¿ç”¨ä¼˜åŒ–çš„ç¼“å†²åŒºè®¾ç½®ç»Ÿè®¡æ–‡ä»¶è¡Œæ•°ï¼š

```go
func countLines(path string) (int, error) {
    f, err := os.Open(path)
    if err != nil {
        return 0, err
    }
    defer f.Close()

    count := 0
    scanner := bufio.NewScanner(f)
    // å¢åŠ ç¼“å†²åŒºä»¥æ”¯æŒè¶…é•¿è¡Œ
    buf := make([]byte, 0, 64*1024)
    scanner.Buffer(buf, 1024*1024)
    for scanner.Scan() {
        count++
    }
    return count, scanner.Err()
}
```

- ä½¿ç”¨å¤§ç¼“å†²åŒºï¼ˆ64KB åˆå§‹ï¼Œ1MB æœ€å¤§ï¼‰å¤„ç†å¯èƒ½çš„é•¿è¡Œ
- é¿å…å› å•è¡Œè¿‡é•¿å¯¼è‡´çš„æ‰«æå™¨é”™è¯¯

#### 5. æµå¼å†™å…¥æœºåˆ¶
ä½¿ç”¨ `io.Copy` å®ç°é«˜æ•ˆçš„æ–‡ä»¶å†…å®¹å¤åˆ¶ï¼š

```go
func copyFileContent(w *bufio.Writer, file FileMetadata) error {
    src, err := os.Open(file.FullPath)
    if err != nil {
        return err
    }
    defer src.Close()

    lang := detectLanguage(file.RelPath)

    fmt.Fprintln(w)
    fmt.Fprintf(w, "## ğŸ“„ %s\n\n", file.RelPath)
    fmt.Fprintf(w, "````%s\n", lang)

    // ä½¿ç”¨ io.Copy æ›¿ä»£ scannerï¼Œæ›´å®‰å…¨ä¸”ä¸é™è¡Œé•¿
    if _, err := io.Copy(w, src); err != nil {
        return err
    }

    fmt.Fprintln(w, "\n````")
    fmt.Fprintln(w, "\n[â¬† å›åˆ°ç›®å½•](#toc)")
    return nil
}
```

- ä½¿ç”¨ `io.Copy` é¿å…é€è¡Œè¯»å–çš„æ€§èƒ½å¼€é”€
- ä¸é™åˆ¶å•è¡Œé•¿åº¦ï¼Œé€‚åˆå¤„ç†å„ç§ç±»å‹çš„æ–‡æœ¬æ–‡ä»¶

#### 6. è¿›åº¦æŒ‡ç¤ºæœºåˆ¶
åœ¨å†™å…¥è¿‡ç¨‹ä¸­æä¾›å®æ—¶è¿›åº¦åé¦ˆï¼š

```go
total := len(files)
for i, file := range files {
    if !cfg.Verbose && (i%10 == 0 || i == total-1) {
        fmt.Printf("\rğŸš€ å†™å…¥è¿›åº¦: %d/%d (%.1f%%)", i+1, total, float64(i+1)/float64(total)*100)
    }
    // ...
}
```

- æ¯å¤„ç† 10 ä¸ªæ–‡ä»¶æˆ–æœ€åä¸€ä¸ªæ–‡ä»¶æ—¶æ›´æ–°è¿›åº¦
- ä½¿ç”¨ `\r` å®ç°åŸåœ°æ›´æ–°ï¼ŒèŠ‚çœå±å¹•ç©ºé—´
- ä½¿ç”¨ç«ç®­å›¾æ ‡ `ğŸš€` å¢åŠ è§†è§‰æ•ˆæœ

#### 7. é”™è¯¯æ¢å¤æœºåˆ¶
åœ¨é‡åˆ°å•ä¸ªæ–‡ä»¶é”™è¯¯æ—¶ç»§ç»­å¤„ç†å…¶ä»–æ–‡ä»¶ï¼š

```go
if err := copyFileContent(w, file); err != nil {
    logf(true, "\nâš  è¯»å–å¤±è´¥ %s: %v", file.RelPath, err)
    continue  // ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªæ–‡ä»¶
}
```

- å•ä¸ªæ–‡ä»¶é”™è¯¯ä¸å½±å“æ•´ä½“å¤„ç†æµç¨‹
- è®°å½•é”™è¯¯ä¿¡æ¯ä¾›ç”¨æˆ·å‚è€ƒ

è¿™äº›ç‰¹æ®Šå¤„ç†æœºåˆ¶ç¡®ä¿äº† `gen-docs.go` å·¥å…·èƒ½å¤Ÿç¨³å¥åœ°å¤„ç†å„ç§ç±»å‹çš„é¡¹ç›®å’Œæ–‡ä»¶ï¼Œç”Ÿæˆé«˜è´¨é‡çš„ Markdown æ–‡æ¡£ï¼ŒåŒæ—¶æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚
