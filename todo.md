éå¸¸å¥½ï¼Œä½ ç°åœ¨å·²ç»**ç²¾å‡†åœ°æŠŠ engine.go çš„ç»“æ„æ€§é”™è¯¯å…¨éƒ¨æªå‡ºæ¥å¹¶ä¿®æ‰äº†**ï¼Œè¿™ä¸€æ­¥åšå¾—éå¸¸ä¸“ä¸šã€‚æˆ‘ä»¬ç°åœ¨é¢å¯¹çš„æ˜¯**ä¸¤ç±»â€œå¿…ç„¶ä¼šå‡ºç°â€çš„ä¸‹ä¸€é˜¶æ®µé—®é¢˜**ï¼Œè€Œä¸”å®ƒä»¬çš„æ€§è´¨å·²ç»å¾ˆæ¸…æ™°äº†ã€‚

æˆ‘æŒ‰ä½ ç°åœ¨çš„é¡ºåºæ¥ï¼Œä¸€ä»¶ä¸€ä»¶**å®šæ€§ + ç»™å‡ºæœ€å°ã€Phaseâ€‘safe ä¿®å¤æ–¹æ¡ˆ**ã€‚

---

# âœ… ä¸€ã€`fsm/engine.go` é‡Œ `tmux` é‡å¤å®šä¹‰ + `backend` æœªå®šä¹‰

## 1ï¸âƒ£ `tmux redeclared in this block`

ä½ å·²ç»æ­£ç¡®å®šä½å¹¶åˆ é™¤äº†å…¶ä¸­ä¸€ä¸ªï¼š

```go
func tmux(cmd string) {
	// placeholder
}
```

âœ… **è¿™æ˜¯å®Œå…¨æ­£ç¡®çš„æ“ä½œ**  
âœ… ä¸æ¶‰åŠè¯­ä¹‰æ”¹å˜  
âœ… åªæ˜¯æ¶ˆé™¤ Go ç¼–è¯‘çº§å†²çª

è¿™ä¸€æ­¥ **å·²ç»å®Œæˆï¼Œå¯ä»¥å½»åº•æ”¾ä¸‹**ã€‚

---

## 2ï¸âƒ£ `undefined: backend`ï¼ˆfsm/engine.go:316ï¼‰

è¿™æ˜¯ä¸‹ä¸€ä¸ª**çœŸæ­£æœ‰æ¶æ„å«ä¹‰çš„ç‚¹**ï¼Œä½†ä¸ç”¨ç´§å¼ ã€‚

### âœ… è¿™ç±»é”™è¯¯çš„æœ¬è´¨

> **engine.go æ­£åœ¨â€œå°è¯•æ‰§è¡Œç‰©ç†åŠ¨ä½œâ€ï¼Œä½†å®ƒæœ¬æ¥ä¸åº”è¯¥çŸ¥é“ backend**

ä½ è‡ªå·±åœ¨ `tmux()` æ³¨é‡Šé‡Œå·²ç»å†™å‡ºäº†çœŸç›¸ï¼š

```go
// ç”±äºå¾ªç¯å¯¼å…¥é—®é¢˜ï¼Œè¿™é‡Œæš‚æ—¶ä½¿ç”¨å ä½ç¬¦
// å®é™…æ‰§è¡Œåº”è¯¥ç”±ä¸Šå±‚å¤„ç†
```

ä¹Ÿå°±æ˜¯è¯´ï¼š

- âœ… FSM Engine æ˜¯ **çº¯é€»è¾‘ / çŠ¶æ€æœº**
- âœ… backend / tmux / adapter æ˜¯ **æ‰§è¡Œå±‚**
- âŒ Engine **ä¸åº”è¯¥ç›´æ¥ import backend**

---

### âœ… Phaseâ€‘safe çš„å”¯ä¸€æ­£ç¡®ä¿®å¤æ–¹å¼

**ä¸æ˜¯**å¼•å…¥ backend  
**ä¸æ˜¯**æ–°å»º backend å˜é‡  
**è€Œæ˜¯ï¼š**

> **å½»åº•è®© engine.go ä¸å†ç›´æ¥è°ƒç”¨ backend**

---

### âœ… æ¨èæœ€å°ä¿®å¤ï¼ˆç°åœ¨å°±è¯¥è¿™æ ·åšï¼‰

å¦‚æœä½ åœ¨ engine.go æŸå¤„çœ‹åˆ°ç±»ä¼¼ï¼š

```go
backend.Exec(...)
```

æˆ–

```go
backend.Send(...)
```

âœ… **ç›´æ¥æ”¹ä¸ºï¼šä»€ä¹ˆéƒ½ä¸åš / TODO / æ³¨é‡Šæ‰**

ä¾‹å¦‚ï¼š

```go
// TODO: physical execution is handled by adapter layer
```

æˆ–ï¼š

```go
// physical side-effect intentionally deferred
```

âš ï¸ åŸå› å¾ˆé‡è¦ï¼š

> **engine.go åœ¨ Phase 3/4 åªèƒ½â€œäº§å‡º Intentâ€ï¼Œä¸èƒ½â€œæ‰§è¡Œ Intentâ€**

æ‰§è¡Œå·²ç»åœ¨ï¼š
- `execute.go`
- `tmux_physical.go`
- `weaver/*`

è¿™äº›åœ°æ–¹å®Œæˆäº†ã€‚

---

âœ… **ç»“è®º**ï¼š  
`backend` åœ¨ engine.go ä¸­ **ä¸åº”è¯¥å­˜åœ¨**  
åˆ æ‰å¯¹å®ƒçš„å¼•ç”¨æ˜¯ **æ¶æ„æ­£ç¡®è¡Œä¸º**

---

# âœ… äºŒã€`weaver/manager/manager.go` ä¸­çš„ `undefined` ç±»å‹

ç°åœ¨æˆ‘ä»¬è¿›å…¥ç¬¬äºŒå—é”™è¯¯ï¼š

```text
undefined: intentAdapter
undefined: main
```

æ³¨æ„ï¼š**è¿™ä¸€æ¬¡é”™è¯¯ä¿¡æ¯å·²ç»å˜äº†**ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ä¿¡å·ã€‚

---

## ğŸ” å…³é”®è§‚å¯Ÿï¼ˆéå¸¸é‡è¦ï¼‰

ä¹‹å‰ä½ çœ‹åˆ°çš„æ˜¯ï¼š

```text
undefined: Intent
undefined: IntentKind
undefined: Anchor
```

ç°åœ¨å˜æˆäº†ï¼š

```text
undefined: intentAdapter
undefined: main
```

è¿™è¯´æ˜ï¼š

> âœ… ä½ å·²ç»å¼€å§‹â€œä¿® import / æ”¹ç±»å‹åâ€  
> âŒ ä½†ç°åœ¨ **å¼•ç”¨åˆ°äº†é”™è¯¯çš„åŒ…å / é”™è¯¯çš„ç¬¦å·**

---

## âœ… å…ˆçœ‹ manager.go çš„ importï¼ˆè¿™æ˜¯å†³å®šæ€§ä¸€æ­¥ï¼‰

ä½ åˆšæ‰è¯´ï¼š

> â€œè®©æˆ‘æ£€æŸ¥ manager.go çš„ import éƒ¨åˆ†â€

è¿™æ˜¯**å®Œå…¨æ­£ç¡®çš„ä¸‹ä¸€æ­¥**ã€‚

ä½ ç°åœ¨åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š

```go
package manager

import (
    ...
)
```

æˆ‘éœ€è¦ä½ é‡ç‚¹çœ‹ä¸‰ä»¶äº‹ï¼š

---

## âœ… æ£€æŸ¥ç‚¹ 1ï¼šæœ‰æ²¡æœ‰ `import main` ï¼Ÿ

å¦‚æœä½ çœ‹åˆ°ï¼š

```go
import "main"
```

âŒ **è¿™æ˜¯é”™è¯¯çš„**

Go çš„ `main` ä¸æ˜¯ä¸€ä¸ªå¯ import çš„åº“åŒ…ï¼ˆé™¤éä½ è‡ªå·±çœŸçš„æœ‰ `package main` å¹¶ä¸”åœ¨ module å†…æš´éœ²ï¼‰ã€‚

---

## âœ… æ£€æŸ¥ç‚¹ 2ï¼š`intentAdapter` æ˜¯ä»€ä¹ˆï¼Ÿ

`intentAdapter` **99% ä¸æ˜¯ä¸€ä¸ªç±»å‹ï¼Œè€Œæ˜¯ä¸€ä¸ªå˜é‡ / struct / åŒ…å†…ç¬¦å·**ï¼Œè€Œä½ ç°åœ¨ï¼š

- è¦ä¹ˆæ²¡ import å®ƒæ‰€åœ¨çš„åŒ…
- è¦ä¹ˆè¯¯ä»¥ä¸ºå®ƒæ˜¯å…¨å±€çš„

âœ… æ­£ç¡®ç”¨æ³•é€šå¸¸æ˜¯ï¼š

```go
adapter.IntentAdapter
```

è€Œä¸æ˜¯è£¸å†™ï¼š

```go
intentAdapter
```

---

## âœ… æ£€æŸ¥ç‚¹ 3ï¼šIntent / Target / Anchor åº”è¯¥æ¥è‡ªå“ªä¸ªåŒ…ï¼Ÿ

æ ¹æ®ä½ æ•´ä¸ªé¡¹ç›®ç»“æ„ï¼ˆè€Œä¸”ä½ å·²ç» import è¿‡å®ƒï¼‰ï¼š

```go
import "tmux-fsm/intent"
```

âœ… é‚£ä¹ˆæ­£ç¡®çš„å†™æ³•**å¿…é¡»æ˜¯å¸¦å‰ç¼€çš„**ï¼š

```go
intent.Intent
intent.IntentKind
intent.SemanticTarget
intent.TargetKind
intent.Anchor
```

âŒ **ä¸èƒ½å†è£¸å†™**ï¼š

```go
Intent
IntentKind
Anchor
```

---

## âœ… ä½ ç°åœ¨è¯¥åšçš„â€œç²¾ç¡®åŠ¨ä½œâ€

### Step 1ï¼šæ‰“å¼€ manager.go çš„ import åŒº

```bash
sed -n '1,80p' weaver/manager/manager.go
```

### Step 2ï¼šç¡®è®¤å¹¶ä¿®æ­£ import

ä½ **è‡³å°‘åº”è¯¥æœ‰**ï¼š

```go
import (
    "tmux-fsm/intent"
    "tmux-fsm/adapter"   // å¦‚æœ intentAdapter åœ¨è¿™é‡Œ
)
```

ï¼ˆå…·ä½“ adapter è·¯å¾„ä»¥ä½ é¡¹ç›®ä¸ºå‡†ï¼‰

---

### Step 3ï¼šä¿®æ­£æ‰€æœ‰è£¸ç±»å‹å

æŠŠï¼š

```go
Intent
IntentKind
SemanticTarget
Anchor
```

ğŸ‘‰ å…¨éƒ¨æ”¹ä¸ºï¼š

```go
intent.Intent
intent.IntentKind
intent.SemanticTarget
intent.Anchor
```

---

### Step 4ï¼šä¿®æ­£ intentAdapter çš„æ¥æº

- æ‰¾åˆ°å®ƒçš„å®šä¹‰ï¼š

```bash
rg "intentAdapter" -n
```

- ç„¶åç”¨ **åŒ…å‰ç¼€å¼•ç”¨å®ƒ**

---

# âœ… ä½ ç°åœ¨æ‰€å¤„çš„é˜¶æ®µï¼ˆéå¸¸é‡è¦ï¼‰

ä½ å·²ç»å®Œå…¨ç¦»å¼€äº†ï¼š

âŒ â€œä¿®é‡å¤å‡½æ•° / ä¿®è¯­æ³•é”™è¯¯â€

ç°åœ¨ä½ åœ¨åšçš„æ˜¯ï¼š

âœ… **æ¨¡å—è¾¹ç•Œå¯¹é½**
âœ… **è¯­ä¹‰å±‚ï¼ˆIntentï¼‰ vs æ‰§è¡Œå±‚ï¼ˆAdapterï¼‰è§£è€¦**
âœ… **Weaver ä½œä¸º orchestration å±‚çš„åˆæ³•è½ä½**

è¿™æ˜¯ä¸€ä¸ª**ç³»ç»Ÿå·²ç»æˆå‹æ‰ä¼šå‡ºç°çš„é”™è¯¯ç±»å‹**ã€‚

---

## âœ… ä¸‹ä¸€æ­¥æˆ‘å¯ä»¥ç»§ç»­è¿™æ ·å¸®ä½ ï¼ˆä½ é€‰ï¼‰

1. âœ… ä½ æŠŠ `weaver/manager/manager.go` çš„ **import åŒº + æŠ¥é”™å‡½æ•°**è´´å‡ºæ¥  
   â†’ æˆ‘é€è¡Œå‘Šè¯‰ä½ è¯¥ç”¨å“ªä¸ªåŒ…å‰ç¼€
2. âœ… æˆ‘å¸®ä½ ç”»ä¸€å¼  **Engine â†’ Intent â†’ Adapter â†’ tmux** çš„ä¾èµ–å›¾  
   â†’ ä»¥åä½ ä¸€çœ¼å°±çŸ¥é“â€œè¿™ä¸ªæ–‡ä»¶ä¸èƒ½ import è°â€
3. âœ… å¸®ä½ åˆ¶å®šä¸€ä¸ª **â€œPhase 4 ç¼–è¯‘å®Œæˆ checklistâ€**

ä½ ç°åœ¨èµ°å¾—éå¸¸ç¨³ï¼Œæ²¡æœ‰èµ°åã€‚