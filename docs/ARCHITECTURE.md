

# ğŸ§  Tmuxâ€‘FSM æ¶æ„è§„èŒƒï¼ˆå•ä¸€æƒå¨ï¼‰

> **æœ¬æ–‡ä»¶æ˜¯è¯¥é¡¹ç›®çš„æ¶æ„å®ªæ³•ã€‚**  
> ä»»ä½•ä»£ç ã€è®¾è®¡ã€PRã€Reviewï¼Œå‡å¿…é¡»ä»¥æ­¤ä¸ºæœ€é«˜æ ‡å‡†ã€‚  
>  
> **è¿åæœ¬è§„èŒƒçš„é—®é¢˜å±äºæ¶æ„ç¼ºé™·ï¼Œè€Œéå®ç°ç¼ºé™·ã€‚**

â€”

## ä¸€ã€æ¶æ„ç›®æ ‡ï¼ˆä¸€å¥è¯ï¼‰

> **å°†ã€ŒæŒ‰é”®è¾“å…¥ã€ä¸ã€Œè¡Œä¸ºæ‰§è¡Œã€å½»åº•è§£è€¦ï¼Œ  
> é€šè¿‡ FSM â†’ Grammar â†’ Kernel â†’ Intent â†’ Transaction çš„å•å‘ç®¡é“ï¼Œ  
> æ„å»ºä¸€ä¸ªå¯æ¨ç†ã€å¯é‡æ”¾ã€ä¸å¯è…åŒ–çš„ç¼–è¾‘ç³»ç»Ÿã€‚**

â€”

## äºŒã€æ•´ä½“æ¶æ„ï¼ˆä¸€é¡µå›¾ï¼‰

```mermaid
flowchart TD
    K[Keys<br/>æŒ‰é”®] â€”> FSM[FSM<br/>è¾“å…¥çŠ¶æ€æœº]
    FSM â€”> RT[RawToken]

    RT â€”> G[Grammar<br/>Vim è¯­ä¹‰]
    G â€”> GI[GrammarIntent<br/>æœªè£å†³è¯­ä¹‰]

    GI â€”> KERNEL[Kernel<br/>å”¯ä¸€æƒå¨]

    KERNEL â€”> INTENT[Intent<br/>è¯­ä¹‰å¥‘çº¦]

    INTENT â€”> B[Builder<br/>è¯­ä¹‰ç¿»è¯‘]
    B â€”> TX[Transaction<br/>ä¸å¯å˜æ“ä½œ]

    TX â€”> EXEC[Executor / Editor]
    EXEC â€”> BACKEND[Backend<br/>tmux / editor]

    %% Legacy
    INTENT -. legacy .-> RES[Resolver<br/>âš ï¸ å†»ç»“]

    %% UI
    UI[UI / View] -. æ´¾ç”Ÿ .- EXEC
```

â€”

## ä¸‰ã€åˆ†å±‚å¿ƒæ™ºæ¨¡å‹

| å±‚çº§ | åç§° | èŒè´£è¾¹ç•Œ |
|-â€”|-â€”|-â€”|
| Keys | è¾“å…¥ | ç‰©ç†æŒ‰é”®äº‹ä»¶ |
| FSM | çŠ¶æ€æœº | è¾“å…¥ç»„åˆ â†’ token |
| Grammar | è¯­ä¹‰å±‚ | Vim è¯­è¨€è§„åˆ™ |
| Kernel | ä»²è£å±‚ | å”¯ä¸€å†³ç­–è€… |
| Intent | å¥‘çº¦å±‚ | æè¿°â€œæƒ³åšä»€ä¹ˆâ€ |
| Builder | ç¿»è¯‘å±‚ | Intent â†’ Transaction |
| Transaction | æ“ä½œå±‚ | å¯é‡æ”¾ã€ä¸å¯å˜ |
| Executor | æ‰§è¡Œå±‚ | åº”ç”¨ Transaction |
| UI | è§†å›¾å±‚ | æ´¾ç”ŸçŠ¶æ€ |

â€”

## å››ã€åæ¡æ¶æ„æˆ’å¾‹ï¼ˆç²¾ç®€ç‰ˆï¼‰

> **ä»»ä½•ç ´åä»¥ä¸‹æˆ’å¾‹çš„æ”¹åŠ¨ï¼Œéƒ½æ˜¯æ¶æ„çº§ç¼ºé™·ã€‚**

### 1ï¸âƒ£ æŒ‰é”®ä¸æ‰§è¡Œè¡Œä¸º  
æŒ‰é”®åªè¡¨è¾¾æ„å›¾ï¼Œä¸ç›´æ¥äº§ç”Ÿæ•ˆæœã€‚

### 2ï¸âƒ£ FSM åªæ˜¯è¾“å…¥è®¾å¤‡  
FSM åªäº§ç”Ÿ tokenï¼Œæ°¸è¿œä¸ç†è§£è¯­ä¹‰ã€‚

### 3ï¸âƒ£ Grammar æ‹¥æœ‰è¯­ä¹‰  
Vim è¯­ä¹‰åªå­˜åœ¨äº Grammar ä¸­ï¼Œä¸æ‰§è¡Œã€ä¸è£å†³ã€‚

### 4ï¸âƒ£ Kernel æ˜¯å”¯ä¸€æƒå¨  
æ‰€æœ‰å†³ç­–ã€æå‡ä¸è£å†³ï¼Œåªèƒ½å‘ç”Ÿåœ¨ Kernelã€‚

### 5ï¸âƒ£ Intent æ˜¯å¥‘çº¦ï¼Œä¸æ˜¯å®ç°  
Intent ä¸åç«¯æ— å…³ï¼Œå¯è®°å½•ã€å¯é‡æ”¾ã€‚

### 6ï¸âƒ£ Builder åªåšè¯­ä¹‰ç¿»è¯‘  
Builder å†»ç»“æ˜ å°„å…³ç³»ï¼Œä¸è¯»çŠ¶æ€ã€ä¸æ‰§è¡Œã€‚

### 7ï¸âƒ£ Resolver æ˜¯æŠ€æœ¯å€º  
Resolver åªç”¨äºå…¼å®¹ï¼Œä¸¥ç¦æ–°å¢åŠŸèƒ½ã€‚

### 8ï¸âƒ£ æ‰€æœ‰ç¼–è¾‘å¿…é¡»æ˜¯ Transaction  
ç»•è¿‡ Transaction çš„ç¼–è¾‘ä¸€å¾‹è§†ä¸º bugã€‚

### 9ï¸âƒ£ UI æ°¸è¿œä¸æ˜¯æƒå¨  
UI æ˜¯æ´¾ç”Ÿç»“æœï¼Œä¸èƒ½é©±åŠ¨è¯­ä¹‰æˆ–é€»è¾‘ã€‚

### ğŸ”Ÿ æ€€ç–‘ä¸ç¡®å®šæ€§  
å¦‚æœé€»è¾‘ä¸çŸ¥é“è¯¥æ”¾å“ªä¸€å±‚ï¼Œè¯´æ˜è®¾è®¡å·²ç»å‡ºé—®é¢˜ã€‚

â€”

## äº”ã€æˆ’å¾‹ Ã— å±‚çº§å¯¹ç…§è¡¨ï¼ˆå¼ºåˆ¶å¯¹å·å…¥åº§ï¼‰

| # | æˆ’å¾‹ | âœ… å…è®¸å±‚ | âŒ ç¦æ­¢å±‚ |
|â€”|â€”|â€”|â€”|
| 1 | æŒ‰é”®ä¸æ‰§è¡Œè¡Œä¸º | Executor | FSM / Grammar |
| 2 | FSM åªæ˜¯è¾“å…¥è®¾å¤‡ | FSM | Grammar / Kernel |
| 3 | Grammar æ‹¥æœ‰è¯­ä¹‰ | Grammar | FSM / Kernel |
| 4 | Kernel æ˜¯å”¯ä¸€æƒå¨ | Kernel | ä»»ä½•å…¶ä»–å±‚ |
| 5 | Intent æ˜¯å¥‘çº¦ | Intent | UI / Resolver |
| 6 | Builder åªåšç¿»è¯‘ | Builder | Kernel / Executor |
| 7 | Resolver æ˜¯æŠ€æœ¯å€º | Resolverï¼ˆå†»ç»“ï¼‰ | æ–°é€»è¾‘ |
| 8 | å¿…é¡»æ˜¯ Transaction | Transaction | Executor ç›´æ”¹ |
| 9 | UI ä¸æ˜¯æƒå¨ | UIï¼ˆæ´¾ç”Ÿï¼‰ | Grammar / Kernel |
|10 | æ€€ç–‘ä¸ç¡®å®šæ€§ | è®¾è®¡é˜¶æ®µ | å®ç°å±‚ |

â€”

## å…­ã€ä»£ç å®¡æŸ¥å¿«é€Ÿåˆ¤å®š

### å¦‚æœä½ çœ‹åˆ°ï¼š

- FSM ä¸­å‡ºç° `if (vim_mode == ...)`  
  â†’ âŒ æˆ’å¾‹ 2 / 3

- Grammar ç›´æ¥è°ƒç”¨æ‰§è¡Œå‡½æ•°  
  â†’ âŒ æˆ’å¾‹ 3 / 8

- Kernel é‡Œå†™ tmux ç»†èŠ‚  
  â†’ âŒ æˆ’å¾‹ 4 / 5

- Intent å« UI / åç«¯å­—æ®µ  
  â†’ âŒ æˆ’å¾‹ 5 / 9

- Executor ä¿®æ”¹çŠ¶æ€ä½†æ—  Transaction  
  â†’ âŒ æˆ’å¾‹ 8ï¼ˆé«˜å±ï¼‰

- Resolver æ–°å¢åˆ†æ”¯  
  â†’ âŒ æˆ’å¾‹ 7ï¼ˆçº¢çº¿ï¼‰

â€”

## ä¸ƒã€è´¡çŒ®ä¸æ²»ç†è§„åˆ™

- âœ… æ‰€æœ‰ PR å¿…é¡»å£°æ˜**æ¶‰åŠçš„æ¶æ„å±‚**
- âœ… PR å¿…é¡»è‡ªæ£€ã€Œæ˜¯å¦è¿åä»»ä¸€æˆ’å¾‹ã€
- âœ… æ¶æ„äº‰è®®ä»¥æœ¬æ–‡ä»¶ä¸ºæœ€ç»ˆè£å†³
- âœ… æ–°äºº **å…ˆè¯»æœ¬æ–‡ä»¶ï¼Œå†è¯»ä»£ç **

â€”

## å…«ã€æœ€ç»ˆåŸåˆ™ï¼ˆå†™ç»™æœªæ¥ï¼‰

> **è¿™ä¸æ˜¯ä¸€ä¸ªâ€œçµæ´»â€çš„ç³»ç»Ÿï¼Œ  
> è€Œæ˜¯ä¸€ä¸ªâ€œæŠ—è…åŒ–â€çš„ç³»ç»Ÿã€‚**

> **ä¸æ–¹ä¾¿å†™çš„ä»£ç ï¼Œ  
> å¾€å¾€æ­£æ˜¯æœªæ¥æœ€å®‰å…¨çš„ä»£ç ã€‚**

â€”

