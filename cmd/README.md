# cmd 模块

## 模块职责概述

`cmd/` 是 **Tmux-FSM 的命令行工具入口**，作为 Tmux-FSM 与外部世界交互的命令行边界。该模块定义了不同运行模式下的启动入口，解析命令行参数，并将 CLI 行为转换为内部 Engine / Kernel 调用，方便开发、调试和脚本化集成。

主要职责包括：
- 提供可执行命令的统一入口点
- 解析和处理命令行参数
- 封装系统功能的命令行接口
- 支持开发调试和运维操作

## 核心设计思想

- **单一职责**: 每个命令文件对应一个明确用途的命令
- **薄层设计**: 尽量保持薄层，不包含业务逻辑
- **参数解析**: 专注于参数解析、初始化、调用转发
- **统一入口**: 作为所有非交互式入口的统一位置

## 文件结构说明

### `main.go`
- CLI 主入口定义
- 主要函数：
  - `main()`: 主函数入口
  - `NewServer() *Server`: 创建服务器实例
  - `runClient(key, paneAndClient string)`: 运行客户端
- 负责：
  - 解析命令行参数
  - 初始化系统组件
  - 启动服务器或执行客户端命令

### `server.go`
- 服务器相关功能
- 主要函数：
  - `Server.Run(ctx context.Context) error`: 运行服务器
  - `handleClient(conn net.Conn)`: 处理客户端连接
  - `handleSignals(ctx context.Context, ln net.Listener)`: 处理系统信号
- 对应：
  - 启动 tmux-fsm 服务
  - 处理客户端请求

### `client.go`
- 客户端相关功能
- 主要函数：
  - `runClient(key, paneAndClient string)`: 运行客户端
  - `isServerRunning() bool`: 检查服务器是否运行
- 用于：
  - 发送命令到服务器
  - 与服务器通信

## 使用场景

- **本地调试**: 调试 FSM 行为和状态
- **服务器模式**: 启动后台服务
- **客户端模式**: 发送命令到服务器
- **CI/CD**: 在持续集成中运行一致性校验
- **开发验证**: 开发阶段快速验证 Intent → 执行路径
- **运维操作**: 系统监控、状态查询等运维任务

## 在整体架构中的角色

cmd 模块是系统的命令行接口层，它将命令行参数转换为对内部系统的调用。作为所有"非 tmux 热键"入口的统一位置，cmd 模块提供了系统功能的标准化命令行访问方式，支持自动化脚本和运维操作。