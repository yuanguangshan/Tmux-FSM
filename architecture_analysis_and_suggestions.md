该项目是 `tmuxPlugin`，核心是 `tmux-fsm` 和 `Weaver Core`，一个雄心勃勃且精心设计的系统，旨在为 tmux 带来强大、类似 Vim 的模态编辑体验，超越传统 tmux 键绑定的限制。其核心是 `Weaver Core`，一个面向事实的无头编辑内核（FOEK）。

**关键架构原则与组件：**

*   **客户端/服务器（守护进程）架构**：系统作为一个持久化的 Go 守护进程（服务器）和轻量级的 Go 客户端运行。通过 Unix Socket 进行通信，与每次按键启动 CLI 进程相比，延迟显著降低（<1毫秒）。
*   **有限状态机（FSM）**：`tmux-fsm` 的核心是一个定义良好的 FSM，主要由 `engine.go` 和 `matcher.go` 管理。它处理状态转换（NAV、GOTO、CMD、SUSPENDED、OPERATOR_PENDING、VISUAL_CHAR 等），并将原始按键解释为语义化的“意图”。
*   **分层交互模型**：FSM 采用严格的分层方法：
    *   **Kernel（内核）**：底层的 shell/Vim/应用程序，`tmux-fsm` 尊重其作为主要的语义所有者。
    *   **NAV（导航层）**：即“交互基态”。它是一个安全、非破坏性、无状态的默认状态。只允许白名单中的空间导航、模式转换和主权让渡行为（例如按下 `i` 挂起 FSM）。它严格避免编辑语义。
    *   **GOTO（瞬态层）**：一个单次、短暂的层，用于特定的导航或预确认操作。它必须“执行后即销毁”（任何按键后立即返回 NAV，无论是否匹配）。它严格限于单一意图，不能组合或“生长”。
    *   **CMD（命令层）**：一个阻塞的瞬态层，用于显式、不可逆的命令执行。它假定用户已确认，不作决策、不纠正错误、不记住偏好。动作是原子化的，并有明确的类型（创建、更新、删除、发布/应用）。
    *   **SUSPENDED（挂起）**：当按下 `i` 或检测到编辑应用程序且无修饰符时，`tmux-fsm` 完全将控制权让渡给内核。
*   **面向事实的编辑内核（FOEK）**：`Weaver Core` 将编辑建模为不可变的“事实”（带有范围 `Range` 和锚点 `Anchor` 的语义事件），而不是按键重放。“撤销”（Undo）是对事实的重建，与光标位置无关。
*   **锚点模型与解析器**：`Anchor` 是用于定位编辑文本的逻辑、独立于坐标的描述。`Anchor Resolver` 采用严格的三级安全策略（精确、模糊、失败）进行撤销/重做，优先考虑安全性（拒绝）而非便利性。
*   **意图/裁决/审计 ABI**：定义了正式的应用二进制接口（ABI）：
    *   `Intent`：用户的预期动作。
    *   `Verdict`：内核的判断（ACCEPT、REJECT、DEFER）。
    *   `Audit`：不可变、可解释的裁决记录，对于信任和调试至关重要。
*   **并发控制与持久化**：`sync.Mutex` 确保状态的原子性。状态在内存中管理，并定期或在优雅关闭时安全地持久化到 tmux 选项。
*   **安全机制**：
    *   **Shadow Mode（影子模式）**：通过 `ContextProbe` 在 `Matcher` 之前进行主权探测。如果检测到编辑应用程序（如 Vim）且按键无修饰符，`tmux-fsm` 会静默让渡控制权，避免劫持 Vim 语义。
    *   **PanicGuard（恐慌卫士）**：一个健壮的错误恢复机制，确保在任何内部错误或不可预见的情况下，FSM 都能强制恢复到 NAV 基态，防止系统死锁或陷入中间状态。
*   **严格的宪法级设计**：项目通过一系列 RFC 明确了“正宪法”和“负宪法”，定义了明确的目标和非目标，以及必须拒绝的行为，确保了系统的确定性、可审计性、可靠性和安全性。

**项目当前阶段与优势：**

该项目已经达到了一个非常成熟和稳定的架构阶段。其最大的优势在于：

1.  **确定性与可预测性**：严格的 FSM 规则和分层模型确保了系统行为的高度可预测性，消除了模态编辑中常见的冲突和混乱。
2.  **安全性与可靠性**：面向事实的 Undo/Redo、锚点解析、原子事务、Shadow Mode 和 PanicGuard 等机制，共同构建了一个高度安全的编辑环境，极大地降低了误操作的风险。
3.  **高性能**：客户端/服务器架构和 Unix Socket 通信实现了亚毫秒级的响应速度。
4.  **可审计性与透明性**：Intent/Verdict/Audit ABI 确保了每个操作都是可解释、可追溯的，增强了用户对系统的信任。
5.  **模块化与可扩展性**：清晰的职责分离和形式化的接口为未来的功能扩展和跨平台移植奠定了坚实基础。
6.  **对底层生态的尊重**：Shadow Mode 和 NAV 键权定律体现了对 Vim/Shell 肌肉记忆和语义主权的尊重，避免了不必要的冲突。

该项目已从一个简单的 tmux 插件发展成为一个具备工业级可信度和哲学深度的交互内核。
